(()=>{"use strict";var e={n:t=>{var l=t&&t.__esModule?()=>t.default:()=>t;return e.d(l,{a:l}),l},d:(t,l)=>{for(var i in l)e.o(l,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:l[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,l=window.wp.element,i=window.wp.hooks,o=window.wp.compose,a=window.wp.blockEditor,r=window.wp.components,n=window.wp.i18n,s=window.wp.date,c=window.wp.data,u=window.wp.autop;var b=e.n(u);const m=["core/group"],p=()=>(0,t.createElement)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",role:"presentation",focusable:"false","aria-hidden":"true"},(0,t.createElement)("rect",{x:"7",y:"3",width:"10",height:"18",rx:"2",ry:"2",fill:"currentColor",opacity:"0.2"}),(0,t.createElement)("rect",{x:"9",y:"5",width:"6",height:"14",rx:"1.2",ry:"1.2",fill:"none",stroke:"currentColor",strokeWidth:"1.5"}),(0,t.createElement)("circle",{cx:"12",cy:"17.5",r:"0.9",fill:"currentColor"})),d=()=>(0,t.createElement)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",role:"presentation",focusable:"false","aria-hidden":"true"},(0,t.createElement)("rect",{x:"3",y:"7",width:"18",height:"10",rx:"2",ry:"2",fill:"currentColor",opacity:"0.2"}),(0,t.createElement)("rect",{x:"5",y:"9",width:"14",height:"6",rx:"1.2",ry:"1.2",fill:"none",stroke:"currentColor",strokeWidth:"1.5"}),(0,t.createElement)("circle",{cx:"17.5",cy:"12",r:"0.9",fill:"currentColor"})),g=({label:e,variant:l="",screenReaderText:i="",description:o=""})=>{const a=["visibloc-status-badge"],n="string"==typeof o&&o.trim().length>0;"string"==typeof l&&l.trim()&&a.push(`visibloc-status-badge--${l.trim()}`);const s=(0,t.createElement)("span",{className:a.join(" ")},(0,t.createElement)("span",{className:"visibloc-status-badge__label"},e),n?(0,t.createElement)("span",{className:"visibloc-status-badge__description"},o):null,i?(0,t.createElement)("span",{className:"screen-reader-text"},i):null);return n?(0,t.createElement)(r.Tooltip,{text:o},s):s},v=e=>Array.isArray(e)?Array.from(new Set(e.map(e=>"string"==typeof e?e.trim():"").filter(Boolean))):[],_=v("object"==typeof VisiBlocData&&null!==VisiBlocData&&Array.isArray(VisiBlocData.supportedBlocks)?VisiBlocData.supportedBlocks:m),f=_.length>0?_:m,y=v((0,i.applyFilters)("visiblocSupportedBlocks",f)),h=y.length>0?y:f,j=e=>h.includes(e),E="function"==typeof s.__experimentalGetSettings?(0,s.__experimentalGetSettings)():{},{formats:k={}}=E||{},C="string"==typeof k.date&&k.date.trim()?k.date:"F j, Y",x="string"==typeof k.time&&k.time.trim()?k.time:"H:i",w="string"==typeof k.datetime&&k.datetime.trim()?k.datetime:`${C} ${x}`.trim(),B=(e=>{if(!e||"object"!=typeof e)return!1;if("boolean"==typeof e.twelveHourTime)return e.twelveHourTime;const{formats:t}=e;if(t&&"object"==typeof t){const{time:e}=t;if("string"==typeof e&&e.trim())return/a(?!\\)/i.test(e)}return!1})(E),A=(()=>{if(!E||"object"!=typeof E)return"UTC";const{timezone:e,timezoneAbbr:t,gmt_offset:l}=E;if(e&&"object"==typeof e){if("string"==typeof e.string&&e.string.trim())return e.string.trim();if("string"==typeof e.abbr&&e.abbr.trim())return e.abbr.trim()}if("string"==typeof e&&e.trim())return e.trim();if("string"==typeof t&&t.trim())return t.trim();return(e=>{if("number"!=typeof e||Number.isNaN(e))return"";if(0===e)return"UTC";const t=e>0?"+":"-",l=Math.abs(e),i=Math.round(60*l),o=Math.floor(i/60),a=i%60;return`UTC${t}${String(o).padStart(2,"0")}:${String(a).padStart(2,"0")}`})(l)||"UTC"})(),T=e=>e?"function"==typeof s.dateI18n?(0,s.dateI18n)(w,e):(0,s.format)(w,e):null,N=()=>(0,s.format)("Y-m-d\\TH:i:s",new Date),S=e=>{if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t},D={id:"all",label:(0,n.__)("Visible sur tous les appareils","visi-bloc-jlg")},q=[{id:"show-only",label:(0,n.__)("Afficher uniquement","visi-bloc-jlg"),options:[{id:"desktop-only",label:(0,n.__)("Desktop","visi-bloc-jlg"),icon:"desktop"},{id:"tablet-only",label:(0,n.__)("Tablette","visi-bloc-jlg"),icon:"tablet"},{id:"mobile-only",label:(0,n.__)("Mobile","visi-bloc-jlg"),icon:"smartphone"}]},{id:"hide-on",label:(0,n.__)("Masquer sur","visi-bloc-jlg"),options:[{id:"hide-on-desktop",label:(0,n.__)("Desktop","visi-bloc-jlg"),icon:"desktop"},{id:"hide-on-tablet",label:(0,n.__)("Tablette","visi-bloc-jlg"),icon:"tablet"},{id:"hide-on-mobile",label:(0,n.__)("Mobile","visi-bloc-jlg"),icon:"smartphone"}]},{id:"orientation-show",label:(0,n.__)("Orientation ciblée","visi-bloc-jlg"),options:[{id:"portrait-only",label:(0,n.__)("Portrait","visi-bloc-jlg"),icon:p},{id:"landscape-only",label:(0,n.__)("Paysage","visi-bloc-jlg"),icon:d}]},{id:"orientation-hide",label:(0,n.__)("Masquer en orientation","visi-bloc-jlg"),options:[{id:"hide-on-portrait",label:(0,n.__)("Portrait","visi-bloc-jlg"),icon:p},{id:"hide-on-landscape",label:(0,n.__)("Paysage","visi-bloc-jlg"),icon:d}]}],F=q.reduce((e,t)=>t&&Array.isArray(t.options)?e.concat(t.options):e,[]),H=["post_type","taxonomy","template","recurring_schedule","logged_in_status","user_role_group","woocommerce_cart","query_param"],P=[{value:"post_type",label:(0,n.__)("Type de contenu","visi-bloc-jlg")},{value:"taxonomy",label:(0,n.__)("Taxonomie","visi-bloc-jlg")},{value:"template",label:(0,n.__)("Modèle de page","visi-bloc-jlg")},{value:"recurring_schedule",label:(0,n.__)("Horaire récurrent","visi-bloc-jlg")},{value:"logged_in_status",label:(0,n.__)("État de connexion","visi-bloc-jlg")},{value:"user_role_group",label:(0,n.__)("Groupe de rôles","visi-bloc-jlg")},{value:"woocommerce_cart",label:(0,n.__)("Panier WooCommerce","visi-bloc-jlg")},{value:"query_param",label:(0,n.__)("Paramètre d’URL","visi-bloc-jlg")}],M=Object.freeze({logic:"AND",rules:[]}),R=Object.freeze({frequency:"daily",days:[],startTime:"08:00",endTime:"17:00"}),V="site",O=e=>{if("object"!=typeof VisiBlocData||null===VisiBlocData)return[];const t=VisiBlocData[e];return Array.isArray(t)?t:[]},L=e=>{if("object"!=typeof VisiBlocData||null===VisiBlocData)return null;const t=VisiBlocData[e];return t&&"object"==typeof t?t:null},I=e=>{if("string"!=typeof e)return"";const t=e.trim();if(!t)return"";if("undefined"==typeof document)return t;const l=document.createElement("template");return l.innerHTML=t,l.content.querySelectorAll("script, iframe, frame, frameset, object, embed, link, meta, style, noscript, form, input, button, textarea, select").forEach(e=>{e.remove()}),l.content.querySelectorAll("*").forEach(e=>{Array.from(e.attributes).forEach(t=>{const l=t.name.toLowerCase();if(l.startsWith("on"))e.removeAttribute(t.name);else if(["src","href","xlink:href"].includes(l)){const l=t.value.trim().toLowerCase();(l.startsWith("javascript:")||l.startsWith("data:"))&&e.removeAttribute(t.name)}})}),l.innerHTML.trim()},$=e=>{if(!e||"object"!=typeof e)return!1;const t=void 0===e.fallbackEnabled||Boolean(e.fallbackEnabled),l="string"==typeof e.fallbackBehavior?e.fallbackBehavior:"inherit";if(!t)return!1;if("text"===l)return("string"==typeof e.fallbackCustomText?e.fallbackCustomText:"").trim().length>0;if("block"===l)return Boolean(e.fallbackBlockId);const i=L("fallbackSettings")||{};return Boolean(i&&i.hasContent)},z=new Map,G=new Map;let U=null;const W=(()=>{const e=O("daysOfWeek"),t=new Map;return e.forEach(e=>{e&&"object"==typeof e&&"string"==typeof e.value&&t.set(e.value,e.label||e.value)}),t})(),Q=()=>`rule-${Math.random().toString(36).slice(2)}-${Date.now()}`,J=e=>{if(!Array.isArray(e)||!e.length)return"";const t=e.find(e=>e&&void 0!==e.value);if(!t)return"";const l=void 0===t.value||null===t.value?"":t.value;return String(l)},Y=e=>{switch(e){case"taxonomy":return(()=>{const e=O("taxonomies").find(e=>e&&"string"==typeof e.slug);return{id:Q(),type:"taxonomy",operator:"in",taxonomy:e?e.slug:"",terms:[]}})();case"template":return(()=>{const e=O("templates");return{id:Q(),type:"template",operator:"is",value:J(e)}})();case"recurring_schedule":return{id:Q(),type:"recurring_schedule",operator:"matches",...R};case"logged_in_status":return(()=>{const e=O("loginStatuses");return{id:Q(),type:"logged_in_status",operator:"is",value:J(e)}})();case"user_role_group":return(()=>{const e=O("roleGroups");return{id:Q(),type:"user_role_group",operator:"matches",group:J(e)}})();case"woocommerce_cart":return(()=>{const e=O("woocommerceTaxonomies").find(e=>e&&"string"==typeof e.slug);return{id:Q(),type:"woocommerce_cart",operator:"contains",taxonomy:e?e.slug:"",terms:[]}})();case"query_param":return(()=>{const e=O("commonQueryParams");return{id:Q(),type:"query_param",operator:"equals",param:J(e),value:""}})();default:return(()=>{const e=O("postTypes");return{id:Q(),type:"post_type",operator:"is",value:J(e)}})()}},K=e=>{if(!e||"object"!=typeof e)return null;const{type:t}=e;if(!H.includes(t))return null;const l={id:"string"==typeof e.id&&e.id?e.id:Q(),type:t};if("post_type"===t)return l.operator="is_not"===e.operator?"is_not":"is",l.value="string"==typeof e.value?e.value:"",l;if("taxonomy"===t)return l.operator="not_in"===e.operator?"not_in":"in",l.taxonomy="string"==typeof e.taxonomy?e.taxonomy:"",l.terms=Array.isArray(e.terms)?e.terms.map(e=>"string"==typeof e||"number"==typeof e?String(e):"").filter(Boolean):[],l;if("template"===t)return l.operator="is_not"===e.operator?"is_not":"is",l.value="string"==typeof e.value?e.value:"",l;if("logged_in_status"===t)return l.operator="is_not"===e.operator?"is_not":"is",l.value="string"==typeof e.value?e.value:"",l;if("user_role_group"===t)return l.operator="does_not_match"===e.operator?"does_not_match":"matches",l.group="string"==typeof e.group?e.group:"",l;if("woocommerce_cart"===t)return l.operator="not_contains"===e.operator?"not_contains":"contains",l.taxonomy="string"==typeof e.taxonomy?e.taxonomy:"",l.terms=Array.isArray(e.terms)?e.terms.map(e=>"string"==typeof e||"number"==typeof e?String(e):"").filter(Boolean):[],l;if("query_param"===t){const t=["equals","not_equals","contains","not_contains","exists","not_exists"];return l.operator=t.includes(e.operator)?e.operator:"equals",l.param="string"==typeof e.param?e.param:"",l.value="string"==typeof e.value?e.value:"",l}return l.operator="matches",l.frequency="weekly"===e.frequency?"weekly":"daily",l.days=Array.isArray(e.days)?e.days.map(e=>"string"==typeof e?e:"").filter(e=>W.has(e)):[],l.startTime="string"==typeof e.startTime?e.startTime:R.startTime,l.endTime="string"==typeof e.endTime?e.endTime:R.endTime,l},X=e=>e&&"object"==typeof e?{logic:"OR"===e.logic?"OR":"AND",rules:Array.isArray(e.rules)?e.rules.map(K).filter(Boolean):[]}:{logic:M.logic,rules:[...M.rules]},Z=(0,o.createHigherOrderComponent)(e=>i=>{if(!j(i.name))return(0,t.createElement)(e,{...i});const{attributes:o,setAttributes:s,isSelected:u,clientId:m}=i,{isHidden:p,deviceVisibility:d,isSchedulingEnabled:g,publishStartDate:v,publishEndDate:_,publishTimezone:f=V,visibilityRoles:y,advancedVisibility:h,fallbackEnabled:E=!0,fallbackBehavior:k="inherit",fallbackCustomText:C="",fallbackBlockId:x}=o,w=X(h),M=L("fallbackSettings")||{},[R,G]=(0,l.useState)(!1),U=$(o),Q=Boolean(M&&M.hasContent),J=M&&"string"==typeof M.summary?M.summary:"",Z=M&&"string"==typeof M.previewHtml?M.previewHtml:"",ee=O("fallbackBlocks").filter(e=>e&&"object"==typeof e).map(e=>{const t="number"==typeof e.value?e.value:parseInt(e.value,10),l=Number.isNaN(t)?0:t;return{value:String(l),label:"string"==typeof e.label&&e.label.trim()?e.label:`#${l}`}}),te=[{value:"inherit",label:(0,n.__)("Utiliser le repli global","visi-bloc-jlg")},{value:"text",label:(0,n.__)("Texte personnalisé","visi-bloc-jlg")},{value:"block",label:(0,n.__)("Bloc réutilisable","visi-bloc-jlg")}],ie=(0,l.useMemo)(()=>I(Z),[Z]),oe=(0,l.useMemo)(()=>"text"===k?(e=>{if("string"!=typeof e)return"";const t=e.trim();if(!t)return"";let l=t;return"function"==typeof b()&&(l=b()(t)),I(l)})(C):"",[k,C]),{blockPreviewHtml:ae,isBlockPreviewResolving:re}=(0,c.useSelect)(e=>{if("block"!==k||!x)return{blockPreviewHtml:"",isBlockPreviewResolving:!1};const t=e("core"),l=e("core/data"),i=t?t.getEntityRecord("postType","wp_block",x):void 0,o=!!l&&l.isResolving("core","getEntityRecord",["postType","wp_block",x]);return{blockPreviewHtml:i&&i.content&&"string"==typeof i.content.rendered?i.content.rendered:"",isBlockPreviewResolving:o||void 0===i}},[k,x]),ne=(0,l.useMemo)(()=>"block"===k?I(ae):"",[k,ae]),se=(0,l.useMemo)(()=>E?"text"===k?"string"==typeof C&&C.trim()?oe?{status:"ready",message:"",html:oe}:{status:"warning",message:(0,n.__)("Prévisualisation indisponible pour ce texte.","visi-bloc-jlg"),html:""}:{status:"warning",message:(0,n.__)("Aucun texte de repli défini.","visi-bloc-jlg"),html:""}:"block"===k?x?re?{status:"info",message:(0,n.__)("Chargement de l’aperçu du bloc de repli…","visi-bloc-jlg"),html:""}:ne?{status:"ready",message:"",html:ne}:{status:"warning",message:(0,n.__)("Impossible d’afficher l’aperçu du bloc sélectionné.","visi-bloc-jlg"),html:""}:{status:"warning",message:(0,n.__)("Aucun bloc réutilisable sélectionné.","visi-bloc-jlg"),html:""}:Q?ie?{status:"ready",message:"",html:ie}:{status:"warning",message:(0,n.__)("Aucun aperçu disponible pour le repli global.","visi-bloc-jlg"),html:""}:{status:"warning",message:(0,n.__)("Aucun repli global n’est configuré.","visi-bloc-jlg"),html:""}:{status:"info",message:(0,n.__)("Le repli est désactivé pour ce bloc.","visi-bloc-jlg"),html:""},[E,k,C,oe,x,re,ne,Q,ie]),ce=se.html,ue=se.status,be=se.message,me=e=>{const t=X({...w}),l=e(t)||t;s({advancedVisibility:X(l)})},pe=(e,t)=>{const l=e?[...y,t]:y.filter(e=>e!==t);s({visibilityRoles:l})},de=(0,l.useMemo)(()=>O("timezones"),[]),ge=(0,l.useMemo)(()=>de.map(e=>{if(!e||"object"!=typeof e)return null;const t="string"==typeof e.value?e.value.trim():"";return t?{value:t,label:"string"==typeof e.label&&e.label.trim()?e.label:t}:null}).filter(Boolean),[de]),ve=(0,l.useMemo)(()=>(0,n.sprintf)((0,n.__)("Fuseau du site (%s)","visi-bloc-jlg"),A),[]),_e=(0,l.useMemo)(()=>[{value:V,label:ve},...ge],[ve,ge]),fe=(0,l.useMemo)(()=>_e.some(e=>e.value===f)?f:V,[f,_e]),ye=(0,l.useMemo)(()=>{const e=_e.find(e=>e.value===fe);return e?e.label:ve},[fe,_e,ve]),he=fe!==V,je=(0,l.useMemo)(()=>(0,n.sprintf)((0,n.__)("Fuseau horaire : %s","visi-bloc-jlg"),ye),[ye]);let Ee=(0,n.__)("Aucune programmation.","visi-bloc-jlg");const ke=S(v),Ce=S(_),xe=g&&!!ke&&!!Ce&&Ce.getTime()<ke.getTime();if(g){const e=T(v),t=T(_);
/* translators: 1: Start date, 2: end date. */
Ee=e&&t?(0,n.sprintf)((0,n.__)("Du %s au %s.","visi-bloc-jlg"),e,t):e?(0,n.sprintf)((0,n.__)("À partir du %s.","visi-bloc-jlg"),e):t?(0,n.sprintf)((0,n.__)("Jusqu'au %s.","visi-bloc-jlg"),t):(0,n.__)("Activée, mais sans date définie.","visi-bloc-jlg"),xe&&(Ee=(0,n.__)("Dates de programmation invalides.","visi-bloc-jlg"))}const we=(0,n.__)("Inactif","visi-bloc-jlg"),Be=(e,i)=>(0,t.createElement)(l.Fragment,null,(0,t.createElement)("span",null,e),(0,t.createElement)("span",{className:"components-panel__summary"},i&&String(i).trim()?i:we)),Ae=(()=>{if(!d||d===D.id)return"";const e=q.find(e=>!!Array.isArray(e.options)&&e.options.some(e=>e.id===d)),t=F.find(e=>e.id===d);return t?e?`${e.label} – ${t.label}`:t.label:""})(),Te=(()=>{if(!g)return"";if(xe)return(0,n.__)("Erreur de dates","visi-bloc-jlg");let e;return e=v&&_?(0,n.__)("Plage définie","visi-bloc-jlg"):v||_?(0,n.__)("Date définie","visi-bloc-jlg"):(0,n.__)("Programmation active","visi-bloc-jlg"),he?`${e} – ${ye}`:e})(),Ne=(()=>{const e=Array.from(new Set((y||[]).filter(Boolean))).length;return e?(0,n.sprintf)((0,n._n)("%d rôle","%d rôles",e,"visi-bloc-jlg"),e):""})(),Se=(()=>{const e=Array.isArray(w.rules)?w.rules.length:0;if(!e)return"";const t="OR"===w.logic?(0,n.__)("OU","visi-bloc-jlg"):(0,n.__)("ET","visi-bloc-jlg");return(0,n.sprintf)((0,n._n)("%1$d règle %2$s","%1$d règles %2$s",e,"visi-bloc-jlg"),e,t)})(),De=(()=>{if(!E)return"";const e={inherit:(0,n.__)("Global","visi-bloc-jlg"),text:(0,n.__)("Texte","visi-bloc-jlg"),block:(0,n.__)("Bloc","visi-bloc-jlg")};return"block"!==k||x?e[k]||e.inherit:(0,n.__)("Bloc","visi-bloc-jlg")})(),qe=[];p&&qe.push((0,n.__)("Bloc masqué manuellement.","visi-bloc-jlg")),Ae&&qe.push((0,n.sprintf)((0,n.__)("Appareils : %s","visi-bloc-jlg"),Ae)),g&&(qe.push((0,n.sprintf)((0,n.__)("Programmation : %s","visi-bloc-jlg"),Ee)),qe.push((0,n.sprintf)((0,n.__)("Fuseau horaire : %s","visi-bloc-jlg"),ye))),Ne&&qe.push((0,n.sprintf)((0,n.__)("Rôles ciblés : %s","visi-bloc-jlg"),Ne)),Se&&qe.push((0,n.sprintf)((0,n.__)("Règles avancées : %s","visi-bloc-jlg"),Se));const Fe=[];if(U)if(De&&Fe.push((0,n.sprintf)((0,n.__)("Type : %s","visi-bloc-jlg"),De)),"inherit"===k)J?Fe.push((0,n.sprintf)((0,n.__)("Repli global : %s","visi-bloc-jlg"),J)):Q?Fe.push((0,n.__)("Utilise le contenu de repli global.","visi-bloc-jlg")):Fe.push((0,n.__)("Aucun repli global défini.","visi-bloc-jlg"));else if("text"===k){const e="string"==typeof C?C.trim():"";e&&Fe.push(e)}else if("block"===k&&x){const e=ee.find(e=>e.value===String(x));e&&e.label&&Fe.push((0,n.sprintf)((0,n.__)("Bloc : %s","visi-bloc-jlg"),e.label))}if(m){const e=qe.join("\n").trim(),t=Fe.join("\n").trim(),l=z.get(m)||{},i={...l,isHidden:Boolean(p),hasFallback:U,hiddenDescription:e,fallbackDescription:t};z.set(m,i),l.isHidden===i.isHidden&&l.hasFallback===i.hasFallback&&l.hiddenDescription===i.hiddenDescription&&l.fallbackDescription===i.fallbackDescription||le(m,i)}return(0,t.createElement)(l.Fragment,null,(0,t.createElement)(e,{...i}),u&&(0,t.createElement)(l.Fragment,null,(0,t.createElement)(a.BlockControls,null,(0,t.createElement)(r.ToolbarGroup,null,(0,t.createElement)(r.ToolbarButton,{icon:"visibility",label:(0,n.__)("Rendre visible","visi-bloc-jlg"),onClick:()=>s({isHidden:!1}),isActive:!1===p}),(0,t.createElement)(r.ToolbarButton,{icon:"hidden",label:(0,n.__)("Rendre caché","visi-bloc-jlg"),onClick:()=>s({isHidden:!0}),isActive:!0===p}))),(0,t.createElement)(a.InspectorControls,null,(0,t.createElement)(r.PanelBody,{title:Be((0,n.__)("Contrôles de Visibilité","visi-bloc-jlg"),Ae),initialOpen:!0},(0,t.createElement)(r.BaseControl,{label:(0,n.__)("Visibilité par Appareil","visi-bloc-jlg")},(0,t.createElement)("div",{className:"visi-bloc-device-toggle-groups"},q.map(e=>{const l=e.options.some(e=>e.id===d);return(0,t.createElement)("div",{key:e.id,className:"visi-bloc-device-toggle-group"},(0,t.createElement)(r.BaseControl.VisualLabel,null,e.label),(0,t.createElement)(r.ToggleGroupControl,{className:"visi-bloc-device-toggle",isBlock:!0,isDeselectable:!0,value:l?d:void 0,onChange:e=>s({deviceVisibility:e||D.id})},e.options.map(e=>(0,t.createElement)(r.ToggleGroupControlOptionIcon,{key:e.id,value:e.id,icon:e.icon,label:e.label}))))}),(0,t.createElement)(r.Button,{className:"visi-bloc-device-toggle-reset",variant:"link",isLink:!0,onClick:()=>s({deviceVisibility:D.id}),disabled:d===D.id},D.label)))),(0,t.createElement)(r.PanelBody,{title:Be((0,n.__)("Programmation","visi-bloc-jlg"),Te),initialOpen:!1,className:"visi-bloc-panel-schedule"},(0,t.createElement)(r.ToggleControl,{label:(0,n.__)("Activer la programmation","visi-bloc-jlg"),checked:g,onChange:()=>s({isSchedulingEnabled:!g})}),g&&(0,t.createElement)("div",null,(0,t.createElement)("p",{style:{fontStyle:"italic",color:"#555"}},Ee),xe&&(0,t.createElement)(r.Notice,{status:"error",isDismissible:!1},(0,n.__)("La date de fin doit être postérieure à la date de début.","visi-bloc-jlg")),(0,t.createElement)(r.ComboboxControl,{label:(0,n.__)("Fuseau horaire de programmation","visi-bloc-jlg"),value:fe,options:_e,onChange:e=>{const t=_e.find(t=>t.value===e);s({publishTimezone:t?t.value:V})},placeholder:(0,n.__)("Rechercher un fuseau horaire…","visi-bloc-jlg"),__nextHasNoMarginBottom:!0,help:(0,n.__)("Choisissez un fuseau horaire spécifique pour cette plage. Par défaut, le fuseau du site est utilisé.","visi-bloc-jlg")}),(0,t.createElement)("p",{style:{fontStyle:"italic",color:"#555"}},je),(0,t.createElement)(r.CheckboxControl,{label:(0,n.__)("Définir une date de début","visi-bloc-jlg"),checked:!!v,onChange:e=>{s({publishStartDate:e?N():void 0})}}),!!v&&(0,t.createElement)("div",{className:"visi-bloc-datepicker-wrapper"},(0,t.createElement)(r.DateTimePicker,{currentDate:v,onChange:e=>s({publishStartDate:e}),is12Hour:B})),(0,t.createElement)(r.CheckboxControl,{label:(0,n.__)("Définir une date de fin","visi-bloc-jlg"),checked:!!_,onChange:e=>{s({publishEndDate:e?N():void 0})}}),!!_&&(0,t.createElement)("div",{className:"visi-bloc-datepicker-wrapper"},(0,t.createElement)(r.DateTimePicker,{currentDate:_,onChange:e=>s({publishEndDate:e}),is12Hour:B})))),(0,t.createElement)(r.PanelBody,{title:Be((0,n.__)("Visibilité par Rôle","visi-bloc-jlg"),Ne),initialOpen:!1},(0,t.createElement)("p",null,(0,n.__)("N'afficher que pour les rôles sélectionnés. Laisser vide pour afficher à tout le monde.","visi-bloc-jlg")),(0,t.createElement)(r.CheckboxControl,{label:(0,n.__)("Visiteurs Déconnectés","visi-bloc-jlg"),checked:y.includes("logged-out"),onChange:e=>pe(e,"logged-out")}),(0,t.createElement)(r.CheckboxControl,{label:(0,n.__)("Utilisateurs Connectés (tous)","visi-bloc-jlg"),checked:y.includes("logged-in"),onChange:e=>pe(e,"logged-in")}),(0,t.createElement)("hr",null),Object.entries(VisiBlocData.roles||{}).sort(([,e],[,t])=>String(e).localeCompare(String(t))).map(([e,l])=>(0,t.createElement)(r.CheckboxControl,{key:e,label:l,checked:y.includes(e),onChange:t=>pe(t,e)}))),(0,t.createElement)(r.PanelBody,{title:Be((0,n.__)("Règles de visibilité avancées","visi-bloc-jlg"),Se),initialOpen:!1},(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Logique entre les règles","visi-bloc-jlg"),value:w.logic,options:[{value:"AND",label:(0,n.__)("Toutes les règles doivent être vraies (ET)","visi-bloc-jlg")},{value:"OR",label:(0,n.__)("Au moins une règle doit être vraie (OU)","visi-bloc-jlg")}],onChange:e=>me(t=>({...t,logic:"OR"===e?"OR":"AND"}))}),w.rules.map((e,l)=>((e,l)=>{const i=t=>{me(i=>{const o=[...i.rules];return o[l]=K({...e,...t}),{...i,rules:o}})},o=(0,t.createElement)(r.Flex,{align:"center",wrap:!0},(0,t.createElement)(r.FlexBlock,null,(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Type de règle","visi-bloc-jlg"),value:e.type,options:P,onChange:e=>{H.includes(e)&&me(t=>{const i=[...t.rules],o=Y(e);return i[l]=o,{...t,rules:i}})}})),(0,t.createElement)(r.FlexItem,null,(0,t.createElement)(r.Button,{isDestructive:!0,variant:"tertiary",onClick:()=>{me(e=>{const t=e.rules.filter((e,t)=>t!==l);return{...e,rules:t}})}},(0,n.__)("Supprimer","visi-bloc-jlg"))));if("post_type"===e.type){const l=O("postTypes").map(e=>({value:e.value,label:e.label}));return(0,t.createElement)("div",{key:e.id,className:"visibloc-advanced-rule"},o,(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:e.operator,options:[{value:"is",label:(0,n.__)("Est","visi-bloc-jlg")},{value:"is_not",label:(0,n.__)("N’est pas","visi-bloc-jlg")}],onChange:e=>i({operator:e})}),(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Type de contenu","visi-bloc-jlg"),value:e.value,options:l,onChange:e=>i({value:e})}))}if("taxonomy"===e.type){const l=O("taxonomies"),a=l.find(t=>t.slug===e.taxonomy),s=l.map(e=>({value:e.slug,label:e.label})),c=(a&&Array.isArray(a.terms)?a.terms:[]).map(e=>({value:e.value,label:e.label})),u=(t,l)=>{const o=String(l),a=t?[...e.terms,o]:e.terms.filter(e=>e!==o);i({terms:a})};return(0,t.createElement)("div",{key:e.id,className:"visibloc-advanced-rule"},o,(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Taxonomie","visi-bloc-jlg"),value:e.taxonomy,options:s,onChange:e=>i({taxonomy:e,terms:[]})}),(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:e.operator,options:[{value:"in",label:(0,n.__)("Inclut au moins un terme","visi-bloc-jlg")},{value:"not_in",label:(0,n.__)("Exclut tous les termes","visi-bloc-jlg")}],onChange:e=>i({operator:e})}),c.length>0?(0,t.createElement)("div",{className:"visibloc-advanced-rule__terms"},c.map(l=>(0,t.createElement)(r.CheckboxControl,{key:l.value,label:l.label,checked:e.terms.includes(l.value),onChange:e=>u(e,l.value)}))):(0,t.createElement)("p",{className:"components-help-text"},(0,n.__)("Aucun terme disponible pour cette taxonomie.","visi-bloc-jlg")))}if("template"===e.type){const l=O("templates").map(e=>({value:e.value,label:e.label}));return(0,t.createElement)("div",{key:e.id,className:"visibloc-advanced-rule"},o,(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:e.operator,options:[{value:"is",label:(0,n.__)("Est","visi-bloc-jlg")},{value:"is_not",label:(0,n.__)("N’est pas","visi-bloc-jlg")}],onChange:e=>i({operator:e})}),(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Modèle","visi-bloc-jlg"),value:e.value,options:l,onChange:e=>i({value:e})}))}if("logged_in_status"===e.type){const l=O("loginStatuses").map(e=>({value:e.value,label:e.label}));return(0,t.createElement)("div",{key:e.id,className:"visibloc-advanced-rule"},o,(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:e.operator,options:[{value:"is",label:(0,n.__)("Est","visi-bloc-jlg")},{value:"is_not",label:(0,n.__)("N’est pas","visi-bloc-jlg")}],onChange:e=>i({operator:e})}),(0,t.createElement)(r.SelectControl,{label:(0,n.__)("État de connexion","visi-bloc-jlg"),value:e.value,options:l,onChange:e=>i({value:e})}))}if("user_role_group"===e.type){const l=O("roleGroups"),a=L("roles")||{},s=l.find(t=>t&&t.value===e.group),c=s&&Array.isArray(s.roles)?s.roles:[];return(0,t.createElement)("div",{key:e.id,className:"visibloc-advanced-rule"},o,(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:e.operator,options:[{value:"matches",label:(0,n.__)("Correspond à","visi-bloc-jlg")},{value:"does_not_match",label:(0,n.__)("Ne correspond pas à","visi-bloc-jlg")}],onChange:e=>i({operator:e})}),(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Groupe de rôles","visi-bloc-jlg"),value:e.group,options:l.map(e=>({value:e.value,label:e.label})),onChange:e=>i({group:e})}),c.length>0&&(0,t.createElement)("p",{className:"components-help-text"},c.map(e=>a[e]||e).filter(Boolean).join(", ")))}if("woocommerce_cart"===e.type){const l=O("woocommerceTaxonomies"),a=Array.isArray(l)&&l.length>0,s=l.find(t=>t&&t.slug===e.taxonomy),c=a?l.map(e=>({value:e.slug,label:e.label})):[{value:"",label:(0,n.__)("Aucune taxonomie disponible","visi-bloc-jlg")}],u=s&&Array.isArray(s.terms)?s.terms.map(e=>({value:e.value,label:e.label})):[],b=(t,l)=>{const o=String(l),a=t?[...e.terms,o]:e.terms.filter(e=>e!==o);i({terms:a})};return(0,t.createElement)("div",{key:e.id,className:"visibloc-advanced-rule"},o,(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:e.operator,options:[{value:"contains",label:(0,n.__)("Contient des produits avec ces termes","visi-bloc-jlg")},{value:"not_contains",label:(0,n.__)("Ne contient aucun produit avec ces termes","visi-bloc-jlg")}],onChange:e=>i({operator:e})}),(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Taxonomie WooCommerce","visi-bloc-jlg"),value:e.taxonomy,options:c,onChange:e=>i({taxonomy:e,terms:[]}),disabled:!a}),a?u.length>0?(0,t.createElement)("div",{className:"visibloc-advanced-rule__terms"},u.map(l=>(0,t.createElement)(r.CheckboxControl,{key:l.value,label:l.label,checked:e.terms.includes(l.value),onChange:e=>b(e,l.value)}))):(0,t.createElement)("p",{className:"components-help-text"},(0,n.__)("Aucun terme disponible pour cette taxonomie WooCommerce.","visi-bloc-jlg")):(0,t.createElement)("p",{className:"components-help-text"},(0,n.__)("Aucune source WooCommerce n’est disponible. Activez WooCommerce pour utiliser cette règle.","visi-bloc-jlg")))}if("query_param"===e.type){const l=O("commonQueryParams").map(e=>({value:e.value,label:e.label||e.value})),a=[{value:"",label:(0,n.__)("Personnalisé…","visi-bloc-jlg")},...l],s=[{value:"equals",label:(0,n.__)("Est égal à","visi-bloc-jlg")},{value:"not_equals",label:(0,n.__)("Est différent de","visi-bloc-jlg")},{value:"contains",label:(0,n.__)("Contient","visi-bloc-jlg")},{value:"not_contains",label:(0,n.__)("Ne contient pas","visi-bloc-jlg")},{value:"exists",label:(0,n.__)("Existe","visi-bloc-jlg")},{value:"not_exists",label:(0,n.__)("N’existe pas","visi-bloc-jlg")}],c=l.some(t=>t.value===e.param)?e.param:"";return(0,t.createElement)("div",{key:e.id,className:"visibloc-advanced-rule"},o,(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:e.operator,options:s,onChange:e=>i({operator:e})}),(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Paramètre courant","visi-bloc-jlg"),value:c,options:a,onChange:e=>{e&&i({param:e})}}),(0,t.createElement)(r.TextControl,{label:(0,n.__)("Nom du paramètre","visi-bloc-jlg"),value:e.param,onChange:e=>i({param:e}),help:(0,n.__)("Saisissez le nom du paramètre de requête attendu (ex. utm_source).","visi-bloc-jlg")}),!["exists","not_exists"].includes(e.operator)&&(0,t.createElement)(r.TextControl,{label:(0,n.__)("Valeur attendue","visi-bloc-jlg"),value:e.value,onChange:e=>i({value:e})}))}const a=e=>t=>{const l=t&&t.target?t.target.value:"",o="string"==typeof l?l:"";i({[e]:o})};return(0,t.createElement)("div",{key:e.id,className:"visibloc-advanced-rule"},o,(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Fréquence","visi-bloc-jlg"),value:e.frequency,options:[{value:"daily",label:(0,n.__)("Quotidien","visi-bloc-jlg")},{value:"weekly",label:(0,n.__)("Hebdomadaire","visi-bloc-jlg")}],onChange:t=>i({frequency:t,days:"weekly"===t?e.days:[]})}),(0,t.createElement)(r.Flex,{gap:"small"},(0,t.createElement)(r.FlexBlock,null,(0,t.createElement)(r.BaseControl,{label:(0,n.__)("Heure de début","visi-bloc-jlg")},(0,t.createElement)("input",{type:"time",value:e.startTime||"",onChange:a("startTime"),className:"components-text-control__input"}))),(0,t.createElement)(r.FlexBlock,null,(0,t.createElement)(r.BaseControl,{label:(0,n.__)("Heure de fin","visi-bloc-jlg")},(0,t.createElement)("input",{type:"time",value:e.endTime||"",onChange:a("endTime"),className:"components-text-control__input"})))),"weekly"===e.frequency&&W.size>0&&(0,t.createElement)("div",{className:"visibloc-advanced-rule__days"},(0,t.createElement)("p",{className:"components-base-control__label"},(0,n.__)("Jours actifs","visi-bloc-jlg")),Array.from(W.entries()).map(([l,o])=>(0,t.createElement)(r.CheckboxControl,{key:l,label:o,checked:e.days.includes(l),onChange:t=>((t,l)=>{const o=t?[...new Set([...e.days,l])]:e.days.filter(e=>e!==l);i({days:o})})(t,l)}))))})(e,l)),(0,t.createElement)(r.DropdownMenu,{text:(0,n.__)("Ajouter une règle de…","visi-bloc-jlg"),label:(0,n.__)("Ajouter une règle de…","visi-bloc-jlg"),toggleProps:{variant:"secondary"}},({onClose:e})=>(0,t.createElement)(r.MenuGroup,{label:(0,n.__)("Types de règles disponibles","visi-bloc-jlg")},P.map(l=>(0,t.createElement)(r.MenuItem,{key:l.value,onClick:()=>{me(e=>({...e,rules:[...e.rules,Y(l.value)]})),e()}},l.label)))),(0,t.createElement)("p",{className:"components-help-text"},(0,n.__)("Ces règles permettent d’affiner la visibilité selon le contexte du contenu, le modèle ou un horaire récurrent.","visi-bloc-jlg"))),(0,t.createElement)(r.PanelBody,{title:Be((0,n.__)("Contenu de repli","visi-bloc-jlg"),De),initialOpen:!1},(0,t.createElement)(r.ToggleControl,{label:(0,n.__)("Activer le repli pour ce bloc","visi-bloc-jlg"),checked:E,onChange:()=>s({fallbackEnabled:!E})}),!E&&(0,t.createElement)(r.Notice,{status:"info",isDismissible:!1},(0,n.__)("Aucun contenu de repli ne sera affiché si ce bloc est masqué.","visi-bloc-jlg")),E&&(0,t.createElement)(l.Fragment,null,(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Source du repli","visi-bloc-jlg"),value:k,options:te,onChange:e=>s({fallbackBehavior:te.some(t=>t.value===e)?e:"inherit"})}),"inherit"===k&&(Q?(0,t.createElement)(r.Notice,{status:"info",isDismissible:!1},J?(0,n.sprintf)((0,n.__)("Repli global : %s","visi-bloc-jlg"),J):(0,n.__)("Un repli global est configuré.","visi-bloc-jlg")):(0,t.createElement)(r.Notice,{status:"warning",isDismissible:!1},(0,n.__)("Aucun repli global n’est actuellement défini.","visi-bloc-jlg"))),"text"===k&&(0,t.createElement)(r.TextareaControl,{label:(0,n.__)("Texte affiché en repli","visi-bloc-jlg"),help:(0,n.__)("Ce texte remplace le bloc lorsque les visiteurs n’y ont pas accès.","visi-bloc-jlg"),value:C,onChange:e=>s({fallbackCustomText:e})}),"block"===k&&(0,t.createElement)(l.Fragment,null,(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Bloc réutilisable à afficher","visi-bloc-jlg"),value:x?String(x):"",options:[{value:"",label:(0,n.__)("— Sélectionnez un bloc —","visi-bloc-jlg")},...ee],onChange:e=>{const t=parseInt(e,10);s({fallbackBlockId:Number.isNaN(t)?0:t})},disabled:!ee.length}),!ee.length&&(0,t.createElement)(r.Notice,{status:"warning",isDismissible:!1},(0,n.__)("Aucun bloc réutilisable publié n’est disponible.","visi-bloc-jlg"))),(0,t.createElement)(r.ToggleControl,{label:(0,n.__)("Prévisualiser le repli","visi-bloc-jlg"),checked:R,onChange:()=>G(e=>!e),disabled:!E}),R&&E&&(0,t.createElement)("div",{className:"visibloc-fallback-preview",role:"region","aria-live":"polite"},ce?(0,t.createElement)("div",{className:"visibloc-fallback-preview__content"},(0,t.createElement)(l.RawHTML,null,ce)):(0,t.createElement)(r.Notice,{status:"warning"===ue?"warning":"info",isDismissible:!1},be||(0,n.__)("Aucun aperçu disponible pour ce repli.","visi-bloc-jlg"))))))))},"withVisibilityControls");function ee(){const e=(0,c.select)("core/edit-post");return!!e&&("function"==typeof e.isListViewOpened?e.isListViewOpened():"function"==typeof e.isFeatureActive&&e.isFeatureActive("listView"))}function te(){if("undefined"==typeof document)return void(U=null);const e=new Map;G.forEach((t,l)=>{const i=document.querySelector(`.block-editor-list-view__block[data-block="${l}"]`);i?(t.isHidden?i.classList.add("bloc-editeur-cache"):i.classList.remove("bloc-editeur-cache"),t.hasFallback?i.classList.add("bloc-editeur-repli"):i.classList.remove("bloc-editeur-repli")):e.set(l,t)}),G.clear(),e.size&&e.forEach((e,t)=>{G.set(t,e)}),U=G.size&&ee()?window.requestAnimationFrame(()=>{te()}):null}function le(e,t){const l=G.get(e);l&&l.isHidden===t.isHidden&&l.hasFallback===t.hasFallback&&l.hiddenDescription===t.hiddenDescription&&l.fallbackDescription===t.fallbackDescription||(G.set(e,t),U||(U=window.requestAnimationFrame(()=>{te()})))}(0,i.addFilter)("blocks.registerBlockType","visi-bloc-jlg/add-visibility-attributes",function(e,t){return j(t)?(e.attributes={...e.attributes,isHidden:{type:"boolean",default:!1},deviceVisibility:{type:"string",default:"all"},isSchedulingEnabled:{type:"boolean",default:!1},publishStartDate:{type:"string"},publishEndDate:{type:"string"},publishTimezone:{type:"string",default:V},visibilityRoles:{type:"array",default:[]},advancedVisibility:{type:"object",default:M},fallbackEnabled:{type:"boolean",default:!0},fallbackBehavior:{type:"string",default:"inherit"},fallbackCustomText:{type:"string",default:""},fallbackBlockId:{type:"number"}},e):e}),(0,i.addFilter)("editor.BlockEdit","visi-bloc-jlg/with-visibility-controls",Z),(0,i.addFilter)("blocks.getSaveContent.extraProps","visi-bloc-jlg/add-save-classes",function(e,t,l){if(!j(t.name)||!l)return e;const{deviceVisibility:i}=l,o=[e.className,i&&"all"!==i?`vb-${i}`:""].filter(Boolean).join(" ");return{...e,className:o}}),(0,i.addFilter)("editor.BlockListBlock","visi-bloc-jlg/add-editor-status-badges",(0,o.createHigherOrderComponent)(e=>i=>{const o="string"==typeof i.className?i.className:"",a=o.includes("bloc-editeur-cache"),r=o.includes("bloc-editeur-repli"),s=i.clientId&&z.get(i.clientId)||{},c="string"==typeof s.hiddenDescription?s.hiddenDescription:"",u="string"==typeof s.fallbackDescription?s.fallbackDescription:"";if(!a&&!r)return(0,t.createElement)(e,{...i});const b=(0,t.createElement)(e,{...i}),m=l.Children.toArray(b.props.children),p=[];return a&&p.push((0,t.createElement)(g,{key:"visibloc-hidden-badge",label:(0,n.__)("Bloc masqué","visi-bloc-jlg"),variant:"hidden",screenReaderText:(0,n.__)("Ce bloc est masqué pour les visiteurs du site.","visi-bloc-jlg"),description:c})),r&&p.push((0,t.createElement)(g,{key:"visibloc-fallback-badge",label:(0,n.__)("Repli actif","visi-bloc-jlg"),variant:"fallback",screenReaderText:(0,n.__)("Le contenu de repli est affiché à la place du bloc original.","visi-bloc-jlg"),description:u})),(0,l.cloneElement)(b,b.props,[...p,...m])},"withVisibilityStatusBadges")),(0,i.addFilter)("editor.BlockListBlock.props","visi-bloc-jlg/add-editor-canvas-classes",function(e,t){if(!j(t.name)||!t.attributes)return e;const{isHidden:l}=t.attributes,i=$(t.attributes),o=[e.className,l?"bloc-editeur-cache":"",i?"bloc-editeur-repli":""].filter(Boolean).join(" ");return{...e,className:o}});let ie=ee();(0,c.subscribe)(function(){const e=ee();!function(){const e=(0,c.select)("core/block-editor");if(!e)return;const t=e.getBlockOrder();if(!t.length)return;const l=[...t],i=new Set;for(;l.length;){const t=l.pop(),o=e.getBlock(t);if(o){if(j(o.name)){const e=Boolean(o.attributes.isHidden),l=$(o.attributes),a=z.get(t)||{},r={...a,isHidden:e,hasFallback:l};a.isHidden===r.isHidden&&a.hasFallback===r.hasFallback||le(t,r),z.set(t,r),i.add(t)}o.innerBlocks&&o.innerBlocks.length&&o.innerBlocks.forEach(e=>{e&&e.clientId&&l.push(e.clientId)})}}i.size!==z.size&&Array.from(z.keys()).forEach(e=>{i.has(e)||(z.delete(e),G.delete(e))})}(),e&&!ie&&function(){if(!G.size)return;const e=Array.from(G.entries());G.clear(),U&&(window.cancelAnimationFrame(U),U=null),e.forEach(([e,t])=>{le(e,t)})}(),ie=e})})();
