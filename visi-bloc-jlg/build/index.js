(()=>{"use strict";const e=window.React,t=window.wp.element,l=window.wp.hooks,i=window.wp.compose,o=window.wp.blockEditor,a=window.wp.components,r=window.wp.i18n,n=window.wp.date,s=window.wp.data,c=["core/group"],u=e=>Array.isArray(e)?Array.from(new Set(e.map(e=>"string"==typeof e?e.trim():"").filter(Boolean))):[],d=u("object"==typeof VisiBlocData&&null!==VisiBlocData&&Array.isArray(VisiBlocData.supportedBlocks)?VisiBlocData.supportedBlocks:c),b=d.length>0?d:c,m=u((0,l.applyFilters)("visiblocSupportedBlocks",b)),p=m.length>0?m:b,g=e=>p.includes(e),v="function"==typeof n.__experimentalGetSettings?(0,n.__experimentalGetSettings)():{},{formats:f={}}=v||{},y="string"==typeof f.date&&f.date.trim()?f.date:"F j, Y",_="string"==typeof f.time&&f.time.trim()?f.time:"H:i",h="string"==typeof f.datetime&&f.datetime.trim()?f.datetime:`${y} ${_}`.trim(),j=(e=>{if(!e||"object"!=typeof e)return!1;if("boolean"==typeof e.twelveHourTime)return e.twelveHourTime;const{formats:t}=e;if(t&&"object"==typeof t){const{time:e}=t;if("string"==typeof e&&e.trim())return/a(?!\\)/i.test(e)}return!1})(v),E=(()=>{if(!v||"object"!=typeof v)return"UTC";const{timezone:e,timezoneAbbr:t,gmt_offset:l}=v;if(e&&"object"==typeof e){if("string"==typeof e.string&&e.string.trim())return e.string.trim();if("string"==typeof e.abbr&&e.abbr.trim())return e.abbr.trim()}if("string"==typeof e&&e.trim())return e.trim();if("string"==typeof t&&t.trim())return t.trim();return(e=>{if("number"!=typeof e||Number.isNaN(e))return"";if(0===e)return"UTC";const t=e>0?"+":"-",l=Math.abs(e),i=Math.round(60*l),o=Math.floor(i/60),a=i%60;return`UTC${t}${String(o).padStart(2,"0")}:${String(a).padStart(2,"0")}`})(l)||"UTC"})(),C=e=>e?"function"==typeof n.dateI18n?(0,n.dateI18n)(h,e):(0,n.format)(h,e):null,k=()=>(0,n.format)("Y-m-d\\TH:i:s",new Date),w=e=>{if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t},A=[{label:(0,r.__)("Visible sur tous les appareils","visi-bloc-jlg"),value:"all"},{label:(0,r.__)("--- Afficher uniquement sur ---","visi-bloc-jlg"),value:"separator-show",disabled:!0},{label:(0,r.__)("Desktop Uniquement","visi-bloc-jlg"),value:"desktop-only"},{label:(0,r.__)("Tablette Uniquement","visi-bloc-jlg"),value:"tablet-only"},{label:(0,r.__)("Mobile Uniquement","visi-bloc-jlg"),value:"mobile-only"},{label:(0,r.__)("--- Cacher sur ---","visi-bloc-jlg"),value:"separator-hide",disabled:!0},{label:(0,r.__)("CachÃ© sur Desktop","visi-bloc-jlg"),value:"hide-on-desktop"},{label:(0,r.__)("CachÃ© sur Tablette","visi-bloc-jlg"),value:"hide-on-tablet"},{label:(0,r.__)("CachÃ© sur Mobile","visi-bloc-jlg"),value:"hide-on-mobile"}],S=new Map([["desktop-only",(0,r.__)("Desktop Uniquement","visi-bloc-jlg")],["tablet-only",(0,r.__)("Tablette Uniquement","visi-bloc-jlg")],["mobile-only",(0,r.__)("Mobile Uniquement","visi-bloc-jlg")],["hide-on-desktop",(0,r.__)("CachÃ© sur Desktop","visi-bloc-jlg")],["hide-on-tablet",(0,r.__)("CachÃ© sur Tablette","visi-bloc-jlg")],["hide-on-mobile",(0,r.__)("CachÃ© sur Mobile","visi-bloc-jlg")]]),T=new Map([["logged-in",(0,r.__)("Utilisateurs connectÃ©s","visi-bloc-jlg")],["logged-out",(0,r.__)("Visiteurs non connectÃ©s","visi-bloc-jlg")]]),B=(()=>{const e=new Map;if("object"==typeof VisiBlocData&&null!==VisiBlocData){const{roles:t}=VisiBlocData;t&&"object"==typeof t&&Object.entries(t).forEach(([t,l])=>{if("string"==typeof t&&t){const i="string"==typeof l&&l.trim()?l.trim():t;e.set(t,i)}})}return e})(),D=Object.freeze({schedule:"ðŸ—“ï¸",roles:"ðŸ‘¥",device:"ðŸ“±",advanced:"âš™ï¸"}),x=["post_type","taxonomy","template","recurring_schedule"],N=Object.freeze({logic:"AND",rules:[]}),V=Object.freeze({frequency:"daily",days:[],startTime:"08:00",endTime:"17:00"}),q=e=>{if("object"!=typeof VisiBlocData||null===VisiBlocData)return[];const t=VisiBlocData[e];return Array.isArray(t)?t:[]},$=(()=>{const e=q("daysOfWeek"),t=new Map;return e.forEach(e=>{e&&"object"==typeof e&&"string"==typeof e.value&&t.set(e.value,e.label||e.value)}),t})(),F=()=>`rule-${Math.random().toString(36).slice(2)}-${Date.now()}`,O=e=>{if(!Array.isArray(e)||!e.length)return"";const t=e.find(e=>e&&void 0!==e.value);if(!t)return"";const l=void 0===t.value||null===t.value?"":t.value;return String(l)},M=e=>{switch(e){case"taxonomy":return(()=>{const e=q("taxonomies").find(e=>e&&"string"==typeof e.slug);return{id:F(),type:"taxonomy",operator:"in",taxonomy:e?e.slug:"",terms:[]}})();case"template":return(()=>{const e=q("templates");return{id:F(),type:"template",operator:"is",value:O(e)}})();case"recurring_schedule":return{id:F(),type:"recurring_schedule",operator:"matches",...V};default:return(()=>{const e=q("postTypes");return{id:F(),type:"post_type",operator:"is",value:O(e)}})()}},H=e=>{if(!e||"object"!=typeof e)return null;const{type:t}=e;if(!x.includes(t))return null;const l={id:"string"==typeof e.id&&e.id?e.id:F(),type:t};return"post_type"===t?(l.operator="is_not"===e.operator?"is_not":"is",l.value="string"==typeof e.value?e.value:"",l):"taxonomy"===t?(l.operator="not_in"===e.operator?"not_in":"in",l.taxonomy="string"==typeof e.taxonomy?e.taxonomy:"",l.terms=Array.isArray(e.terms)?e.terms.map(e=>"string"==typeof e||"number"==typeof e?String(e):"").filter(Boolean):[],l):"template"===t?(l.operator="is_not"===e.operator?"is_not":"is",l.value="string"==typeof e.value?e.value:"",l):(l.operator="matches",l.frequency="weekly"===e.frequency?"weekly":"daily",l.days=Array.isArray(e.days)?e.days.map(e=>"string"==typeof e?e:"").filter(e=>$.has(e)):[],l.startTime="string"==typeof e.startTime?e.startTime:V.startTime,l.endTime="string"==typeof e.endTime?e.endTime:V.endTime,l)},R=e=>e&&"object"==typeof e?{logic:"OR"===e.logic?"OR":"AND",rules:Array.isArray(e.rules)?e.rules.map(H).filter(Boolean):[]}:{logic:N.logic,rules:[...N.rules]},z=(0,i.createHigherOrderComponent)(l=>i=>{if(!g(i.name))return(0,e.createElement)(l,{...i});const{attributes:n,setAttributes:s,isSelected:c}=i,{isHidden:u,deviceVisibility:d,isSchedulingEnabled:b,publishStartDate:m,publishEndDate:p,visibilityRoles:v,advancedVisibility:f}=n,y=R(f),_=e=>{const t=R({...y}),l=e(t)||t;s({advancedVisibility:R(l)})},h=(e,t)=>{const l=e?[...v,t]:v.filter(e=>e!==t);s({visibilityRoles:l})};let S=(0,r.__)("Aucune programmation.","visi-bloc-jlg");const T=(0,r.sprintf)((0,r.__)("Fuseau horaire : %s","visi-bloc-jlg"),E),B=w(m),D=w(p),N=b&&!!B&&!!D&&D.getTime()<B.getTime();if(b){const e=C(m),t=C(p);
/* translators: 1: Start date, 2: end date. */
S=e&&t?(0,r.sprintf)((0,r.__)("Du %s au %s.","visi-bloc-jlg"),e,t):e?(0,r.sprintf)((0,r.__)("Ã€ partir du %s.","visi-bloc-jlg"),e):t?(0,r.sprintf)((0,r.__)("Jusqu'au %s.","visi-bloc-jlg"),t):(0,r.__)("ActivÃ©e, mais sans date dÃ©finie.","visi-bloc-jlg"),N&&(S=(0,r.__)("Dates de programmation invalides.","visi-bloc-jlg"))}return(0,e.createElement)(t.Fragment,null,(0,e.createElement)(l,{...i}),c&&(0,e.createElement)(t.Fragment,null,(0,e.createElement)(o.BlockControls,null,(0,e.createElement)(a.ToolbarGroup,null,(0,e.createElement)(a.ToolbarButton,{icon:"visibility",label:(0,r.__)("Rendre visible","visi-bloc-jlg"),onClick:()=>s({isHidden:!1}),isActive:!1===u}),(0,e.createElement)(a.ToolbarButton,{icon:"hidden",label:(0,r.__)("Rendre cachÃ©","visi-bloc-jlg"),onClick:()=>s({isHidden:!0}),isActive:!0===u}))),(0,e.createElement)(o.InspectorControls,null,(0,e.createElement)(a.PanelBody,{title:(0,r.__)("ContrÃ´les de VisibilitÃ©","visi-bloc-jlg"),initialOpen:!0},(0,e.createElement)(a.SelectControl,{label:(0,r.__)("VisibilitÃ© par Appareil","visi-bloc-jlg"),value:d,options:A,onChange:e=>s({deviceVisibility:e})})),(0,e.createElement)(a.PanelBody,{title:(0,r.__)("Programmation","visi-bloc-jlg"),initialOpen:!1,className:"visi-bloc-panel-schedule"},(0,e.createElement)(a.ToggleControl,{label:(0,r.__)("Activer la programmation","visi-bloc-jlg"),checked:b,onChange:()=>s({isSchedulingEnabled:!b})}),b&&(0,e.createElement)("div",null,(0,e.createElement)("p",{style:{fontStyle:"italic",color:"#555"}},S),N&&(0,e.createElement)(a.Notice,{status:"error",isDismissible:!1},(0,r.__)("La date de fin doit Ãªtre postÃ©rieure Ã  la date de dÃ©but.","visi-bloc-jlg")),(0,e.createElement)("p",{style:{fontStyle:"italic",color:"#555"}},T),(0,e.createElement)(a.CheckboxControl,{label:(0,r.__)("DÃ©finir une date de dÃ©but","visi-bloc-jlg"),checked:!!m,onChange:e=>{s({publishStartDate:e?k():void 0})}}),!!m&&(0,e.createElement)("div",{className:"visi-bloc-datepicker-wrapper"},(0,e.createElement)(a.DateTimePicker,{currentDate:m,onChange:e=>s({publishStartDate:e}),is12Hour:j})),(0,e.createElement)(a.CheckboxControl,{label:(0,r.__)("DÃ©finir une date de fin","visi-bloc-jlg"),checked:!!p,onChange:e=>{s({publishEndDate:e?k():void 0})}}),!!p&&(0,e.createElement)("div",{className:"visi-bloc-datepicker-wrapper"},(0,e.createElement)(a.DateTimePicker,{currentDate:p,onChange:e=>s({publishEndDate:e}),is12Hour:j})))),(0,e.createElement)(a.PanelBody,{title:(0,r.__)("VisibilitÃ© par RÃ´le","visi-bloc-jlg"),initialOpen:!1},(0,e.createElement)("p",null,(0,r.__)("N'afficher que pour les rÃ´les sÃ©lectionnÃ©s. Laisser vide pour afficher Ã  tout le monde.","visi-bloc-jlg")),(0,e.createElement)(a.CheckboxControl,{label:(0,r.__)("Visiteurs DÃ©connectÃ©s","visi-bloc-jlg"),checked:v.includes("logged-out"),onChange:e=>h(e,"logged-out")}),(0,e.createElement)(a.CheckboxControl,{label:(0,r.__)("Utilisateurs ConnectÃ©s (tous)","visi-bloc-jlg"),checked:v.includes("logged-in"),onChange:e=>h(e,"logged-in")}),(0,e.createElement)("hr",null),Object.entries(VisiBlocData.roles||{}).sort(([,e],[,t])=>String(e).localeCompare(String(t))).map(([t,l])=>(0,e.createElement)(a.CheckboxControl,{key:t,label:l,checked:v.includes(t),onChange:e=>h(e,t)}))),(0,e.createElement)(a.PanelBody,{title:(0,r.__)("RÃ¨gles de visibilitÃ© avancÃ©es","visi-bloc-jlg"),initialOpen:!1},(0,e.createElement)(a.SelectControl,{label:(0,r.__)("Logique entre les rÃ¨gles","visi-bloc-jlg"),value:y.logic,options:[{value:"AND",label:(0,r.__)("Toutes les rÃ¨gles doivent Ãªtre vraies (ET)","visi-bloc-jlg")},{value:"OR",label:(0,r.__)("Au moins une rÃ¨gle doit Ãªtre vraie (OU)","visi-bloc-jlg")}],onChange:e=>_(t=>({...t,logic:"OR"===e?"OR":"AND"}))}),y.rules.map((t,l)=>((t,l)=>{const i=e=>{_(i=>{const o=[...i.rules];return o[l]=H({...t,...e}),{...i,rules:o}})},o=(0,e.createElement)(a.Flex,{align:"center",wrap:!0},(0,e.createElement)(a.FlexBlock,null,(0,e.createElement)(a.SelectControl,{label:(0,r.__)("Type de rÃ¨gle","visi-bloc-jlg"),value:t.type,options:[{value:"post_type",label:(0,r.__)("Type de contenu","visi-bloc-jlg")},{value:"taxonomy",label:(0,r.__)("Taxonomie","visi-bloc-jlg")},{value:"template",label:(0,r.__)("ModÃ¨le de page","visi-bloc-jlg")},{value:"recurring_schedule",label:(0,r.__)("Horaire rÃ©current","visi-bloc-jlg")}],onChange:e=>{x.includes(e)&&_(t=>{const i=[...t.rules],o=M(e);return i[l]=o,{...t,rules:i}})}})),(0,e.createElement)(a.FlexItem,null,(0,e.createElement)(a.Button,{isDestructive:!0,variant:"tertiary",onClick:()=>{_(e=>{const t=e.rules.filter((e,t)=>t!==l);return{...e,rules:t}})}},(0,r.__)("Supprimer","visi-bloc-jlg"))));if("post_type"===t.type){const l=q("postTypes").map(e=>({value:e.value,label:e.label}));return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},o,(0,e.createElement)(a.SelectControl,{label:(0,r.__)("Condition","visi-bloc-jlg"),value:t.operator,options:[{value:"is",label:(0,r.__)("Est","visi-bloc-jlg")},{value:"is_not",label:(0,r.__)("Nâ€™est pas","visi-bloc-jlg")}],onChange:e=>i({operator:e})}),(0,e.createElement)(a.SelectControl,{label:(0,r.__)("Type de contenu","visi-bloc-jlg"),value:t.value,options:l,onChange:e=>i({value:e})}))}if("taxonomy"===t.type){const l=q("taxonomies"),n=l.find(e=>e.slug===t.taxonomy),s=l.map(e=>({value:e.slug,label:e.label})),c=(n&&Array.isArray(n.terms)?n.terms:[]).map(e=>({value:e.value,label:e.label})),u=(e,l)=>{const o=String(l),a=e?[...t.terms,o]:t.terms.filter(e=>e!==o);i({terms:a})};return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},o,(0,e.createElement)(a.SelectControl,{label:(0,r.__)("Taxonomie","visi-bloc-jlg"),value:t.taxonomy,options:s,onChange:e=>i({taxonomy:e,terms:[]})}),(0,e.createElement)(a.SelectControl,{label:(0,r.__)("Condition","visi-bloc-jlg"),value:t.operator,options:[{value:"in",label:(0,r.__)("Inclut au moins un terme","visi-bloc-jlg")},{value:"not_in",label:(0,r.__)("Exclut tous les termes","visi-bloc-jlg")}],onChange:e=>i({operator:e})}),c.length>0?(0,e.createElement)("div",{className:"visibloc-advanced-rule__terms"},c.map(l=>(0,e.createElement)(a.CheckboxControl,{key:l.value,label:l.label,checked:t.terms.includes(l.value),onChange:e=>u(e,l.value)}))):(0,e.createElement)("p",{className:"components-help-text"},(0,r.__)("Aucun terme disponible pour cette taxonomie.","visi-bloc-jlg")))}if("template"===t.type){const l=q("templates").map(e=>({value:e.value,label:e.label}));return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},o,(0,e.createElement)(a.SelectControl,{label:(0,r.__)("Condition","visi-bloc-jlg"),value:t.operator,options:[{value:"is",label:(0,r.__)("Est","visi-bloc-jlg")},{value:"is_not",label:(0,r.__)("Nâ€™est pas","visi-bloc-jlg")}],onChange:e=>i({operator:e})}),(0,e.createElement)(a.SelectControl,{label:(0,r.__)("ModÃ¨le","visi-bloc-jlg"),value:t.value,options:l,onChange:e=>i({value:e})}))}const n=e=>t=>{const l=t&&t.target?t.target.value:"",o="string"==typeof l?l:"";i({[e]:o})};return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},o,(0,e.createElement)(a.SelectControl,{label:(0,r.__)("FrÃ©quence","visi-bloc-jlg"),value:t.frequency,options:[{value:"daily",label:(0,r.__)("Quotidien","visi-bloc-jlg")},{value:"weekly",label:(0,r.__)("Hebdomadaire","visi-bloc-jlg")}],onChange:e=>i({frequency:e,days:"weekly"===e?t.days:[]})}),(0,e.createElement)(a.Flex,{gap:"small"},(0,e.createElement)(a.FlexBlock,null,(0,e.createElement)(a.BaseControl,{label:(0,r.__)("Heure de dÃ©but","visi-bloc-jlg")},(0,e.createElement)("input",{type:"time",value:t.startTime||"",onChange:n("startTime"),className:"components-text-control__input"}))),(0,e.createElement)(a.FlexBlock,null,(0,e.createElement)(a.BaseControl,{label:(0,r.__)("Heure de fin","visi-bloc-jlg")},(0,e.createElement)("input",{type:"time",value:t.endTime||"",onChange:n("endTime"),className:"components-text-control__input"})))),"weekly"===t.frequency&&$.size>0&&(0,e.createElement)("div",{className:"visibloc-advanced-rule__days"},(0,e.createElement)("p",{className:"components-base-control__label"},(0,r.__)("Jours actifs","visi-bloc-jlg")),Array.from($.entries()).map(([l,o])=>(0,e.createElement)(a.CheckboxControl,{key:l,label:o,checked:t.days.includes(l),onChange:e=>((e,l)=>{const o=e?[...new Set([...t.days,l])]:t.days.filter(e=>e!==l);i({days:o})})(e,l)}))))})(t,l)),(0,e.createElement)(a.Button,{variant:"secondary",onClick:()=>_(e=>({...e,rules:[...e.rules,M("post_type")]}))},(0,r.__)("Ajouter une rÃ¨gle","visi-bloc-jlg")),(0,e.createElement)("p",{className:"components-help-text"},(0,r.__)("Ces rÃ¨gles permettent dâ€™affiner la visibilitÃ© selon le contexte du contenu, le modÃ¨le ou un horaire rÃ©current.","visi-bloc-jlg"))))))},"withVisibilityControls"),P=e=>{if("string"!=typeof e)return null;const t=e.trim();if(!t||"all"===t||t.startsWith("separator"))return null;const l="string"!=typeof(i=t)?"":i.toLowerCase().trim().replace(/[^a-z0-9-]+/g,"-").replace(/-{2,}/g,"-").replace(/^-+|-+$/g,"");var i;return l?{className:`vb-device-${l}`,sanitized:l,label:S.get(t)||t}:null},U=e=>"string"==typeof e&&e?T.has(e)?T.get(e):B.has(e)?B.get(e):e:"",I=(e={})=>{const t=new Set,l=[],i={};e&&e.isHidden?(t.add("bloc-editeur-cache"),i["data-visibloc-label"]=(0,r.__)("Bloc masquÃ©","visi-bloc-jlg")):i["data-visibloc-label"]=void 0;const o=P(e.deviceVisibility);o&&(t.add(o.className),l.push(`${D.device} ${(0,r.sprintf)((0,r.__)("Appareil : %s","visi-bloc-jlg"),o.label)}`));const a=(e=>{if(!Array.isArray(e)||!e.length)return null;const t=Array.from(new Set(e.map(e=>"string"==typeof e?e.trim():"").filter(Boolean)));if(!t.length)return null;const l=t.map(U).map(e=>"string"==typeof e?e.trim():"").filter(Boolean);return l.length?(0,r.sprintf)((0,r.__)("RÃ´les : %s","visi-bloc-jlg"),l.join(", ")):(0,r.__)("VisibilitÃ© par rÃ´le activÃ©e","visi-bloc-jlg")})(e.visibilityRoles);a&&(t.add("bloc-editeur-role"),l.push(`${D.roles} ${a}`));const n=(e=>{if(!e||"object"!=typeof e)return null;const{isSchedulingEnabled:t,publishStartDate:l,publishEndDate:i}=e;if(!t)return null;const o=C(l),a=C(i),n=w(l),s=w(i);return n&&s&&s.getTime()<n.getTime()?(0,r.__)("Programmation invalide","visi-bloc-jlg"):o&&a?(0,r.sprintf)((0,r.__)("Programmation : %1$s â†’ %2$s","visi-bloc-jlg"),o,a):o?(0,r.sprintf)((0,r.__)("Programmation : Ã  partir du %s","visi-bloc-jlg"),o):a?(0,r.sprintf)((0,r.__)("Programmation : jusqu'au %s","visi-bloc-jlg"),a):(0,r.__)("Programmation activÃ©e","visi-bloc-jlg")})(e);n&&(t.add("bloc-editeur-programme"),l.push(`${D.schedule} ${n}`));const s=(e=>{const t=R(e);return t&&Array.isArray(t.rules)&&t.rules.length?(0,r.__)("RÃ¨gles avancÃ©es actives","visi-bloc-jlg"):null})(e.advancedVisibility);s&&(t.add("bloc-editeur-conditions"),l.push(`${D.advanced} ${s}`));const c=Array.from(t).filter(Boolean).sort(),u=l.join("\n");return i["data-visibloc-badges"]=u||void 0,{classes:c,badges:u,dataset:i,deviceInfo:o}},L=(e,t)=>{if(e===t)return!0;if(!e||!t)return!1;if(e.badges!==t.badges)return!1;if(e.classes.length!==t.classes.length)return!1;for(let l=0;l<e.classes.length;l+=1)if(e.classes[l]!==t.classes[l])return!1;return!0},W=new Map,G=new Map;let J=null;const Y=["bloc-editeur-","vb-device-"];function Q(){const e=(0,s.select)("core/edit-post");return!!e&&("function"==typeof e.isListViewOpened?e.isListViewOpened():"function"==typeof e.isFeatureActive&&e.isFeatureActive("listView"))}function K(){if("undefined"==typeof document)return void(J=null);const e=new Map;G.forEach((t,l)=>{const i=document.querySelector(`.block-editor-list-view__block[data-block="${l}"]`);i?((e,t)=>{if(!e||!t)return;const l=new Set(Array.isArray(t.classes)?t.classes:[]);Array.from(e.classList).forEach(t=>{Y.some(e=>t.startsWith(e))&&!l.has(t)&&e.classList.remove(t)}),t.classes.forEach(t=>{t&&e.classList.add(t)}),t.badges?e.setAttribute("data-visibloc-badges",t.badges):e.removeAttribute("data-visibloc-badges")})(i,t):e.set(l,t)}),G.clear(),e.size&&e.forEach((e,t)=>{G.set(t,e)}),J=G.size&&Q()?window.requestAnimationFrame(()=>{K()}):null}function X(e,t){t?L(G.get(e),t)||(G.set(e,t),J||(J=window.requestAnimationFrame(()=>{K()}))):G.delete(e)}(0,l.addFilter)("blocks.registerBlockType","visi-bloc-jlg/add-visibility-attributes",function(e,t){return g(t)?(e.attributes={...e.attributes,isHidden:{type:"boolean",default:!1},deviceVisibility:{type:"string",default:"all"},isSchedulingEnabled:{type:"boolean",default:!1},publishStartDate:{type:"string"},publishEndDate:{type:"string"},visibilityRoles:{type:"array",default:[]},advancedVisibility:{type:"object",default:N}},e):e}),(0,l.addFilter)("editor.BlockEdit","visi-bloc-jlg/with-visibility-controls",z),(0,l.addFilter)("blocks.getSaveContent.extraProps","visi-bloc-jlg/add-save-classes",function(e,t,l){if(!g(t.name)||!l)return e;const i=I(l),o="string"==typeof e.className?e.className.split(/\s+/).map(e=>e.trim()).filter(e=>e&&!Y.some(t=>e.startsWith(t))):[],a=new Set(o);i.classes.forEach(e=>{e&&a.add(e)});const r=i.deviceInfo?`vb-${i.deviceInfo.sanitized}`:(e=>{const t=P(e);return t?`vb-${t.sanitized}`:""})(l.deviceVisibility);return r&&a.add(r),{...e,className:Array.from(a).join(" ")}}),(0,l.addFilter)("editor.BlockListBlock.props","visi-bloc-jlg/add-editor-canvas-classes",function(e,t){if(!g(t.name)||!t.attributes)return e;const l=I(t.attributes),i="string"==typeof e.className?e.className.split(/\s+/).map(e=>e.trim()).filter(e=>e&&!Y.some(t=>e.startsWith(t))):[],o=new Set(i);l.classes.forEach(e=>{e&&o.add(e)});const a={...e,className:Array.from(o).join(" ")};return Object.entries(l.dataset).forEach(([e,t])=>{a[e]=t}),a});let Z=Q();(0,s.subscribe)(function(){const e=Q();!function(){const e=(0,s.select)("core/block-editor");if(!e)return;const t=e.getBlockOrder();if(!t.length)return;const l=[...t],i=new Set;for(;l.length;){const t=l.pop(),o=e.getBlock(t);if(o){if(g(o.name)){const e=I(o.attributes||{}),l=W.get(t);L(l,e)||X(t,e),W.set(t,e),i.add(t)}o.innerBlocks&&o.innerBlocks.length&&o.innerBlocks.forEach(e=>{e&&e.clientId&&l.push(e.clientId)})}}i.size!==W.size&&Array.from(W.keys()).forEach(e=>{i.has(e)||(W.delete(e),G.delete(e))})}(),e&&!Z&&function(){if(!G.size)return;const e=Array.from(G.entries());G.clear(),J&&(window.cancelAnimationFrame(J),J=null),e.forEach(([e,t])=>{X(e,t)})}(),Z=e})})();