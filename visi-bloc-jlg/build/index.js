(()=>{"use strict";const e=window.React,l=window.wp.element,i=window.wp.hooks,t=window.wp.compose,o=window.wp.blockEditor,a=window.wp.components,n=window.wp.i18n,s=window.wp.date,c=window.wp.data,r=[{label:(0,n.__)("Visible sur tous les appareils","visi-bloc-jlg"),value:"all"},{label:(0,n.__)("--- Afficher uniquement sur ---","visi-bloc-jlg"),value:"separator-show",disabled:!0},{label:(0,n.__)("Desktop Uniquement","visi-bloc-jlg"),value:"desktop-only"},{label:(0,n.__)("Tablette Uniquement","visi-bloc-jlg"),value:"tablet-only"},{label:(0,n.__)("Mobile Uniquement","visi-bloc-jlg"),value:"mobile-only"},{label:(0,n.__)("--- Cacher sur ---","visi-bloc-jlg"),value:"separator-hide",disabled:!0},{label:(0,n.__)("Caché sur Desktop","visi-bloc-jlg"),value:"hide-on-desktop"},{label:(0,n.__)("Caché sur Tablette","visi-bloc-jlg"),value:"hide-on-tablet"},{label:(0,n.__)("Caché sur Mobile","visi-bloc-jlg"),value:"hide-on-mobile"}],d=(0,t.createHigherOrderComponent)(i=>t=>{if("core/group"!==t.name)return(0,e.createElement)(i,{...t});const{attributes:c,setAttributes:d,isSelected:b}=t,{isHidden:u,deviceVisibility:g,isSchedulingEnabled:p,publishStartDate:v,publishEndDate:m,visibilityRoles:h}=c,_=(e,l)=>{const i=e?[...h,l]:h.filter(e=>e!==l);d({visibilityRoles:i})};let k=(0,n.__)("Aucune programmation.","visi-bloc-jlg");if(p){const e=v?(0,s.format)("d/m/Y H:i",v):null,l=m?(0,s.format)("d/m/Y H:i",m):null;k=e&&l?(0,n.sprintf)((0,n.__)("Du %s au %s.","visi-bloc-jlg"),e,l):e?(0,n.sprintf)((0,n.__)("À partir du %s.","visi-bloc-jlg"),e):l?(0,n.sprintf)((0,n.__)("Jusqu'au %s.","visi-bloc-jlg"),l):(0,n.__)("Activée, mais sans date définie.","visi-bloc-jlg")}return(0,e.createElement)(l.Fragment,null,(0,e.createElement)(i,{...t}),b&&(0,e.createElement)(l.Fragment,null,(0,e.createElement)(o.BlockControls,null,(0,e.createElement)(a.ToolbarGroup,null,(0,e.createElement)(a.ToolbarButton,{icon:"visibility",label:(0,n.__)("Rendre visible","visi-bloc-jlg"),onClick:()=>d({isHidden:!1}),isActive:!1===u}),(0,e.createElement)(a.ToolbarButton,{icon:"hidden",label:(0,n.__)("Rendre caché","visi-bloc-jlg"),onClick:()=>d({isHidden:!0}),isActive:!0===u}))),(0,e.createElement)(o.InspectorControls,null,(0,e.createElement)(a.PanelBody,{title:(0,n.__)("Contrôles de Visibilité","visi-bloc-jlg"),initialOpen:!0},(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Visibilité par Appareil","visi-bloc-jlg"),value:g,options:r,onChange:e=>d({deviceVisibility:e})})),(0,e.createElement)(a.PanelBody,{title:(0,n.__)("Programmation","visi-bloc-jlg"),initialOpen:!1,className:"visi-bloc-panel-schedule"},(0,e.createElement)(a.ToggleControl,{label:(0,n.__)("Activer la programmation","visi-bloc-jlg"),checked:p,onChange:()=>d({isSchedulingEnabled:!p})}),p&&(0,e.createElement)("div",null,(0,e.createElement)("p",{style:{fontStyle:"italic",color:"#555"}},k),(0,e.createElement)(a.CheckboxControl,{label:(0,n.__)("Définir une date de début","visi-bloc-jlg"),checked:!!v,onChange:e=>{d({publishStartDate:e?(new Date).toISOString():void 0})}}),!!v&&(0,e.createElement)("div",{className:"visi-bloc-datepicker-wrapper"},(0,e.createElement)(a.DateTimePicker,{currentDate:v,onChange:e=>d({publishStartDate:e}),is12Hour:!1})),(0,e.createElement)(a.CheckboxControl,{label:(0,n.__)("Définir une date de fin","visi-bloc-jlg"),checked:!!m,onChange:e=>{d({publishEndDate:e?(new Date).toISOString():void 0})}}),!!m&&(0,e.createElement)("div",{className:"visi-bloc-datepicker-wrapper"},(0,e.createElement)(a.DateTimePicker,{currentDate:m,onChange:e=>d({publishEndDate:e}),is12Hour:!1})))),(0,e.createElement)(a.PanelBody,{title:(0,n.__)("Visibilité par Rôle","visi-bloc-jlg"),initialOpen:!1},(0,e.createElement)("p",null,(0,n.__)("N'afficher que pour les rôles sélectionnés. Laisser vide pour afficher à tout le monde.","visi-bloc-jlg")),(0,e.createElement)(a.CheckboxControl,{label:(0,n.__)("Visiteurs Déconnectés","visi-bloc-jlg"),checked:h.includes("logged-out"),onChange:e=>_(e,"logged-out")}),(0,e.createElement)(a.CheckboxControl,{label:(0,n.__)("Utilisateurs Connectés (tous)","visi-bloc-jlg"),checked:h.includes("logged-in"),onChange:e=>_(e,"logged-in")}),(0,e.createElement)("hr",null),Object.entries(VisiBlocData.roles).map(([l,i])=>(0,e.createElement)(a.CheckboxControl,{key:l,label:i,checked:h.includes(l),onChange:e=>_(e,l)}))))))},"withVisibilityControls");(0,i.addFilter)("blocks.registerBlockType","visi-bloc-jlg/add-visibility-attributes",function(e,l){return"core/group"!==l||(e.attributes={...e.attributes,isHidden:{type:"boolean",default:!1},deviceVisibility:{type:"string",default:"all"},isSchedulingEnabled:{type:"boolean",default:!1},publishStartDate:{type:"string"},publishEndDate:{type:"string"},visibilityRoles:{type:"array",default:[]}}),e}),(0,i.addFilter)("editor.BlockEdit","visi-bloc-jlg/with-visibility-controls",d),(0,i.addFilter)("blocks.getSaveContent.extraProps","visi-bloc-jlg/add-save-classes",function(e,l,i){if("core/group"!==l.name||!i)return e;const{deviceVisibility:t}=i,o=[e.className,t&&"all"!==t?`vb-${t}`:""].filter(Boolean).join(" ");return{...e,className:o}}),(0,i.addFilter)("editor.BlockListBlock.props","visi-bloc-jlg/add-editor-canvas-classes",function(e,l){if("core/group"!==l.name||!l.attributes)return e;const{isHidden:i}=l.attributes,t=[e.className,i?"bloc-editeur-cache":""].filter(Boolean).join(" ");return{...e,className:t}}),(0,c.subscribe)(function(){const{getBlockOrder:e}=(0,c.select)("core/block-editor"),l=e();l.length&&l.forEach(e=>{const l=(0,c.select)("core/block-editor").getBlock(e);if(!l||"core/group"!==l.name)return;const i=document.querySelector(`.block-editor-list-view__block[data-block="${e}"]`);i&&(l.attributes.isHidden?i.classList.add("bloc-editeur-cache"):i.classList.remove("bloc-editeur-cache"))})})})();