(()=>{"use strict";const e=window.React,i=window.wp.element,t=window.wp.hooks,l=window.wp.compose,n=window.wp.blockEditor,o=window.wp.components,a=window.wp.i18n,s=window.wp.date,r=window.wp.data,c="function"==typeof s.__experimentalGetSettings?(0,s.__experimentalGetSettings)():{},{formats:d={}}=c||{},u="string"==typeof d.date&&d.date.trim()?d.date:"F j, Y",b="string"==typeof d.time&&d.time.trim()?d.time:"H:i",p="string"==typeof d.datetime&&d.datetime.trim()?d.datetime:`${u} ${b}`.trim(),m=e=>e?"function"==typeof s.dateI18n?(0,s.dateI18n)(p,e):(0,s.format)(p,e):null,g=()=>(0,s.format)("Y-m-d\\TH:i:s",new Date),v=[{label:(0,a.__)("Visible sur tous les appareils","visi-bloc-jlg"),value:"all"},{label:(0,a.__)("--- Afficher uniquement sur ---","visi-bloc-jlg"),value:"separator-show",disabled:!0},{label:(0,a.__)("Desktop Uniquement","visi-bloc-jlg"),value:"desktop-only"},{label:(0,a.__)("Tablette Uniquement","visi-bloc-jlg"),value:"tablet-only"},{label:(0,a.__)("Mobile Uniquement","visi-bloc-jlg"),value:"mobile-only"},{label:(0,a.__)("--- Cacher sur ---","visi-bloc-jlg"),value:"separator-hide",disabled:!0},{label:(0,a.__)("Caché sur Desktop","visi-bloc-jlg"),value:"hide-on-desktop"},{label:(0,a.__)("Caché sur Tablette","visi-bloc-jlg"),value:"hide-on-tablet"},{label:(0,a.__)("Caché sur Mobile","visi-bloc-jlg"),value:"hide-on-mobile"}],f=(0,l.createHigherOrderComponent)(t=>l=>{if("core/group"!==l.name)return(0,e.createElement)(t,{...l});const{attributes:s,setAttributes:r,isSelected:c}=l,{isHidden:d,deviceVisibility:u,isSchedulingEnabled:b,publishStartDate:p,publishEndDate:f,visibilityRoles:h}=s,_=(e,i)=>{const t=e?[...h,i]:h.filter(e=>e!==i);r({visibilityRoles:t})};let w=(0,a.__)("Aucune programmation.","visi-bloc-jlg");if(b){const e=m(p),i=m(f);
/* translators: 1: Start date, 2: end date. */
w=e&&i?(0,a.sprintf)((0,a.__)("Du %s au %s.","visi-bloc-jlg"),e,i):e?(0,a.sprintf)((0,a.__)("À partir du %s.","visi-bloc-jlg"),e):i?(0,a.sprintf)((0,a.__)("Jusqu'au %s.","visi-bloc-jlg"),i):(0,a.__)("Activée, mais sans date définie.","visi-bloc-jlg")}return(0,e.createElement)(i.Fragment,null,(0,e.createElement)(t,{...l}),c&&(0,e.createElement)(i.Fragment,null,(0,e.createElement)(n.BlockControls,null,(0,e.createElement)(o.ToolbarGroup,null,(0,e.createElement)(o.ToolbarButton,{icon:"visibility",label:(0,a.__)("Rendre visible","visi-bloc-jlg"),onClick:()=>r({isHidden:!1}),isActive:!1===d}),(0,e.createElement)(o.ToolbarButton,{icon:"hidden",label:(0,a.__)("Rendre caché","visi-bloc-jlg"),onClick:()=>r({isHidden:!0}),isActive:!0===d}))),(0,e.createElement)(n.InspectorControls,null,(0,e.createElement)(o.PanelBody,{title:(0,a.__)("Contrôles de Visibilité","visi-bloc-jlg"),initialOpen:!0},(0,e.createElement)(o.SelectControl,{label:(0,a.__)("Visibilité par Appareil","visi-bloc-jlg"),value:u,options:v,onChange:e=>r({deviceVisibility:e})})),(0,e.createElement)(o.PanelBody,{title:(0,a.__)("Programmation","visi-bloc-jlg"),initialOpen:!1,className:"visi-bloc-panel-schedule"},(0,e.createElement)(o.ToggleControl,{label:(0,a.__)("Activer la programmation","visi-bloc-jlg"),checked:b,onChange:()=>r({isSchedulingEnabled:!b})}),b&&(0,e.createElement)("div",null,(0,e.createElement)("p",{style:{fontStyle:"italic",color:"#555"}},w),(0,e.createElement)(o.CheckboxControl,{label:(0,a.__)("Définir une date de début","visi-bloc-jlg"),checked:!!p,onChange:e=>{r({publishStartDate:e?g():void 0})}}),!!p&&(0,e.createElement)("div",{className:"visi-bloc-datepicker-wrapper"},(0,e.createElement)(o.DateTimePicker,{currentDate:p,onChange:e=>r({publishStartDate:e}),is12Hour:!1})),(0,e.createElement)(o.CheckboxControl,{label:(0,a.__)("Définir une date de fin","visi-bloc-jlg"),checked:!!f,onChange:e=>{r({publishEndDate:e?g():void 0})}}),!!f&&(0,e.createElement)("div",{className:"visi-bloc-datepicker-wrapper"},(0,e.createElement)(o.DateTimePicker,{currentDate:f,onChange:e=>r({publishEndDate:e}),is12Hour:!1})))),(0,e.createElement)(o.PanelBody,{title:(0,a.__)("Visibilité par Rôle","visi-bloc-jlg"),initialOpen:!1},(0,e.createElement)("p",null,(0,a.__)("N'afficher que pour les rôles sélectionnés. Laisser vide pour afficher à tout le monde.","visi-bloc-jlg")),(0,e.createElement)(o.CheckboxControl,{label:(0,a.__)("Visiteurs Déconnectés","visi-bloc-jlg"),checked:h.includes("logged-out"),onChange:e=>_(e,"logged-out")}),(0,e.createElement)(o.CheckboxControl,{label:(0,a.__)("Utilisateurs Connectés (tous)","visi-bloc-jlg"),checked:h.includes("logged-in"),onChange:e=>_(e,"logged-in")}),(0,e.createElement)("hr",null),Object.entries(VisiBlocData.roles).map(([i,t])=>(0,e.createElement)(o.CheckboxControl,{key:i,label:t,checked:h.includes(i),onChange:e=>_(e,i)}))))))},"withVisibilityControls"),h=new Map,_=new Map;let w=null;function k(){const e=(0,r.select)("core/edit-post");return!!e&&("function"==typeof e.isListViewOpened?e.isListViewOpened():"function"==typeof e.isFeatureActive&&e.isFeatureActive("listView"))}function E(){if("undefined"==typeof document)return void(w=null);const e=new Map;_.forEach((i,t)=>{const l=document.querySelector(`.block-editor-list-view__block[data-block="${t}"]`);l?i?l.classList.add("bloc-editeur-cache"):l.classList.remove("bloc-editeur-cache"):e.set(t,i)}),_.clear(),e.size&&e.forEach((e,i)=>{_.set(i,e)}),w=_.size&&k()?window.requestAnimationFrame(()=>{E()}):null}function y(e,i){_.get(e)!==i&&(_.set(e,i),w||(w=window.requestAnimationFrame(()=>{E()})))}(0,t.addFilter)("blocks.registerBlockType","visi-bloc-jlg/add-visibility-attributes",function(e,i){return"core/group"!==i||(e.attributes={...e.attributes,isHidden:{type:"boolean",default:!1},deviceVisibility:{type:"string",default:"all"},isSchedulingEnabled:{type:"boolean",default:!1},publishStartDate:{type:"string"},publishEndDate:{type:"string"},visibilityRoles:{type:"array",default:[]}}),e}),(0,t.addFilter)("editor.BlockEdit","visi-bloc-jlg/with-visibility-controls",f),(0,t.addFilter)("blocks.getSaveContent.extraProps","visi-bloc-jlg/add-save-classes",function(e,i,t){if("core/group"!==i.name||!t)return e;const{deviceVisibility:l}=t,n=[e.className,l&&"all"!==l?`vb-${l}`:""].filter(Boolean).join(" ");return{...e,className:n}}),(0,t.addFilter)("editor.BlockListBlock.props","visi-bloc-jlg/add-editor-canvas-classes",function(e,i){if("core/group"!==i.name||!i.attributes)return e;const{isHidden:t}=i.attributes,l=[e.className,t?"bloc-editeur-cache":""].filter(Boolean).join(" ");return{...e,className:l}});let j=k();(0,r.subscribe)(function(){const e=k();!function(){const e=(0,r.select)("core/block-editor");if(!e)return;const i=e.getBlockOrder();if(!i.length)return;const t=[...i],l=new Set;for(;t.length;){const i=t.pop(),n=e.getBlock(i);if(n){if("core/group"===n.name){const e=Boolean(n.attributes.isHidden);h.get(i)!==e&&y(i,e),h.set(i,e),l.add(i)}n.innerBlocks&&n.innerBlocks.length&&n.innerBlocks.forEach(e=>{e&&e.clientId&&t.push(e.clientId)})}}l.size!==h.size&&Array.from(h.keys()).forEach(e=>{l.has(e)||(h.delete(e),_.delete(e))})}(),e&&!j&&function(){if(!_.size)return;const e=Array.from(_.entries());_.clear(),w&&(window.cancelAnimationFrame(w),w=null),e.forEach(([e,i])=>{y(e,i)})}(),j=e})})();