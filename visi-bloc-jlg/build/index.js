(()=>{var e={124:(e,t,l)=>{var i=l(325);e.exports=function(){return i.Date.now()}},128:(e,t,l)=>{var i=l(800),r=/^\s+/;e.exports=function(e){return e?e.slice(0,i(e)+1).replace(r,""):e}},221:(e,t,l)=>{var i=l(805),r=l(124),o=l(374),a=Math.max,n=Math.min;e.exports=function(e,t,l){var s,c,u,d,m,b,p=0,v=!1,g=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function _(t){var l=s,i=c;return s=c=void 0,p=t,d=e.apply(i,l)}function y(e){var l=e-b;return void 0===b||l>=t||l<0||g&&e-p>=u}function h(){var e=r();if(y(e))return j(e);m=setTimeout(h,function(e){var l=t-(e-b);return g?n(l,u-(e-p)):l}(e))}function j(e){return m=void 0,f&&s?_(e):(s=c=void 0,d)}function E(){var e=r(),l=y(e);if(s=arguments,c=this,b=e,l){if(void 0===m)return function(e){return p=e,m=setTimeout(h,t),v?_(e):d}(b);if(g)return clearTimeout(m),m=setTimeout(h,t),_(b)}return void 0===m&&(m=setTimeout(h,t)),d}return t=o(t)||0,i(l)&&(v=!!l.leading,u=(g="maxWait"in l)?a(o(l.maxWait)||0,t):u,f="trailing"in l?!!l.trailing:f),E.cancel=function(){void 0!==m&&clearTimeout(m),p=0,s=b=c=m=void 0},E.flush=function(){return void 0===m?d:j(r())},E}},325:(e,t,l)=>{var i=l(840),r="object"==typeof self&&self&&self.Object===Object&&self,o=i||r||Function("return this")();e.exports=o},346:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},350:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},374:(e,t,l)=>{var i=l(128),r=l(805),o=l(394),a=/^[-+]0x[0-9a-f]+$/i,n=/^0b[01]+$/i,s=/^0o[0-7]+$/i,c=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return NaN;if(r(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=r(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=i(e);var l=n.test(e);return l||s.test(e)?c(e.slice(2),l?2:8):a.test(e)?NaN:+e}},394:(e,t,l)=>{var i=l(552),r=l(346);e.exports=function(e){return"symbol"==typeof e||r(e)&&"[object Symbol]"==i(e)}},552:(e,t,l)=>{var i=l(873),r=l(659),o=l(350),a=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?r(e):o(e)}},659:(e,t,l)=>{var i=l(873),r=Object.prototype,o=r.hasOwnProperty,a=r.toString,n=i?i.toStringTag:void 0;e.exports=function(e){var t=o.call(e,n),l=e[n];try{e[n]=void 0;var i=!0}catch(e){}var r=a.call(e);return i&&(t?e[n]=l:delete e[n]),r}},800:e=>{var t=/\s/;e.exports=function(e){for(var l=e.length;l--&&t.test(e.charAt(l)););return l}},805:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},840:(e,t,l)=>{var i="object"==typeof l.g&&l.g&&l.g.Object===Object&&l.g;e.exports=i},873:(e,t,l)=>{var i=l(325).Symbol;e.exports=i}},t={};function l(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,l),o.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var i in t)l.o(t,i)&&!l.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.React,t=window.wp.element,i=window.wp.hooks,r=window.wp.compose,o=window.wp.blockEditor,a=window.wp.components,n=window.wp.i18n,s=window.wp.date,c=window.wp.apiFetch;var u=l.n(c);const d=window.wp.data,m=window.wp.autop;var b=l.n(m),p=l(221),v=l.n(p);const g=window.wp.htmlEntities,f=window.wp.url,_=["core/group"],y=()=>(0,e.createElement)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",role:"presentation",focusable:"false","aria-hidden":"true"},(0,e.createElement)("rect",{x:"7",y:"3",width:"10",height:"18",rx:"2",ry:"2",fill:"currentColor",opacity:"0.2"}),(0,e.createElement)("rect",{x:"9",y:"5",width:"6",height:"14",rx:"1.2",ry:"1.2",fill:"none",stroke:"currentColor",strokeWidth:"1.5"}),(0,e.createElement)("circle",{cx:"12",cy:"17.5",r:"0.9",fill:"currentColor"})),h=()=>(0,e.createElement)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",role:"presentation",focusable:"false","aria-hidden":"true"},(0,e.createElement)("rect",{x:"3",y:"7",width:"18",height:"10",rx:"2",ry:"2",fill:"currentColor",opacity:"0.2"}),(0,e.createElement)("rect",{x:"5",y:"9",width:"14",height:"6",rx:"1.2",ry:"1.2",fill:"none",stroke:"currentColor",strokeWidth:"1.5"}),(0,e.createElement)("circle",{cx:"17.5",cy:"12",r:"0.9",fill:"currentColor"})),j=()=>(0,e.createElement)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",role:"presentation",focusable:"false","aria-hidden":"true"},(0,e.createElement)("path",{d:"m12 4 8 14H4z",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinejoin:"round"}),(0,e.createElement)("path",{d:"M12 10v4",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round"}),(0,e.createElement)("circle",{cx:"12",cy:"17",r:"1",fill:"currentColor"})),E={hidden:()=>(0,e.createElement)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",role:"presentation",focusable:"false","aria-hidden":"true"},(0,e.createElement)("path",{d:"M2 12c2.8-5.3 6.5-8 10-8s7.2 2.7 10 8c-2.8 5.3-6.5 8-10 8s-7.2-2.7-10-8z",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinejoin:"round"}),(0,e.createElement)("circle",{cx:"12",cy:"12",r:"3",fill:"currentColor",opacity:"0.2"}),(0,e.createElement)("path",{d:"M12 9a3 3 0 0 1 3 3m6.5 6.5-17-17",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"})),schedule:()=>(0,e.createElement)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",role:"presentation",focusable:"false","aria-hidden":"true"},(0,e.createElement)("circle",{cx:"12",cy:"12",r:"7.5",fill:"none",stroke:"currentColor",strokeWidth:"1.6"}),(0,e.createElement)("path",{d:"M12 8.5v4l2.5 2",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})),"schedule-error":()=>(0,e.createElement)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",role:"presentation",focusable:"false","aria-hidden":"true"},(0,e.createElement)("circle",{cx:"11",cy:"11",r:"7",fill:"none",stroke:"currentColor",strokeWidth:"1.6"}),(0,e.createElement)("path",{d:"M11 7.5v3.7l2.1 1.6",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),(0,e.createElement)("path",{d:"M17.5 13.5v3.5",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"}),(0,e.createElement)("circle",{cx:"17.5",cy:"18.5",r:"0.8",fill:"currentColor"})),fallback:()=>(0,e.createElement)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",role:"presentation",focusable:"false","aria-hidden":"true"},(0,e.createElement)("path",{d:"M5.5 9.5 12 6l6.5 3.5L12 13z",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinejoin:"round"}),(0,e.createElement)("path",{d:"M5.5 14.5 12 18l6.5-3.5",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinejoin:"round"})),advanced:()=>(0,e.createElement)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",role:"presentation",focusable:"false","aria-hidden":"true"},(0,e.createElement)("path",{d:"M7 5v14M17 5v14",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"}),(0,e.createElement)("circle",{cx:"7",cy:"10",r:"2.5",fill:"currentColor",opacity:"0.2",stroke:"currentColor",strokeWidth:"1.2"}),(0,e.createElement)("circle",{cx:"17",cy:"14",r:"2.5",fill:"currentColor",opacity:"0.2",stroke:"currentColor",strokeWidth:"1.2"})),conditional:j,warning:j,success:()=>(0,e.createElement)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",role:"presentation",focusable:"false","aria-hidden":"true"},(0,e.createElement)("circle",{cx:"12",cy:"12",r:"7.5",fill:"none",stroke:"currentColor",strokeWidth:"1.6"}),(0,e.createElement)("path",{d:"m8.8 12.4 2.3 2.3 4-4.7",fill:"none",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round"})),default:()=>(0,e.createElement)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",role:"presentation",focusable:"false","aria-hidden":"true"},(0,e.createElement)("circle",{cx:"12",cy:"12",r:"8",fill:"none",stroke:"currentColor",strokeWidth:"1.6"}),(0,e.createElement)("circle",{cx:"12",cy:"8.5",r:"1",fill:"currentColor"}),(0,e.createElement)("path",{d:"M11 11.5h2v6",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"}))},k=({label:t,variant:l="",screenReaderText:i="",description:r=""})=>{const o=["visibloc-status-badge"],n="string"==typeof r&&r.trim().length>0,s="string"==typeof l?l.trim():"";s&&o.push(`visibloc-status-badge--${s}`);const c=E[s]||E.default,u=(0,e.createElement)("span",{className:o.join(" ")},c?(0,e.createElement)("span",{className:"visibloc-status-badge__icon","aria-hidden":"true"},(0,e.createElement)(c,null)):null,(0,e.createElement)("span",{className:"visibloc-status-badge__label"},t),n?(0,e.createElement)("span",{className:"visibloc-status-badge__description"},r):null,i?(0,e.createElement)("span",{className:"screen-reader-text"},i):null);return n?(0,e.createElement)(a.Tooltip,{text:r},u):u},C=e=>Array.isArray(e)?Array.from(new Set(e.map(e=>"string"==typeof e?e.trim():"").filter(Boolean))):[],x=C("object"==typeof VisiBlocData&&null!==VisiBlocData&&Array.isArray(VisiBlocData.supportedBlocks)?VisiBlocData.supportedBlocks:_),A=x.length>0?x:_,w=C((0,i.applyFilters)("visiblocSupportedBlocks",A)),N=w.length>0?w:A,S=e=>N.includes(e),B="function"==typeof s.__experimentalGetSettings?(0,s.__experimentalGetSettings)():{},{formats:T={}}=B||{},D="string"==typeof T.date&&T.date.trim()?T.date:"F j, Y",R="string"==typeof T.time&&T.time.trim()?T.time:"H:i",M="string"==typeof T.datetime&&T.datetime.trim()?T.datetime:`${D} ${R}`.trim(),q=(e=>{if(!e||"object"!=typeof e)return!1;if("boolean"==typeof e.twelveHourTime)return e.twelveHourTime;const{formats:t}=e;if(t&&"object"==typeof t){const{time:e}=t;if("string"==typeof e&&e.trim())return/a(?!\\)/i.test(e)}return!1})(B),V=(()=>{if(!B||"object"!=typeof B)return"UTC";const{timezone:e,timezoneAbbr:t,gmt_offset:l}=B;if(e&&"object"==typeof e){if("string"==typeof e.string&&e.string.trim())return e.string.trim();if("string"==typeof e.abbr&&e.abbr.trim())return e.abbr.trim()}if("string"==typeof e&&e.trim())return e.trim();if("string"==typeof t&&t.trim())return t.trim();return(e=>{if("number"!=typeof e||Number.isNaN(e))return"";if(0===e)return"UTC";const t=e>0?"+":"-",l=Math.abs(e),i=Math.round(60*l),r=Math.floor(i/60),o=i%60;return`UTC${t}${String(r).padStart(2,"0")}:${String(o).padStart(2,"0")}`})(l)||"UTC"})(),F=e=>e?"function"==typeof s.dateI18n?(0,s.dateI18n)(M,e):(0,s.format)(M,e):null,H=()=>(0,s.format)("Y-m-d\\TH:i:s",new Date),L=e=>{if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t},z={id:"all",label:(0,n.__)("Visible sur tous les appareils","visi-bloc-jlg")},O=[{id:"show-only",label:(0,n.__)("Afficher uniquement","visi-bloc-jlg"),options:[{id:"desktop-only",label:(0,n.__)("Desktop","visi-bloc-jlg"),icon:"desktop"},{id:"tablet-only",label:(0,n.__)("Tablette","visi-bloc-jlg"),icon:"tablet"},{id:"mobile-only",label:(0,n.__)("Mobile","visi-bloc-jlg"),icon:"smartphone"}]},{id:"hide-on",label:(0,n.__)("Masquer sur","visi-bloc-jlg"),options:[{id:"hide-on-desktop",label:(0,n.__)("Desktop","visi-bloc-jlg"),icon:"desktop"},{id:"hide-on-tablet",label:(0,n.__)("Tablette","visi-bloc-jlg"),icon:"tablet"},{id:"hide-on-mobile",label:(0,n.__)("Mobile","visi-bloc-jlg"),icon:"smartphone"}]},{id:"orientation-show",label:(0,n.__)("Orientation ciblée","visi-bloc-jlg"),options:[{id:"portrait-only",label:(0,n.__)("Portrait","visi-bloc-jlg"),icon:y},{id:"landscape-only",label:(0,n.__)("Paysage","visi-bloc-jlg"),icon:h}]},{id:"orientation-hide",label:(0,n.__)("Masquer en orientation","visi-bloc-jlg"),options:[{id:"hide-on-portrait",label:(0,n.__)("Portrait","visi-bloc-jlg"),icon:y},{id:"hide-on-landscape",label:(0,n.__)("Paysage","visi-bloc-jlg"),icon:h}]}],$=O.reduce((e,t)=>t&&Array.isArray(t.options)?e.concat(t.options):e,[]),I=["post_type","taxonomy","template","recurring_schedule","logged_in_status","user_role_group","user_segment","woocommerce_cart","query_param","cookie","visit_count"],P=[{value:"post_type",label:(0,n.__)("Type de contenu","visi-bloc-jlg")},{value:"taxonomy",label:(0,n.__)("Taxonomie","visi-bloc-jlg")},{value:"template",label:(0,n.__)("Modèle de page","visi-bloc-jlg")},{value:"recurring_schedule",label:(0,n.__)("Horaire récurrent","visi-bloc-jlg")},{value:"logged_in_status",label:(0,n.__)("État de connexion","visi-bloc-jlg")},{value:"user_role_group",label:(0,n.__)("Groupe de rôles","visi-bloc-jlg")},{value:"user_segment",label:(0,n.__)("Segment marketing","visi-bloc-jlg")},{value:"woocommerce_cart",label:(0,n.__)("Panier WooCommerce","visi-bloc-jlg")},{value:"query_param",label:(0,n.__)("Paramètre d’URL","visi-bloc-jlg")},{value:"cookie",label:(0,n.__)("Cookie","visi-bloc-jlg")},{value:"visit_count",label:(0,n.__)("Compteur de visites","visi-bloc-jlg")}],W=Object.freeze({logic:"AND",rules:[],savedGroups:[]}),G=Object.freeze({frequency:"daily",days:[],startTime:"08:00",endTime:"17:00"}),U="site",J=e=>{if("object"!=typeof VisiBlocData||null===VisiBlocData)return[];const t=VisiBlocData[e];return Array.isArray(t)?t:[]},Q=e=>{if("object"!=typeof VisiBlocData||null===VisiBlocData)return null;const t=VisiBlocData[e];return t&&"object"==typeof t?t:null},Y=e=>{if("string"!=typeof e)return"";const t=e.trim();if(!t)return"";if("undefined"==typeof document)return t;const l=document.createElement("template");return l.innerHTML=t,l.content.querySelectorAll("script, iframe, frame, frameset, object, embed, link, meta, style, noscript, form, input, button, textarea, select").forEach(e=>{e.remove()}),l.content.querySelectorAll("*").forEach(e=>{Array.from(e.attributes).forEach(t=>{const l=t.name.toLowerCase();if(l.startsWith("on"))e.removeAttribute(t.name);else if(["src","href","xlink:href"].includes(l)){const l=t.value.trim().toLowerCase();(l.startsWith("javascript:")||l.startsWith("data:"))&&e.removeAttribute(t.name)}})}),l.innerHTML.trim()},K=e=>{if(!e||"object"!=typeof e)return null;const t="number"==typeof e.value?e.value:parseInt(e.value,10),l=Number.isNaN(t)?0:t;if(l<=0)return null;const i="string"==typeof e.label&&e.label.trim()?e.label.trim():`#${l}`;return{value:String(l),label:i}},X=e=>{if(!e||"object"!=typeof e)return null;const t="number"==typeof e.id?e.id:parseInt(e.id,10);if(Number.isNaN(t)||t<=0)return null;const l=e.title&&"string"==typeof e.title.rendered?(0,g.decodeEntities)(e.title.rendered).trim():"";return K({value:t,label:l})},Z=({value:l,onChange:i,disabled:r,endpoint:o,initialOptions:s,onOptionsLoaded:c})=>{const d=(0,t.useMemo)(()=>Array.isArray(s)?s.map(e=>K(e)).filter(Boolean):[],[s]),[m,b]=(0,t.useState)(d),[p,v]=(0,t.useState)(""),[g,_]=(0,t.useState)(1),[y,h]=(0,t.useState)(!1),[j,E]=(0,t.useState)(!1),[k,C]=(0,t.useState)(!1),[x,A]=(0,t.useState)("");(0,t.useEffect)(()=>{b(d),"function"==typeof c&&d.length&&c(d)},[d,c]),(0,t.useEffect)(()=>{if(!o)return C(!1),void h(!1);let e=!0;const t=new AbortController;return h(!0),A(""),(async()=>{try{const l={page:g,per_page:20};p&&p.trim()&&(l.search=p.trim());const i=(0,f.addQueryArgs)(o,l),r=await u()({path:i,signal:t.signal,parse:!1}),a=await r.json();if(!e)return;const n=(Array.isArray(a?.items)?a.items:[]).map(e=>K(e)||X(e)).filter(Boolean),s=a&&a.pagination?a.pagination:{},d=s&&void 0!==s.totalPages?parseInt(s.totalPages,10):null,m=Number.isNaN(d)?null:d;C(m?g<m:20===n.length),b(e=>{if(1===g)return n;const t=[...e];return n.forEach(e=>{const l=t.findIndex(t=>t.value===e.value);-1===l?t.push(e):t[l]=e}),t}),"function"==typeof c&&n.length&&c(n)}catch(t){if(!e||t&&"AbortError"===t.name)return;A((0,n.__)("Impossible de charger la liste des blocs de repli.","visi-bloc-jlg")),C(!1)}finally{e&&h(!1)}})(),()=>{e=!1,t.abort()}},[o,g,p,c]),(0,t.useEffect)(()=>{if(!l)return;const e=String(l);if(m.some(t=>t.value===e))return;let t=!0;return E(!0),u()({path:(0,f.addQueryArgs)(`/wp/v2/blocks/${l}`,{context:"edit",_fields:"id,title.rendered"})}).then(e=>{if(!t)return;const l=X(e);l&&(b(e=>e.some(e=>e.value===l.value)?e:[...e,l]),"function"==typeof c&&c([l]))}).catch(()=>{}).finally(()=>{t&&E(!1)}),()=>{t=!1}},[l,m,c]);const w=(0,t.useCallback)(e=>{v(e||""),_(1)},[]),N=(0,t.useCallback)(e=>{if("function"!=typeof i)return;if("string"!=typeof e)return void i(void 0);const t=parseInt(e,10);Number.isNaN(t)||t<=0?i(void 0):i(t)},[i]),S=l?String(l):"",B=!(y||j||x||m.length);return(0,e.createElement)("div",{className:"visibloc-fallback-selector"},(0,e.createElement)(a.ComboboxControl,{label:(0,n.__)("Bloc réutilisable","visi-bloc-jlg"),value:S,options:m,onChange:N,onFilterValueChange:w,__nextHasNoMarginBottom:!0,placeholder:(0,n.__)("Rechercher un bloc réutilisable…","visi-bloc-jlg"),disabled:r}),(y||j)&&(0,e.createElement)("div",{className:"visibloc-fallback-selector__status",role:"status"},(0,e.createElement)(a.Spinner,null),(0,e.createElement)("span",null,(0,n.__)("Chargement des blocs…","visi-bloc-jlg"))),!y&&!j&&x&&(0,e.createElement)(a.Notice,{status:"error",isDismissible:!1},x),B&&!p.trim()&&(0,e.createElement)(a.Notice,{status:"warning",isDismissible:!1},(0,n.__)("Aucun bloc réutilisable publié n’est disponible.","visi-bloc-jlg")),B&&p.trim()&&(0,e.createElement)("p",{className:"visibloc-fallback-selector__message"},(0,n.__)("Aucun bloc ne correspond à votre recherche.","visi-bloc-jlg")),k&&!x&&o&&(0,e.createElement)("div",{className:"visibloc-fallback-selector__actions"},(0,e.createElement)(a.Button,{variant:"secondary",onClick:()=>_(e=>e+1),disabled:y||j},y?(0,n.__)("Chargement…","visi-bloc-jlg"):(0,n.__)("Charger plus de blocs","visi-bloc-jlg"))))},ee=e=>{if(!e||"object"!=typeof e)return!1;const t=void 0===e.fallbackEnabled||Boolean(e.fallbackEnabled),l="string"==typeof e.fallbackBehavior?e.fallbackBehavior:"inherit";if(!t)return!1;if("text"===l)return("string"==typeof e.fallbackCustomText?e.fallbackCustomText:"").trim().length>0;if("block"===l)return Boolean(e.fallbackBlockId);const i=Q("fallbackSettings")||{};return Boolean(i&&i.hasContent)},te=(()=>{const e=J("daysOfWeek"),t=new Map;return e.forEach(e=>{e&&"object"==typeof e&&"string"==typeof e.value&&t.set(e.value,e.label||e.value)}),t})(),le=()=>`rule-${Math.random().toString(36).slice(2)}-${Date.now()}`,ie=e=>{if(!Array.isArray(e)||!e.length)return"";const t=e.find(e=>e&&void 0!==e.value);if(!t)return"";const l=void 0===t.value||null===t.value?"":t.value;return String(l)},re=e=>{switch(e){case"taxonomy":return(()=>{const e=J("taxonomies").find(e=>e&&"string"==typeof e.slug);return{id:le(),type:"taxonomy",operator:"in",taxonomy:e?e.slug:"",terms:[],savedGroups:[]}})();case"template":return(()=>{const e=J("templates");return{id:le(),type:"template",operator:"is",value:ie(e)}})();case"recurring_schedule":return{id:le(),type:"recurring_schedule",operator:"matches",...G};case"logged_in_status":return(()=>{const e=J("loginStatuses");return{id:le(),type:"logged_in_status",operator:"is",value:ie(e)}})();case"user_role_group":return(()=>{const e=J("roleGroups");return{id:le(),type:"user_role_group",operator:"matches",group:ie(e)}})();case"user_segment":return(()=>{const e=J("userSegments");return{id:le(),type:"user_segment",operator:"matches",segment:ie(e)}})();case"woocommerce_cart":return(()=>{const e=J("woocommerceTaxonomies").find(e=>e&&"string"==typeof e.slug);return{id:le(),type:"woocommerce_cart",operator:"contains",taxonomy:e?e.slug:"",terms:[]}})();case"query_param":return(()=>{const e=J("commonQueryParams");return{id:le(),type:"query_param",operator:"equals",param:ie(e),value:""}})();case"cookie":return(()=>{const e=J("commonCookies");return{id:le(),type:"cookie",operator:"equals",name:ie(e),value:""}})();case"visit_count":return{id:le(),type:"visit_count",operator:"at_least",threshold:3};default:return(()=>{const e=J("postTypes");return{id:le(),type:"post_type",operator:"is",value:ie(e)}})()}},oe=e=>{if(!e||"object"!=typeof e)return null;const{type:t}=e;if(!I.includes(t))return null;const l={id:"string"==typeof e.id&&e.id?e.id:le(),type:t};if("post_type"===t)return l.operator="is_not"===e.operator?"is_not":"is",l.value="string"==typeof e.value?e.value:"",l;if("taxonomy"===t)return l.operator="not_in"===e.operator?"not_in":"in",l.taxonomy="string"==typeof e.taxonomy?e.taxonomy:"",l.terms=Array.isArray(e.terms)?e.terms.map(e=>"string"==typeof e||"number"==typeof e?String(e):"").filter(Boolean):[],l.savedGroups=Array.isArray(e.savedGroups)?e.savedGroups.map(e=>{if(!e||"object"!=typeof e)return null;const t=Array.isArray(e.terms)?e.terms.map(e=>"string"==typeof e||"number"==typeof e?String(e):"").filter(Boolean):[];return t.length?{id:("string"==typeof e.id?e.id.trim():"")||`group-${t.join("-")}`,label:("string"==typeof e.label?e.label.trim():"")||(0,n.__)("Sélection enregistrée","visi-bloc-jlg"),terms:t}:null}).filter(Boolean):[],l;if("template"===t)return l.operator="is_not"===e.operator?"is_not":"is",l.value="string"==typeof e.value?e.value:"",l;if("logged_in_status"===t)return l.operator="is_not"===e.operator?"is_not":"is",l.value="string"==typeof e.value?e.value:"",l;if("user_role_group"===t)return l.operator="does_not_match"===e.operator?"does_not_match":"matches",l.group="string"==typeof e.group?e.group:"",l;if("user_segment"===t)return l.operator="does_not_match"===e.operator?"does_not_match":"matches",l.segment="string"==typeof e.segment?e.segment:"",l;if("woocommerce_cart"===t)return l.operator="not_contains"===e.operator?"not_contains":"contains",l.taxonomy="string"==typeof e.taxonomy?e.taxonomy:"",l.terms=Array.isArray(e.terms)?e.terms.map(e=>"string"==typeof e||"number"==typeof e?String(e):"").filter(Boolean):[],l;if("query_param"===t){const t=["equals","not_equals","contains","not_contains","exists","not_exists"];return l.operator=t.includes(e.operator)?e.operator:"equals",l.param="string"==typeof e.param?e.param:"",l.value="string"==typeof e.value?e.value:"",l}if("cookie"===t){const t=["equals","not_equals","contains","not_contains","exists","not_exists"];return l.operator=t.includes(e.operator)?e.operator:"equals",l.name="string"==typeof e.name?e.name:"",l.value="string"==typeof e.value?e.value:"",l}if("visit_count"===t){const t=["at_least","at_most","equals","not_equals"],i=Number.parseInt(e.threshold,10),r=Number.isFinite(i)&&i>=0?i:0;return l.operator=t.includes(e.operator)?e.operator:"at_least",l.threshold=r,l}return l.operator="matches",l.frequency="weekly"===e.frequency?"weekly":"daily",l.days=Array.isArray(e.days)?e.days.map(e=>"string"==typeof e?e:"").filter(e=>te.has(e)):[],l.startTime="string"==typeof e.startTime?e.startTime:G.startTime,l.endTime="string"==typeof e.endTime?e.endTime:G.endTime,l},ae=e=>e&&"object"==typeof e?{logic:"OR"===e.logic?"OR":"AND",rules:Array.isArray(e.rules)?e.rules.map(oe).filter(Boolean):[],savedGroups:Array.isArray(e.savedGroups)?e.savedGroups.filter(e=>e&&"object"==typeof e):[]}:{logic:W.logic,rules:[...W.rules],savedGroups:[...W.savedGroups]},ne=({deviceVisibilitySummary:e,isSchedulingEnabled:t,scheduleSummary:l,timezoneDisplayLabel:i,rolesSummary:r,advancedRulesSummary:o})=>{const a=[];return e&&a.push((0,n.sprintf)((0,n.__)("Appareils : %s","visi-bloc-jlg"),e)),t&&(a.push((0,n.sprintf)((0,n.__)("Programmation : %s","visi-bloc-jlg"),l)),a.push((0,n.sprintf)((0,n.__)("Fuseau horaire : %s","visi-bloc-jlg"),i))),r&&a.push((0,n.sprintf)((0,n.__)("Rôles ciblés : %s","visi-bloc-jlg"),r)),o&&a.push((0,n.sprintf)((0,n.__)("Règles avancées : %s","visi-bloc-jlg"),o)),{description:a.join("\n").trim(),hasConditions:a.length>0}},se=(e,t=null)=>{const l=(e=>{if(!e||"object"!=typeof e)return"";const t="string"==typeof e.deviceVisibility?e.deviceVisibility:z.id;if(!t||t===z.id)return"";const l=O.find(e=>e&&Array.isArray(e.options)&&e.options.some(e=>e.id===t)),i=$.find(e=>e.id===t);return i?l?`${l.label} – ${i.label}`:i.label:""})(e),i=(e=>{const t=(0,n.sprintf)((0,n.__)("Fuseau du site (%s)","visi-bloc-jlg"),V);if(!e||"object"!=typeof e)return{isSchedulingEnabled:!1,scheduleSummary:(0,n.__)("Aucune programmation.","visi-bloc-jlg"),timezoneDisplayLabel:t,hasScheduleRangeError:!1,hasCustomScheduleTimezone:!1};const l=Boolean(e.isSchedulingEnabled),i="string"==typeof e.publishStartDate?e.publishStartDate:"",r="string"==typeof e.publishEndDate?e.publishEndDate:"",o="string"==typeof e.publishTimezone?e.publishTimezone:"",a=J("timezones").map(e=>{if(!e||"object"!=typeof e)return null;const t="string"==typeof e.value?e.value.trim():"";return t?{value:t,label:"string"==typeof e.label&&e.label.trim()?e.label:t}:null}).filter(Boolean),s=[{value:U,label:t},...a],c=s.some(e=>e.value===o)?o:U,u=(s.find(e=>e.value===c)||{}).label||t,d=l&&c!==U;let m=(0,n.__)("Aucune programmation.","visi-bloc-jlg");const b=L(i),p=L(r),v=l&&!!b&&!!p&&p.getTime()<b.getTime();if(l){const e=F(i),t=F(r);
/* translators: 1: Start date, 2: end date. */
m=e&&t?(0,n.sprintf)((0,n.__)("Du %s au %s.","visi-bloc-jlg"),e,t):e?(0,n.sprintf)((0,n.__)("À partir du %s.","visi-bloc-jlg"),e):t?(0,n.sprintf)((0,n.__)("Jusqu'au %s.","visi-bloc-jlg"),t):(0,n.__)("Activée, mais sans date définie.","visi-bloc-jlg"),v&&(m=(0,n.__)("Dates de programmation invalides.","visi-bloc-jlg"))}return{isSchedulingEnabled:l,scheduleSummary:m,timezoneDisplayLabel:u,hasScheduleRangeError:v,hasCustomScheduleTimezone:d}})(e),r=(e=>{const t=Array.isArray(e)?e.map(e=>"string"==typeof e?e:"").filter(Boolean):[],l=Array.from(new Set(t)).length;return l?{summary:(0,n.sprintf)((0,n._n)("%d rôle","%d rôles",l,"visi-bloc-jlg"),l),count:l}:{summary:"",count:0}})(e?e.visibilityRoles:[]),o=t||ae(e?e.advancedVisibility:void 0),a=(e=>{if(!e||"object"!=typeof e)return{summary:"",count:0};const t=Array.isArray(e.rules)?e.rules.length:0;if(!t)return{summary:"",count:0};const l="OR"===e.logic?(0,n.__)("OU","visi-bloc-jlg"):(0,n.__)("ET","visi-bloc-jlg");return{summary:(0,n.sprintf)((0,n._n)("%1$d règle %2$s","%1$d règles %2$s",t,"visi-bloc-jlg"),t,l),count:t}})(o),{description:s,hasConditions:c}=ne({deviceVisibilitySummary:l,isSchedulingEnabled:i.isSchedulingEnabled,scheduleSummary:i.scheduleSummary,timezoneDisplayLabel:i.timezoneDisplayLabel,rolesSummary:r.summary,advancedRulesSummary:a.summary});return{deviceVisibilitySummary:l,scheduling:i,rolesSummary:r.summary,rolesCount:r.count,advancedRulesSummary:a.summary,advancedRulesCount:a.count,conditionalDescription:s,hasConditionalVisibility:c,normalizedAdvancedVisibility:o}},ce=e=>{if(!e||"object"!=typeof e)return"";const t=e.isHidden?"1":"0",l=void 0===e.fallbackEnabled||Boolean(e.fallbackEnabled),i="string"==typeof e.fallbackBehavior?e.fallbackBehavior:"inherit",r=e.fallbackBlockId?String(e.fallbackBlockId):"",o="string"==typeof e.fallbackCustomText?e.fallbackCustomText.trim():"",a="string"==typeof e.deviceVisibility?e.deviceVisibility:z.id,n=e.isSchedulingEnabled?"1":"0",s="string"==typeof e.publishStartDate?e.publishStartDate:"",c="string"==typeof e.publishEndDate?e.publishEndDate:"",u="string"==typeof e.publishTimezone?e.publishTimezone:"",d=Array.isArray(e.visibilityRoles)?e.visibilityRoles.map(e=>"string"==typeof e?e:"").filter(Boolean).sort().join(","):"",m=ae(e.advancedVisibility),b=JSON.stringify(m.rules.map(e=>{if(!e||"object"!=typeof e)return null;const{id:t,...l}=e;return l})),p=JSON.stringify(m.savedGroups.map(e=>{if(!e||"object"!=typeof e)return null;const{id:t,...l}=e;return l}));return[t,l?"1":"0",i,r,o,a,n,s,c,u,d,m.logic||"AND",b,p].join("|")},ue=new Map,de=new Map,me=new Map,be=new Set,pe=new Map,ve=new Set;let ge="",fe=null,_e=[],ye=null,he=null,je=null,Ee=!1;const ke=(e,t)=>{const l=Array.isArray(t)?t.filter(Boolean):[];if(!l.length)return[];const i=(Array.isArray(e)?e:[]).map(e=>"string"==typeof e?e:"").filter(e=>e&&l.includes(e));return i.length?Array.from(new Set(i)):[l[0]]},Ce=e=>{if("number"==typeof e)return e;if("string"==typeof e&&e){const t=parseInt(e,10);if(!Number.isNaN(t))return t}},xe=(e,t={})=>{if(!e||"object"!=typeof e)return null;const{attributes:l={},id:i}=e,r={};if("string"==typeof i&&(r.scenarioPreset=i),"string"==typeof l.deviceVisibility&&(r.deviceVisibility=l.deviceVisibility),"boolean"==typeof l.isSchedulingEnabled)if(r.isSchedulingEnabled=l.isSchedulingEnabled,l.isSchedulingEnabled){r.publishStartDate=H();const e=Number.isFinite(l.scheduleWindowDays)?Number(l.scheduleWindowDays):null;r.publishEndDate=Number.isFinite(e)?((e=0)=>{const t=Number.isFinite(e)?Number(e):0,l=new Date;return l.setDate(l.getDate()+t),(0,s.format)("Y-m-d\\TH:i:s",l)})(e):""}else r.publishStartDate="",r.publishEndDate="";if(l.roles){const e=Array.isArray(t.availableRoles)?t.availableRoles:[];r.visibilityRoles=ke(l.roles,e)}if(l.fallback){r.fallbackEnabled=!0;const e=l.fallback.behavior;if("text"===e)r.fallbackBehavior="text",r.fallbackCustomText=l.fallback.message||"";else if("block"===e){r.fallbackBehavior="block";const e=Array.isArray(t.fallbackBlocks)?t.fallbackBlocks:[],i=Ce(l.fallback.blockId)||(()=>{const t=e.find(e=>void 0!==e.value);if(t)return Ce(t.value)})();"number"==typeof i&&(r.fallbackBlockId=i)}else r.fallbackBehavior="inherit"}if(Array.isArray(l.advancedRules)&&l.advancedRules.length>0){const e=l.advancedRules.map(e=>((e,t)=>{if(!e||"object"!=typeof e)return null;const l={...e};if("taxonomy"===l.type){const e=Array.isArray(t.taxonomies)?t.taxonomies.map(e=>e&&"string"==typeof e.slug?e.slug:"").filter(Boolean):[];l.taxonomy="string"==typeof l.taxonomy&&l.taxonomy?l.taxonomy:e[0]||""}if("user_segment"===l.type){const e=Array.isArray(t.userSegments)?t.userSegments.map(e=>e&&"string"==typeof e.value?e.value:"").filter(Boolean):[],i=l.segment?[l.segment]:[],[r]=ke(i,e);l.segment=r||""}if("woocommerce_cart"===l.type){const e=Array.isArray(t.woocommerceTaxonomies)?t.woocommerceTaxonomies.map(e=>e&&"string"==typeof e.slug?e.slug:"").filter(Boolean):[];l.taxonomy="string"==typeof l.taxonomy&&l.taxonomy?l.taxonomy:e[0]||""}return l.id||(l.id=le()),oe(l)})(e,t)).filter(Boolean);e.length>0&&(r.advancedVisibility=ae({logic:"OR"===l.advancedLogic?"OR":"AND",rules:e}))}return r},Ae=({rule:l,taxonomies:i,onUpdateRule:r,commonHeader:o})=>{const s=(0,t.useMemo)(()=>Array.isArray(i)?i:[],[i]),c=(0,t.useMemo)(()=>s.find(e=>e&&e.slug===l.taxonomy)||null,[s,l.taxonomy]),d=(0,t.useMemo)(()=>c&&Array.isArray(c.terms)?c.terms.map(e=>e&&"object"==typeof e?{value:"string"==typeof e.value?e.value:String(e.value||""),label:"string"==typeof e.label?e.label:String(e.value||"")}:null).filter(e=>e&&e.value):[],[c]),[m,b]=(0,t.useState)(""),[p,v]=(0,t.useState)(d),[g,f]=(0,t.useState)(!1),[_,y]=(0,t.useState)(""),h=(0,t.useRef)(null),j=(0,t.useRef)(new Map);(0,t.useEffect)(()=>{v(d),b(""),y("")},[d,l.taxonomy]),(0,t.useEffect)(()=>{const e=j.current;d.forEach(t=>{e.set(t.value,t.label)})},[d]),(0,t.useEffect)(()=>{const e=j.current;p.forEach(t=>{e.set(t.value,t.label)})},[p]),(0,t.useEffect)(()=>{if(!m)return h.current&&(h.current.abort(),h.current=null),f(!1),y(""),void v(d);const e=((e,t)=>{const l=("string"==typeof e?e:"wp/v2").replace(/^\/+/,"").replace(/\/+$/,""),i=("string"==typeof t?t:"").replace(/^\/+/,"").replace(/\/+$/,"");return i?`/${l}/${i}`:`/${l}`})(c?c.rest_namespace:"wp/v2",c?c.rest_base:l.taxonomy),t=new AbortController;return h.current=t,f(!0),y(""),u()({path:`${e}?per_page=20&search=${encodeURIComponent(m)}`,signal:t.signal}).then(e=>{if(t.signal.aborted)return;const l=Array.isArray(e)?e.map(e=>{if(!e||"object"!=typeof e)return null;const t="string"==typeof e.slug&&e.slug?e.slug:void 0!==e.id?String(e.id):"",l="string"==typeof e.name&&e.name?e.name:t;return t?{value:t,label:l}:null}).filter(Boolean):[];v(l.length?l:d)}).catch(e=>{t.signal.aborted||e&&"AbortError"===e.name||y((0,n.__)("Impossible de charger les termes. Réessayez plus tard.","visi-bloc-jlg"))}).finally(()=>{t.signal.aborted||f(!1)}),()=>{t.abort()}},[m,c,d,l.taxonomy]);const E=(0,t.useMemo)(()=>s.map(e=>({value:e.slug,label:e.label})),[s]),k=(0,t.useCallback)(e=>{const t=j.current;return t.has(e)?t.get(e):e},[]),C=(0,t.useCallback)(e=>{if(!e)return;const t=String(e);l.terms.includes(t)||r({terms:[...l.terms,t]})},[r,l.terms]),x=(0,t.useCallback)(e=>{r({terms:l.terms.filter(t=>t!==e)})},[r,l.terms]),A=(0,t.useCallback)(e=>{const t="string"==typeof e?e.trim():"";if(!l.terms.length)return;const i={id:`group-${le()}`,label:t||(0,n.sprintf)((0,n.__)("Groupe %d","visi-bloc-jlg"),(l.savedGroups||[]).length+1),terms:[...l.terms]},o=Array.isArray(l.savedGroups)?l.savedGroups:[];r({savedGroups:[...o,i]})},[r,l.savedGroups,l.terms]),w=(0,t.useCallback)(e=>{e&&Array.isArray(e.terms)&&r({terms:e.terms.filter(Boolean)})},[r]),N=(0,t.useCallback)(e=>{const t=Array.isArray(l.savedGroups)?l.savedGroups:[];r({savedGroups:t.filter(t=>t&&t.id!==e)})},[r,l.savedGroups]),[S,B]=(0,t.useState)(!1),[T,D]=(0,t.useState)("");(0,t.useEffect)(()=>{S||D("")},[S]);const R=(0,t.useMemo)(()=>{const e=l.terms.length;return 0===e?(0,n.__)("Aucun terme sélectionné.","visi-bloc-jlg"):(0,n._n)("%d terme sélectionné.","%d termes sélectionnés.",e,"visi-bloc-jlg")},[l.terms.length]);return(0,e.createElement)("div",{className:"visibloc-advanced-rule"},o,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Taxonomie","visi-bloc-jlg"),value:l.taxonomy,options:E,onChange:e=>r({taxonomy:e,terms:[],savedGroups:[]})}),(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:l.operator,options:[{value:"in",label:(0,n.__)("Inclut au moins un terme","visi-bloc-jlg")},{value:"not_in",label:(0,n.__)("Exclut tous les termes","visi-bloc-jlg")}],onChange:e=>r({operator:e})}),(0,e.createElement)(a.ComboboxControl,{__nextHasNoMarginBottom:!0,label:(0,n.__)("Ajouter un terme","visi-bloc-jlg"),value:"",options:p,onChange:e=>{C(e)},onFilterValueChange:e=>b(e),allowReset:!1,placeholder:(0,n.__)("Rechercher…","visi-bloc-jlg")}),g?(0,e.createElement)("div",{className:"visibloc-term-search-status"},(0,e.createElement)(a.Spinner,null),(0,e.createElement)("span",null,(0,n.__)("Recherche des termes…","visi-bloc-jlg"))):null,_?(0,e.createElement)(a.Notice,{status:"error",isDismissible:!1},_):null,(0,e.createElement)("div",{className:"visibloc-term-selection"},(0,e.createElement)("p",{className:"visibloc-term-selection__count"},(0,n.sprintf)(R,l.terms.length)),(0,e.createElement)("div",{className:"visibloc-term-chips",role:"list"},l.terms.map(t=>(0,e.createElement)("span",{key:t,role:"listitem",className:"visibloc-term-chip"},(0,e.createElement)("span",{className:"visibloc-term-chip__label"},k(t)),(0,e.createElement)(a.Button,{onClick:()=>x(t),icon:"no-alt",label:(0,n.__)("Retirer ce terme","visi-bloc-jlg"),variant:"tertiary",size:"small"}))),0===l.terms.length&&(0,e.createElement)("span",{className:"visibloc-term-chip visibloc-term-chip--placeholder"},(0,n.__)("Aucun terme encore ajouté.","visi-bloc-jlg")))),(0,e.createElement)("div",{className:"visibloc-term-groups"},l.terms.length>0?(0,e.createElement)("div",{className:"visibloc-term-groups__actions"},S?(0,e.createElement)(a.Flex,{align:"center",gap:8,justify:"flex-start"},(0,e.createElement)(a.FlexBlock,null,(0,e.createElement)(a.TextControl,{label:(0,n.__)("Nom du groupe","visi-bloc-jlg"),value:T,onChange:D,placeholder:(0,n.__)("Audience prioritaire","visi-bloc-jlg")})),(0,e.createElement)(a.FlexItem,null,(0,e.createElement)(a.Button,{variant:"primary",onClick:()=>{A(T),B(!1)}},(0,n.__)("Enregistrer","visi-bloc-jlg"))),(0,e.createElement)(a.FlexItem,null,(0,e.createElement)(a.Button,{variant:"tertiary",onClick:()=>B(!1)},(0,n.__)("Annuler","visi-bloc-jlg")))):(0,e.createElement)(a.Button,{variant:"tertiary",onClick:()=>B(!0)},(0,n.__)("Enregistrer cette sélection","visi-bloc-jlg"))):null,Array.isArray(l.savedGroups)&&l.savedGroups.length>0?(0,e.createElement)("div",{className:"visibloc-term-groups__list"},(0,e.createElement)("p",{className:"visibloc-term-groups__title"},(0,n.__)("Groupes enregistrés","visi-bloc-jlg")),l.savedGroups.map(t=>(0,e.createElement)("div",{key:t.id,className:"visibloc-term-group"},(0,e.createElement)(a.Button,{variant:"secondary",onClick:()=>w(t),className:"visibloc-term-group__apply"},(0,e.createElement)("span",{className:"visibloc-term-group__label"},t.label),(0,e.createElement)("span",{className:"visibloc-term-group__count"},t.terms.length)),(0,e.createElement)(a.Button,{icon:"trash",label:(0,n.__)("Supprimer ce groupe","visi-bloc-jlg"),onClick:()=>N(t.id),variant:"tertiary"})))):null))},we=(0,r.createHigherOrderComponent)(l=>i=>{if(!S(i.name))return(0,e.createElement)(l,{...i});const{attributes:s,setAttributes:c,isSelected:u,clientId:m}=i,{isHidden:p,deviceVisibility:v,isSchedulingEnabled:g,publishStartDate:f,publishEndDate:_,publishTimezone:y=U,visibilityRoles:h,advancedVisibility:j,fallbackEnabled:E=!0,fallbackBehavior:k="inherit",fallbackCustomText:C="",fallbackBlockId:x,scenarioPreset:A=""}=s,w=ae(j),N=(0,t.useMemo)(()=>Q("fallbackSettings")||{},[]),B=(0,t.useMemo)(()=>J("fallbackBlocks").map(e=>K(e)).filter(Boolean),[]),T=(0,t.useMemo)(()=>(e=>{if("string"!=typeof e)return"";const t=e.trim();if(!t)return"";if(t.startsWith("http://")||t.startsWith("https://")){const e=t.match(/^https?:\/\/[^/]+(.*)$/);if(e&&e[1])return e[1]||"/"}return t})((()=>{if("object"!=typeof VisiBlocData||null===VisiBlocData)return"";const e=VisiBlocData.fallbackBlocksEndpoint;return"string"==typeof e?e:""})()),[]),D=(0,t.useRef)(new Map),[R,M]=(0,t.useState)(0),W=(0,t.useCallback)(e=>{if(!Array.isArray(e)||!e.length)return;const t=D.current;let l=!1;e.forEach(e=>{if(!e||"object"!=typeof e)return;const i="string"==typeof e.value?e.value:String(e.value||"");if(!i)return;const r="string"==typeof e.label?e.label:"";t.has(i)&&t.get(i)===r||(t.set(i,r),l=!0)}),l&&M(e=>e+1)},[]);(0,t.useEffect)(()=>{B.length&&W(B)},[B,W]);const G=(0,t.useMemo)(()=>Q("roles")||{},[]),X=(0,t.useMemo)(()=>Object.keys(G),[G]),le=(0,t.useMemo)(()=>J("guidedRecipes"),[]),ie=(0,t.useMemo)(()=>J("userSegments"),[]),se=(0,t.useMemo)(()=>J("woocommerceTaxonomies"),[]),pe=(0,t.useMemo)(()=>J("taxonomies"),[]),ge=(0,t.useMemo)(()=>({availableRoles:X,fallbackBlocks:B,fallbackSettings:N,userSegments:ie,woocommerceTaxonomies:se,taxonomies:pe}),[X,B,N,ie,se,pe]),fe=(0,t.useMemo)(()=>{return e=le,t=ge,Array.isArray(e)?e.map(e=>{if(!e||"object"!=typeof e)return null;const l=xe(e,t);return l?{id:e.id,label:e.title||e.id,description:e.description||"",severity:e.severity||"medium",attributes:l}:null}).filter(Boolean):[];var e,t},[le,ge]),[_e,ye]=(0,t.useState)(!1),[he,je]=(0,t.useState)("device"),[Ee,ke]=(0,t.useState)(!1),Ce=(0,t.useMemo)(()=>({critical:(0,n.__)("Critique","visi-bloc-jlg"),high:(0,n.__)("Prioritaire","visi-bloc-jlg"),medium:(0,n.__)("Standard","visi-bloc-jlg"),low:(0,n.__)("Suggestion","visi-bloc-jlg")}),[]),Ne=(0,t.useMemo)(()=>{if(!x)return"";const e=String(x),t=D.current.get(e);return t&&t.trim()?t.trim():`#${x}`},[x,R]),Se=(0,t.useCallback)(e=>["critical","high","medium","low"].includes(e)?e:"medium",[]),Be=(0,t.useCallback)(e=>{e&&e.attributes&&(c(e.attributes),e.attributes.isSchedulingEnabled?je("schedule"):e.attributes.fallbackEnabled&&e.attributes.fallbackBehavior&&"inherit"!==e.attributes.fallbackBehavior?je("fallback"):e.attributes.advancedVisibility&&Array.isArray(e.attributes.advancedVisibility.rules)&&e.attributes.advancedVisibility.rules.length>0?je("advanced"):Array.isArray(e.attributes.visibilityRoles)&&e.attributes.visibilityRoles.length>0?je("roles"):je("device"))},[c,je]),Te=(0,t.useCallback)(e=>{const t=xe(e,ge);t&&(c(t),t.isSchedulingEnabled?je("schedule"):t.advancedVisibility&&Array.isArray(t.advancedVisibility.rules)&&t.advancedVisibility.rules.length>0?je("advanced"):Array.isArray(t.visibilityRoles)&&t.visibilityRoles.length>0?je("roles"):t.fallbackEnabled&&t.fallbackBehavior&&"inherit"!==t.fallbackBehavior?je("fallback"):je("device"),ke(!1))},[ge,c,je]),Re=ee(s),Me=Boolean(N&&N.hasContent),Ve=N&&"string"==typeof N.summary?N.summary:"",Fe=N&&"string"==typeof N.previewHtml?N.previewHtml:"",He=[{value:"inherit",label:(0,n.__)("Utiliser le repli global","visi-bloc-jlg")},{value:"text",label:(0,n.__)("Texte personnalisé","visi-bloc-jlg")},{value:"block",label:(0,n.__)("Bloc réutilisable","visi-bloc-jlg")}],Le=(0,t.useMemo)(()=>Y(Fe),[Fe]),ze=(0,t.useMemo)(()=>"text"===k?(e=>{if("string"!=typeof e)return"";const t=e.trim();if(!t)return"";let l=t;return"function"==typeof b()&&(l=b()(t)),Y(l)})(C):"",[k,C]),Oe=(0,t.useMemo)(()=>ce(s),[s]);(0,t.useEffect)(()=>{!function(e){e&&(ve.add(e),qe())}(m)},[m,Oe]);const{blockPreviewHtml:$e,isBlockPreviewResolving:Ie}=(0,d.useSelect)(e=>{if("block"!==k||!x)return{blockPreviewHtml:"",isBlockPreviewResolving:!1};const t=e("core"),l=e("core/data"),i=t?t.getEntityRecord("postType","wp_block",x):void 0,r=!!l&&l.isResolving("core","getEntityRecord",["postType","wp_block",x]);return{blockPreviewHtml:i&&i.content&&"string"==typeof i.content.rendered?i.content.rendered:"",isBlockPreviewResolving:r||void 0===i}},[k,x]),Pe=(0,t.useMemo)(()=>"block"===k?Y($e):"",[k,$e]),We=(0,t.useMemo)(()=>E?"text"===k?"string"==typeof C&&C.trim()?ze?{status:"ready",message:"",html:ze}:{status:"warning",message:(0,n.__)("Prévisualisation indisponible pour ce texte.","visi-bloc-jlg"),html:""}:{status:"warning",message:(0,n.__)("Aucun texte de repli défini.","visi-bloc-jlg"),html:""}:"block"===k?x?Ie?{status:"info",message:(0,n.__)("Chargement de l’aperçu du bloc de repli…","visi-bloc-jlg"),html:""}:Pe?{status:"ready",message:"",html:Pe}:{status:"warning",message:(0,n.__)("Impossible d’afficher l’aperçu du bloc sélectionné.","visi-bloc-jlg"),html:""}:{status:"warning",message:(0,n.__)("Aucun bloc réutilisable sélectionné.","visi-bloc-jlg"),html:""}:Me?Le?{status:"ready",message:"",html:Le}:{status:"warning",message:(0,n.__)("Aucun aperçu disponible pour le repli global.","visi-bloc-jlg"),html:""}:{status:"warning",message:(0,n.__)("Aucun repli global n’est configuré.","visi-bloc-jlg"),html:""}:{status:"info",message:(0,n.__)("Le repli est désactivé pour ce bloc.","visi-bloc-jlg"),html:""},[E,k,C,ze,x,Ie,Pe,Me,Le]),Ge=We.html,Ue=We.status,Je=We.message,Qe=(0,t.useRef)(null),Ye=(0,r.useInstanceId)(we,"visibloc-fallback-preview"),Ke=`${Ye}__label`;(0,t.useEffect)(()=>{_e&&E&&Qe.current&&Qe.current.focus({preventScroll:!0})},[_e,E,Ge,Ue]),(0,t.useEffect)(()=>()=>{m&&(ue.delete(m),de.delete(m),me.delete(m),be.delete(m))},[m]);const Xe=e=>{const t=ae({...w}),l=e(t)||t;c({advancedVisibility:ae(l)})},Ze=(e,t)=>{const l=e?[...h,t]:h.filter(e=>e!==t);c({visibilityRoles:l})},et=(0,t.useMemo)(()=>J("timezones"),[]),tt=(0,t.useMemo)(()=>et.map(e=>{if(!e||"object"!=typeof e)return null;const t="string"==typeof e.value?e.value.trim():"";return t?{value:t,label:"string"==typeof e.label&&e.label.trim()?e.label:t}:null}).filter(Boolean),[et]),lt=(0,t.useMemo)(()=>(0,n.sprintf)((0,n.__)("Fuseau du site (%s)","visi-bloc-jlg"),V),[]),it=(0,t.useMemo)(()=>[{value:U,label:lt},...tt],[lt,tt]),rt=(0,t.useMemo)(()=>it.some(e=>e.value===y)?y:U,[y,it]),ot=(0,t.useMemo)(()=>{const e=it.find(e=>e.value===rt);return e?e.label:lt},[rt,it,lt]),at=rt!==U,nt=(0,t.useMemo)(()=>(0,n.sprintf)((0,n.__)("Fuseau horaire : %s","visi-bloc-jlg"),ot),[ot]);let st=(0,n.__)("Aucune programmation.","visi-bloc-jlg");const ct=L(f),ut=L(_),dt=g&&!!ct&&!!ut&&ut.getTime()<ct.getTime();if(g){const e=F(f),t=F(_);
/* translators: 1: Start date, 2: end date. */
st=e&&t?(0,n.sprintf)((0,n.__)("Du %s au %s.","visi-bloc-jlg"),e,t):e?(0,n.sprintf)((0,n.__)("À partir du %s.","visi-bloc-jlg"),e):t?(0,n.sprintf)((0,n.__)("Jusqu'au %s.","visi-bloc-jlg"),t):(0,n.__)("Activée, mais sans date définie.","visi-bloc-jlg"),dt&&(st=(0,n.__)("Dates de programmation invalides.","visi-bloc-jlg"))}const mt=(0,n.__)("Inactif","visi-bloc-jlg"),bt=(t,l="")=>{if(!t)return null;const i=["visi-bloc-help-text"];return l&&i.push(l),(0,e.createElement)("p",{className:i.join(" ")},t)},pt=(()=>{if(!v||v===z.id)return"";const e=O.find(e=>!!Array.isArray(e.options)&&e.options.some(e=>e.id===v)),t=$.find(e=>e.id===v);return t?e?`${e.label} – ${t.label}`:t.label:""})(),vt=(()=>{if(!g)return"";if(dt)return(0,n.__)("Erreur de dates","visi-bloc-jlg");let e;return e=f&&_?(0,n.__)("Plage définie","visi-bloc-jlg"):f||_?(0,n.__)("Date définie","visi-bloc-jlg"):(0,n.__)("Programmation active","visi-bloc-jlg"),at?`${e} – ${ot}`:e})(),gt=(()=>{const e=Array.from(new Set((h||[]).filter(Boolean))).length;return e?(0,n.sprintf)((0,n._n)("%d rôle","%d rôles",e,"visi-bloc-jlg"),e):""})(),ft=(()=>{const e=Array.isArray(w.rules)?w.rules.length:0;if(!e)return"";const t="OR"===w.logic?(0,n.__)("OU","visi-bloc-jlg"):(0,n.__)("ET","visi-bloc-jlg");return(0,n.sprintf)((0,n._n)("%1$d règle %2$s","%1$d règles %2$s",e,"visi-bloc-jlg"),e,t)})(),_t=(()=>{if(!E)return"";if("block"===k)return x?Ne||(0,n.sprintf)((0,n.__)("Bloc #%d","visi-bloc-jlg"),x):(0,n.__)("Bloc","visi-bloc-jlg");const e={inherit:(0,n.__)("Global","visi-bloc-jlg"),text:(0,n.__)("Texte","visi-bloc-jlg")};return e[k]||e.inherit})(),{description:yt,hasConditions:ht}=ne({deviceVisibilitySummary:pt,isSchedulingEnabled:g,scheduleSummary:st,timezoneDisplayLabel:ot,rolesSummary:gt,advancedRulesSummary:ft}),jt=[];p&&jt.push((0,n.__)("Bloc masqué manuellement.","visi-bloc-jlg")),yt&&jt.push(...yt.split("\n"));const Et=[];if(Re)if(_t&&Et.push((0,n.sprintf)((0,n.__)("Type : %s","visi-bloc-jlg"),_t)),"inherit"===k)Ve?Et.push((0,n.sprintf)((0,n.__)("Repli global : %s","visi-bloc-jlg"),Ve)):Me?Et.push((0,n.__)("Utilise le contenu de repli global.","visi-bloc-jlg")):Et.push((0,n.__)("Aucun repli global défini.","visi-bloc-jlg"));else if("text"===k){const e="string"==typeof C?C.trim():"";e&&Et.push(e)}else"block"===k&&x&&(Ne?Et.push((0,n.sprintf)((0,n.__)("Bloc : %s","visi-bloc-jlg"),Ne)):Et.push((0,n.sprintf)((0,n.__)("Bloc #%d","visi-bloc-jlg"),x)));if(m){const e=jt.join("\n").trim(),t=Et.join("\n").trim(),l=ue.get(m)||{},i={...l,isHidden:Boolean(p),hasFallback:Re,isConditionallyHidden:ht&&!p,conditionalDescription:yt,hiddenDescription:e,fallbackDescription:t};ue.set(m,i),l.isHidden===i.isHidden&&l.hasFallback===i.hasFallback&&l.isConditionallyHidden===i.isConditionallyHidden&&l.hiddenDescription===i.hiddenDescription&&l.conditionalDescription===i.conditionalDescription&&l.fallbackDescription===i.fallbackDescription||De(m,i)}const kt=Array.isArray(w.rules)?w.rules:[],Ct=kt.length>0,xt=!!Ct&&kt.some(e=>!(!e||"object"!=typeof e||("taxonomy"===e.type||"woocommerce_cart"===e.type?Array.isArray(e.terms)&&0!==e.terms.length:"user_segment"!==e.type||e.segment))),At=!!E&&("text"===k&&!C.trim()||"block"===k&&!x||"inherit"===k&&!Me),wt={};p&&(wt.device={variant:"hidden",label:(0,n.__)("Masqué","visi-bloc-jlg"),description:(0,n.__)("Ce bloc est masqué manuellement.","visi-bloc-jlg")}),g&&(wt.schedule=dt?{variant:"warning",label:(0,n.__)("Dates invalides","visi-bloc-jlg"),description:(0,n.__)("Vérifiez la cohérence des dates de début et de fin.","visi-bloc-jlg")}:{variant:"schedule",label:(0,n.__)("Programmation active","visi-bloc-jlg"),description:st}),Array.isArray(h)&&h.length>0&&(wt.roles={variant:"success",label:(0,n.__)("Audience ciblée","visi-bloc-jlg"),description:gt||(0,n.__)("Des rôles spécifiques sont sélectionnés.","visi-bloc-jlg")}),Ct&&(wt.advanced=xt?{variant:"warning",label:(0,n.__)("Règles incomplètes","visi-bloc-jlg"),description:(0,n.__)("Complétez les taxonomies, segments ou conditions manquantes.","visi-bloc-jlg")}:{variant:"advanced",label:(0,n.__)("Règles actives","visi-bloc-jlg"),description:ft||(0,n.__)("Des règles avancées filtrent ce bloc.","visi-bloc-jlg")}),E&&(wt.fallback=At?{variant:"warning",label:(0,n.__)("Repli à compléter","visi-bloc-jlg"),description:(0,n.__)("Ajoutez un texte, un bloc ou définissez un repli global pour éviter une impasse.","visi-bloc-jlg")}:{variant:"fallback",label:(0,n.__)("Repli prêt","visi-bloc-jlg"),description:_t||(0,n.__)("Un repli est prêt pour ce bloc.","visi-bloc-jlg")});const Nt=[{id:"device",label:(0,n.__)("Appareils","visi-bloc-jlg"),summary:pt,content:(0,e.createElement)(a.BaseControl,{label:(0,n.__)("Visibilité par appareil","visi-bloc-jlg")},(0,e.createElement)("div",{className:"visi-bloc-device-toggle-groups"},O.map(t=>{const l=t.options.some(e=>e.id===v);return(0,e.createElement)("div",{key:t.id,className:"visi-bloc-device-toggle-group"},(0,e.createElement)(a.BaseControl.VisualLabel,null,t.label),(0,e.createElement)(a.ToggleGroupControl,{className:"visi-bloc-device-toggle",isBlock:!0,isDeselectable:!0,value:l?v:void 0,onChange:e=>c({deviceVisibility:e||z.id})},t.options.map(t=>(0,e.createElement)(a.ToggleGroupControlOptionIcon,{key:t.id,value:t.id,icon:t.icon,label:t.label}))))}),(0,e.createElement)(a.Button,{className:"visi-bloc-device-toggle-reset",variant:"link",isLink:!0,onClick:()=>c({deviceVisibility:z.id}),disabled:v===z.id},z.label)))},{id:"schedule",label:(0,n.__)("Calendrier","visi-bloc-jlg"),summary:vt,content:(0,e.createElement)(t.Fragment,null,(0,e.createElement)(a.ToggleControl,{label:(0,n.__)("Activer la programmation","visi-bloc-jlg"),checked:g,onChange:()=>c({isSchedulingEnabled:!g})}),bt(st,"is-subtle"),g&&(0,e.createElement)("div",{className:"visibloc-schedule-controls"},dt&&(0,e.createElement)(a.Notice,{status:"error",isDismissible:!1},(0,n.__)("La date de fin doit être postérieure à la date de début.","visi-bloc-jlg")),(0,e.createElement)(a.ComboboxControl,{label:(0,n.__)("Fuseau horaire de programmation","visi-bloc-jlg"),value:rt,options:it,onChange:e=>{const t=it.find(t=>t.value===e);c({publishTimezone:t?t.value:U})},placeholder:(0,n.__)("Rechercher un fuseau horaire…","visi-bloc-jlg"),__nextHasNoMarginBottom:!0,help:(0,n.__)("Choisissez un fuseau horaire spécifique pour cette plage. Par défaut, le fuseau du site est utilisé.","visi-bloc-jlg")}),bt(nt,"is-subtle"),(0,e.createElement)("div",{className:"visibloc-schedule-date-field"},(0,e.createElement)(a.CheckboxControl,{label:(0,n.__)("Définir une date de début","visi-bloc-jlg"),checked:!!f,onChange:e=>{c({publishStartDate:e?H():void 0})}}),!!f&&(0,e.createElement)("div",{className:"visi-bloc-datepicker-wrapper"},(0,e.createElement)(a.DateTimePicker,{currentDate:f,onChange:e=>c({publishStartDate:e}),is12Hour:q}))),(0,e.createElement)("div",{className:"visibloc-schedule-date-field"},(0,e.createElement)(a.CheckboxControl,{label:(0,n.__)("Définir une date de fin","visi-bloc-jlg"),checked:!!_,onChange:e=>{c({publishEndDate:e?H():void 0})}}),!!_&&(0,e.createElement)("div",{className:"visi-bloc-datepicker-wrapper"},(0,e.createElement)(a.DateTimePicker,{currentDate:_,onChange:e=>c({publishEndDate:e}),is12Hour:q})))))},{id:"roles",label:(0,n.__)("Rôles","visi-bloc-jlg"),summary:gt,content:(0,e.createElement)(a.BaseControl,{label:(0,n.__)("Audience ciblée","visi-bloc-jlg"),help:(0,n.__)("Sélectionnez les rôles autorisés à voir ce bloc. Laisser vide pour l’afficher à tout le monde.","visi-bloc-jlg")},(0,e.createElement)("div",{className:"visibloc-roles-list"},(0,e.createElement)(a.CheckboxControl,{label:(0,n.__)("Visiteurs déconnectés","visi-bloc-jlg"),checked:h.includes("logged-out"),onChange:e=>Ze(e,"logged-out")}),(0,e.createElement)(a.CheckboxControl,{label:(0,n.__)("Utilisateurs connectés (tous)","visi-bloc-jlg"),checked:h.includes("logged-in"),onChange:e=>Ze(e,"logged-in")}),(0,e.createElement)("div",{className:"visibloc-roles-list__divider","aria-hidden":"true"}),Object.entries(VisiBlocData.roles||{}).sort(([,e],[,t])=>String(e).localeCompare(String(t))).map(([t,l])=>(0,e.createElement)(a.CheckboxControl,{key:t,label:l,checked:h.includes(t),onChange:e=>Ze(e,t)}))))},{id:"advanced",label:(0,n.__)("Règles avancées","visi-bloc-jlg"),summary:ft,content:(0,e.createElement)("div",{className:"visibloc-advanced-rules"},(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Logique entre les règles","visi-bloc-jlg"),value:w.logic,options:[{value:"AND",label:(0,n.__)("Toutes les règles doivent être vraies (ET)","visi-bloc-jlg")},{value:"OR",label:(0,n.__)("Au moins une règle doit être vraie (OU)","visi-bloc-jlg")}],onChange:e=>Xe(t=>({...t,logic:"OR"===e?"OR":"AND"}))}),w.rules.map((t,l)=>((t,l)=>{const i=e=>{Xe(i=>{const r=[...i.rules];return r[l]=oe({...t,...e}),{...i,rules:r}})},r=(0,e.createElement)(a.Flex,{align:"center",wrap:!0},(0,e.createElement)(a.FlexBlock,null,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Type de règle","visi-bloc-jlg"),value:t.type,options:P,onChange:e=>{I.includes(e)&&Xe(t=>{const i=[...t.rules],r=re(e);return i[l]=r,{...t,rules:i}})}})),(0,e.createElement)(a.FlexItem,null,(0,e.createElement)(a.Button,{isDestructive:!0,variant:"tertiary",onClick:()=>{Xe(e=>{const t=e.rules.filter((e,t)=>t!==l);return{...e,rules:t}})}},(0,n.__)("Supprimer","visi-bloc-jlg"))));if("post_type"===t.type){const l=J("postTypes").map(e=>({value:e.value,label:e.label}));return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},r,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:t.operator,options:[{value:"is",label:(0,n.__)("Est","visi-bloc-jlg")},{value:"is_not",label:(0,n.__)("N’est pas","visi-bloc-jlg")}],onChange:e=>i({operator:e})}),(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Type de contenu","visi-bloc-jlg"),value:t.value,options:l,onChange:e=>i({value:e})}))}if("taxonomy"===t.type)return(0,e.createElement)(Ae,{key:t.id,rule:t,taxonomies:pe,onUpdateRule:i,commonHeader:r});if("template"===t.type){const l=J("templates").map(e=>({value:e.value,label:e.label}));return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},r,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:t.operator,options:[{value:"is",label:(0,n.__)("Est","visi-bloc-jlg")},{value:"is_not",label:(0,n.__)("N’est pas","visi-bloc-jlg")}],onChange:e=>i({operator:e})}),(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Modèle","visi-bloc-jlg"),value:t.value,options:l,onChange:e=>i({value:e})}))}if("logged_in_status"===t.type){const l=J("loginStatuses").map(e=>({value:e.value,label:e.label}));return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},r,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:t.operator,options:[{value:"is",label:(0,n.__)("Est","visi-bloc-jlg")},{value:"is_not",label:(0,n.__)("N’est pas","visi-bloc-jlg")}],onChange:e=>i({operator:e})}),(0,e.createElement)(a.SelectControl,{label:(0,n.__)("État de connexion","visi-bloc-jlg"),value:t.value,options:l,onChange:e=>i({value:e})}))}if("user_role_group"===t.type){const l=J("roleGroups"),o=Q("roles")||{},s=l.find(e=>e&&e.value===t.group),c=s&&Array.isArray(s.roles)?s.roles:[];return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},r,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:t.operator,options:[{value:"matches",label:(0,n.__)("Correspond à","visi-bloc-jlg")},{value:"does_not_match",label:(0,n.__)("Ne correspond pas à","visi-bloc-jlg")}],onChange:e=>i({operator:e})}),(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Groupe de rôles","visi-bloc-jlg"),value:t.group,options:l.map(e=>({value:e.value,label:e.label})),onChange:e=>i({group:e})}),c.length>0&&(0,e.createElement)("p",{className:"components-help-text"},c.map(e=>o[e]||e).filter(Boolean).join(", ")))}if("user_segment"===t.type){const l=J("userSegments").map(e=>({value:"string"==typeof e.value?e.value:"",label:"string"==typeof e.label&&e.label.trim()?e.label:"string"==typeof e.value?e.value:""})).filter(e=>e.value),o=[{value:"matches",label:(0,n.__)("Appartient au segment","visi-bloc-jlg")},{value:"does_not_match",label:(0,n.__)("N’appartient pas au segment","visi-bloc-jlg")}],s="string"==typeof t.segment?t.segment:"";return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},r,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:t.operator,options:o,onChange:e=>i({operator:e})}),(0,e.createElement)(a.ComboboxControl,{label:(0,n.__)("Identifiant de segment","visi-bloc-jlg"),value:s,options:l,onChange:e=>i({segment:e||""}),allowReset:!0,help:(0,n.__)("Choisissez un segment fourni par vos intégrations marketing ou saisissez un identifiant personnalisé.","visi-bloc-jlg")}),!l.length&&(0,e.createElement)("p",{className:"components-help-text"},(0,n.__)("Aucun segment n’a encore été exposé via le filtre « visibloc_jlg_user_segments ».","visi-bloc-jlg")))}if("woocommerce_cart"===t.type){const l=J("woocommerceTaxonomies"),o=Array.isArray(l)&&l.length>0,s=l.find(e=>e&&e.slug===t.taxonomy),c=o?l.map(e=>({value:e.slug,label:e.label})):[{value:"",label:(0,n.__)("Aucune taxonomie disponible","visi-bloc-jlg")}],u=s&&Array.isArray(s.terms)?s.terms.map(e=>({value:e.value,label:e.label})):[],d=(e,l)=>{const r=String(l),o=e?[...t.terms,r]:t.terms.filter(e=>e!==r);i({terms:o})};return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},r,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:t.operator,options:[{value:"contains",label:(0,n.__)("Contient des produits avec ces termes","visi-bloc-jlg")},{value:"not_contains",label:(0,n.__)("Ne contient aucun produit avec ces termes","visi-bloc-jlg")}],onChange:e=>i({operator:e})}),(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Taxonomie WooCommerce","visi-bloc-jlg"),value:t.taxonomy,options:c,onChange:e=>i({taxonomy:e,terms:[]}),disabled:!o}),o?u.length>0?(0,e.createElement)("div",{className:"visibloc-advanced-rule__terms"},u.map(l=>(0,e.createElement)(a.CheckboxControl,{key:l.value,label:l.label,checked:t.terms.includes(l.value),onChange:e=>d(e,l.value)}))):(0,e.createElement)("p",{className:"components-help-text"},(0,n.__)("Aucun terme disponible pour cette taxonomie WooCommerce.","visi-bloc-jlg")):(0,e.createElement)("p",{className:"components-help-text"},(0,n.__)("Aucune source WooCommerce n’est disponible. Activez WooCommerce pour utiliser cette règle.","visi-bloc-jlg")))}if("query_param"===t.type){const l=J("commonQueryParams").map(e=>({value:e.value,label:e.label||e.value})),o=[{value:"",label:(0,n.__)("Personnalisé…","visi-bloc-jlg")},...l],s=[{value:"equals",label:(0,n.__)("Est égal à","visi-bloc-jlg")},{value:"not_equals",label:(0,n.__)("Est différent de","visi-bloc-jlg")},{value:"contains",label:(0,n.__)("Contient","visi-bloc-jlg")},{value:"not_contains",label:(0,n.__)("Ne contient pas","visi-bloc-jlg")},{value:"exists",label:(0,n.__)("Existe","visi-bloc-jlg")},{value:"not_exists",label:(0,n.__)("N’existe pas","visi-bloc-jlg")}],c=l.some(e=>e.value===t.param)?t.param:"";return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},r,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:t.operator,options:s,onChange:e=>i({operator:e})}),(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Paramètre courant","visi-bloc-jlg"),value:c,options:o,onChange:e=>{e&&i({param:e})}}),(0,e.createElement)(a.TextControl,{label:(0,n.__)("Nom du paramètre","visi-bloc-jlg"),value:t.param,onChange:e=>i({param:e}),help:(0,n.__)("Saisissez le nom du paramètre de requête attendu (ex. utm_source).","visi-bloc-jlg")}),!["exists","not_exists"].includes(t.operator)&&(0,e.createElement)(a.TextControl,{label:(0,n.__)("Valeur attendue","visi-bloc-jlg"),value:t.value,onChange:e=>i({value:e})}))}if("cookie"===t.type){const l=J("commonCookies").map(e=>({value:e.value,label:e.label||e.value})),o=[{value:"",label:(0,n.__)("Personnalisé…","visi-bloc-jlg")},...l],s=[{value:"equals",label:(0,n.__)("Est égal à","visi-bloc-jlg")},{value:"not_equals",label:(0,n.__)("Est différent de","visi-bloc-jlg")},{value:"contains",label:(0,n.__)("Contient","visi-bloc-jlg")},{value:"not_contains",label:(0,n.__)("Ne contient pas","visi-bloc-jlg")},{value:"exists",label:(0,n.__)("Existe","visi-bloc-jlg")},{value:"not_exists",label:(0,n.__)("N’existe pas","visi-bloc-jlg")}],c=l.some(e=>e.value===t.name)?t.name:"";return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},r,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:t.operator,options:s,onChange:e=>i({operator:e})}),(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Cookie courant","visi-bloc-jlg"),value:c,options:o,onChange:e=>{e&&i({name:e})}}),(0,e.createElement)(a.TextControl,{label:(0,n.__)("Nom du cookie","visi-bloc-jlg"),value:t.name,onChange:e=>i({name:e}),help:(0,n.__)("Saisissez le nom exact du cookie attendu (respect de la casse).","visi-bloc-jlg")}),!["exists","not_exists"].includes(t.operator)&&(0,e.createElement)(a.TextControl,{label:(0,n.__)("Valeur attendue","visi-bloc-jlg"),value:t.value,onChange:e=>i({value:e})}))}if("visit_count"===t.type){const l=[{value:"at_least",label:(0,n.__)("Au moins","visi-bloc-jlg")},{value:"at_most",label:(0,n.__)("Au plus","visi-bloc-jlg")},{value:"equals",label:(0,n.__)("Est exactement","visi-bloc-jlg")},{value:"not_equals",label:(0,n.__)("N’est pas exactement","visi-bloc-jlg")}],o=Number.isFinite(t.threshold)&&t.threshold>=0?String(t.threshold):"0";return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},r,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:t.operator,options:l,onChange:e=>i({operator:e})}),(0,e.createElement)(a.TextControl,{label:(0,n.__)("Nombre de visites","visi-bloc-jlg"),type:"number",min:0,value:o,onChange:e=>{const t=Number.parseInt(e,10);i({threshold:Number.isNaN(t)||t<0?0:t})},help:(0,n.__)("Le compteur de visites est stocké dans le cookie « visibloc_visit_count ».","visi-bloc-jlg")}))}const o=e=>t=>{const l=t&&t.target?t.target.value:"",r="string"==typeof l?l:"";i({[e]:r})};return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},r,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Fréquence","visi-bloc-jlg"),value:t.frequency,options:[{value:"daily",label:(0,n.__)("Quotidien","visi-bloc-jlg")},{value:"weekly",label:(0,n.__)("Hebdomadaire","visi-bloc-jlg")}],onChange:e=>i({frequency:e,days:"weekly"===e?t.days:[]})}),(0,e.createElement)(a.Flex,{gap:"small"},(0,e.createElement)(a.FlexBlock,null,(0,e.createElement)(a.BaseControl,{label:(0,n.__)("Heure de début","visi-bloc-jlg")},(0,e.createElement)("input",{type:"time",value:t.startTime||"",onChange:o("startTime"),className:"components-text-control__input"}))),(0,e.createElement)(a.FlexBlock,null,(0,e.createElement)(a.BaseControl,{label:(0,n.__)("Heure de fin","visi-bloc-jlg")},(0,e.createElement)("input",{type:"time",value:t.endTime||"",onChange:o("endTime"),className:"components-text-control__input"})))),"weekly"===t.frequency&&te.size>0&&(0,e.createElement)("div",{className:"visibloc-advanced-rule__days"},(0,e.createElement)("p",{className:"components-base-control__label"},(0,n.__)("Jours actifs","visi-bloc-jlg")),Array.from(te.entries()).map(([l,r])=>(0,e.createElement)(a.CheckboxControl,{key:l,label:r,checked:t.days.includes(l),onChange:e=>((e,l)=>{const r=e?[...new Set([...t.days,l])]:t.days.filter(e=>e!==l);i({days:r})})(e,l)}))))})(t,l)),(0,e.createElement)(a.DropdownMenu,{text:(0,n.__)("Ajouter une règle de…","visi-bloc-jlg"),label:(0,n.__)("Ajouter une règle de…","visi-bloc-jlg"),toggleProps:{variant:"secondary"}},({onClose:t})=>(0,e.createElement)(a.MenuGroup,{label:(0,n.__)("Types de règles disponibles","visi-bloc-jlg")},P.map(l=>(0,e.createElement)(a.MenuItem,{key:l.value,onClick:()=>{Xe(e=>({...e,rules:[...e.rules,re(l.value)]})),t()}},l.label)))),bt((0,n.__)("Ces règles permettent d’affiner la visibilité selon le contexte du contenu, le modèle ou un horaire récurrent.","visi-bloc-jlg"),"is-subtle"))},{id:"fallback",label:(0,n.__)("Repli","visi-bloc-jlg"),summary:_t,content:(0,e.createElement)(t.Fragment,null,(0,e.createElement)(a.ToggleControl,{label:(0,n.__)("Activer le repli pour ce bloc","visi-bloc-jlg"),checked:E,onChange:()=>c({fallbackEnabled:!E})}),!E&&(0,e.createElement)(a.Notice,{status:"info",isDismissible:!1},(0,n.__)("Aucun contenu de repli ne sera affiché si ce bloc est masqué.","visi-bloc-jlg")),E&&(0,e.createElement)(t.Fragment,null,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Source du repli","visi-bloc-jlg"),value:k,options:He,onChange:e=>c({fallbackBehavior:He.some(t=>t.value===e)?e:"inherit"})}),"inherit"===k&&(Me?(0,e.createElement)(a.Notice,{status:"info",isDismissible:!1},Ve?(0,n.sprintf)((0,n.__)("Repli global : %s","visi-bloc-jlg"),Ve):(0,n.__)("Un repli global est configuré.","visi-bloc-jlg")):(0,e.createElement)(a.Notice,{status:"warning",isDismissible:!1},(0,n.__)("Aucun repli global n’est actuellement défini.","visi-bloc-jlg"))),"text"===k&&(0,e.createElement)(a.TextareaControl,{label:(0,n.__)("Texte affiché en repli","visi-bloc-jlg"),help:(0,n.__)("Ce texte remplace le bloc lorsque les visiteurs n’y ont pas accès.","visi-bloc-jlg"),value:C,onChange:e=>c({fallbackCustomText:e})}),"block"===k&&(0,e.createElement)(Z,{value:x,disabled:!E,endpoint:T,initialOptions:B,onOptionsLoaded:W,onChange:e=>{c({fallbackBlockId:"number"!=typeof e||Number.isNaN(e)?0:e})}}),(0,e.createElement)(a.ToggleControl,{label:(0,n.__)("Prévisualiser le repli","visi-bloc-jlg"),checked:_e,onChange:()=>ye(e=>!e),disabled:!E,"aria-controls":Ye,"aria-expanded":_e&&E}),_e&&E&&(0,e.createElement)("div",{ref:Qe,id:Ye,className:"visibloc-fallback-preview",role:"region","aria-live":"polite","aria-labelledby":Ke,tabIndex:"-1"},(0,e.createElement)("span",{id:Ke,className:"screen-reader-text"},(0,n.__)("Aperçu du contenu de repli","visi-bloc-jlg")),Ge?(0,e.createElement)("div",{className:"visibloc-fallback-preview__content"},(0,e.createElement)(t.RawHTML,null,Ge)):(0,e.createElement)(a.Notice,{status:"warning"===Ue?"warning":"info",isDismissible:!1},Je||(0,n.__)("Aucun aperçu disponible pour ce repli.","visi-bloc-jlg")))))}],St=Nt[0]||null,Bt=Nt.map((t,l)=>{const i=wt[t.id],r=(0,n.sprintf)((0,n.__)("Étape %1$d · %2$s","visi-bloc-jlg"),l+1,t.label);return{name:t.id,title:(0,e.createElement)("span",{className:"visibloc-stepper__tab-label"},(0,e.createElement)("span",{className:"visibloc-stepper__tab-text"},r),i?(0,e.createElement)(a.Tooltip,{text:i.description},(0,e.createElement)("span",{className:`visibloc-stepper__status visibloc-stepper__status--${i.variant}`,"aria-label":i.description},i.label)):null),className:"visibloc-stepper__tab"}});return(0,e.createElement)(t.Fragment,null,(0,e.createElement)(l,{...i}),u&&(0,e.createElement)(t.Fragment,null,(0,e.createElement)(o.BlockControls,null,(0,e.createElement)(a.ToolbarGroup,null,(0,e.createElement)(a.ToolbarButton,{icon:"visibility",label:(0,n.__)("Rendre visible","visi-bloc-jlg"),onClick:()=>c({isHidden:!1}),isActive:!1===p}),(0,e.createElement)(a.ToolbarButton,{icon:"hidden",label:(0,n.__)("Rendre caché","visi-bloc-jlg"),onClick:()=>c({isHidden:!0}),isActive:!0===p}))),(0,e.createElement)(o.InspectorControls,null,(0,e.createElement)(a.PanelBody,{title:(0,n.__)("Parcours de visibilité","visi-bloc-jlg"),initialOpen:!0,className:"visibloc-panel--guided"},fe.length>0&&(0,e.createElement)("div",{className:"visibloc-scenario-presets"},(0,e.createElement)("div",{className:"visibloc-scenario-presets__header"},(0,e.createElement)("p",{className:"visibloc-scenario-presets__title"},(0,n.__)("Scénarios recommandés","visi-bloc-jlg")),(0,e.createElement)(a.Button,{variant:"link",onClick:()=>ke(!0)},(0,n.__)("Explorer toutes les recettes","visi-bloc-jlg"))),(0,e.createElement)("div",{className:"visibloc-scenario-presets__grid"},fe.map(t=>{const l=Se(t.severity),i=Ce[l]||Ce.medium,r=A===t.id;return(0,e.createElement)(a.Button,{key:t.id,className:`visibloc-scenario-presets__button visibloc-scenario-presets__button--${l}`,variant:r?"primary":"secondary","aria-pressed":r,onClick:()=>Be(t)},(0,e.createElement)("span",{className:"visibloc-scenario-presets__badge"},i),(0,e.createElement)("span",{className:"visibloc-scenario-presets__label"},t.label),t.description?(0,e.createElement)("span",{className:"visibloc-scenario-presets__description"},t.description):null)}))),Bt.length>0&&(0,e.createElement)(a.TabPanel,{className:"visibloc-stepper",activeClass:"is-active",initialTabName:he,onSelect:e=>je(e),tabs:Bt},l=>{const i=Nt.find(e=>e.id===l.name)||St,r=(o=i?i.summary:"")&&String(o).trim()?o:mt;var o;const a=i?i.content:null;return(0,e.createElement)(t.Fragment,null,bt(r,"is-summary"),(0,e.createElement)("div",{className:"visibloc-step-content"},a))}))),Ee&&(0,e.createElement)(a.Modal,{title:(0,n.__)("Bibliothèque de recettes","visi-bloc-jlg"),onRequestClose:()=>ke(!1),className:"visibloc-recipes-modal"},(0,e.createElement)("div",{className:"visibloc-recipes-modal__grid"},le.length>0?le.map(t=>{const l=Se(t.severity),i=Ce[l]||Ce.medium;return(0,e.createElement)(a.Card,{key:t.id,className:"visibloc-recipes-modal__card"},(0,e.createElement)(a.CardHeader,null,(0,e.createElement)("div",{className:"visibloc-recipes-modal__heading"},(0,e.createElement)("h3",{className:"visibloc-recipes-modal__title"},t.title),(0,e.createElement)("span",{className:`visibloc-scenario-presets__badge visibloc-scenario-presets__badge--${l}`},i))),(0,e.createElement)(a.CardBody,null,(0,e.createElement)("p",null,t.description)),(0,e.createElement)(a.CardFooter,null,(0,e.createElement)(a.Button,{variant:"primary",onClick:()=>Te(t)},(0,n.__)("Appliquer cette recette","visi-bloc-jlg"))))}):(0,e.createElement)("p",{className:"visibloc-recipes-modal__empty"},(0,n.__)("Aucune recette n’est disponible pour le moment.","visi-bloc-jlg"))))))},"withVisibilityControls");function Ne(){const e=(0,d.select)("core/edit-post");return!!e&&("function"==typeof e.isListViewOpened?e.isListViewOpened():"function"==typeof e.isFeatureActive&&e.isFeatureActive("listView"))}function Se(e){Ee!==e&&("undefined"!=typeof document&&document.body?(Ee=e,document.body.classList.toggle("visibloc-compact-badges",e)):Ee=e)}function Be(){if("undefined"==typeof document||"undefined"==typeof ResizeObserver)return;const e=document.querySelector(".block-editor-list-view__container")||document.querySelector(".block-editor-list-view");e&&(he||(he=new ResizeObserver(t=>{t.forEach(t=>{const l=t&&t.target?t.target:e;Se((t&&t.contentRect?t.contentRect.width:l.offsetWidth)<260)})})),je&&je!==e&&he.unobserve(je),je=e,he.observe(e),Se((e.getBoundingClientRect?e.getBoundingClientRect().width:e.offsetWidth)<260))}function Te(){if("undefined"==typeof document)return void(ye=null);const e=new Map;de.forEach((t,l)=>{let i=me.get(l);if(i&&i.isConnected||(i=document.querySelector(`.block-editor-list-view__block[data-block="${l}"]`),i&&me.set(l,i)),!i)return me.delete(l),void e.set(l,t);t.isHidden?i.classList.add("bloc-editeur-cache"):i.classList.remove("bloc-editeur-cache"),t.hasFallback?i.classList.add("bloc-editeur-repli"):i.classList.remove("bloc-editeur-repli"),t.isConditionallyHidden?i.classList.add("bloc-editeur-conditionnel"):i.classList.remove("bloc-editeur-conditionnel")}),de.clear(),e.size&&e.forEach((e,t)=>{de.set(t,e)}),de.size&&Ne()?ye=window.requestAnimationFrame(()=>{Te()}):(Be(),ye=null)}function De(e,t){const l=de.get(e);l&&l.isHidden===t.isHidden&&l.hasFallback===t.hasFallback&&l.isConditionallyHidden===t.isConditionallyHidden&&l.hiddenDescription===t.hiddenDescription&&l.conditionalDescription===t.conditionalDescription&&l.fallbackDescription===t.fallbackDescription||(de.set(e,t),ye||(ye=window.requestAnimationFrame(()=>{Te()})))}function Re(){const e=(0,d.select)("core/block-editor");if(!e)return;let t="",l=[];if("function"==typeof e.getBlocks){const i=e.getBlocks();if(Array.isArray(i))if(i!==fe){const e=(e=>{const t=[];if(!Array.isArray(e)||!e.length)return t;const l=[...e];for(;l.length;){const e=l.shift();e&&"object"==typeof e&&(e.clientId&&t.push(e.clientId),Array.isArray(e.innerBlocks)&&e.innerBlocks.length&&l.unshift(...e.innerBlocks))}return t})(i);l=e,t=e.join("|"),fe=i,_e=e}else l=Array.isArray(_e)?_e:[],t=l.join("|")}if(Array.isArray(l)&&l.length||(l=function(e){if(!e)return[];if("function"==typeof e.getClientIdsWithDescendants){const t=e.getClientIdsWithDescendants();if(Array.isArray(t))return t}const t=e.getBlockOrder();if(!Array.isArray(t)||!t.length)return[];const l=[...t],i=[];for(;l.length;){const t=l.pop();if(!t)continue;i.push(t);const r=e.getBlockOrder(t);Array.isArray(r)&&r.length&&r.forEach(e=>l.push(e))}return i}(e),t=l.join("|"),fe=null,_e=l),!l.length)return void((be.size||ue.size)&&(be.clear(),ue.clear(),de.clear(),me.clear(),pe.clear(),ve.clear(),ge="",_e=[],fe=null));const i=new Set(l);if(t!==ge&&(l.forEach(t=>{if(be.has(t))return;let l="function"==typeof e.getBlockName?e.getBlockName(t):void 0;if(!l){const i=e.getBlock(t);l=i?i.name:void 0}l&&S(l)&&(be.add(t),ve.add(t),pe.delete(t))}),Array.from(be).filter(e=>!i.has(e)).forEach(e=>{be.delete(e),ue.delete(e),de.delete(e),me.delete(e),pe.delete(e),ve.delete(e)}),ge=t),!ve.size)return;const r=Array.from(ve);ve.clear(),r.forEach(t=>{const l=e.getBlock(t);if(!l||!S(l.name))return pe.delete(t),ue.delete(t),de.delete(t),me.delete(t),void be.delete(t);const i=ce(l.attributes);if(pe.get(t)===i)return;pe.set(t,i);const r=ue.get(t)||{},o=se(l.attributes),a=o.conditionalDescription||"",s=[];l.attributes.isHidden&&s.push((0,n.__)("Bloc masqué manuellement.","visi-bloc-jlg")),a&&s.push(...a.split("\n"));const c=s.join("\n").trim(),u={...r,isHidden:Boolean(l.attributes.isHidden),hasFallback:ee(l.attributes),isConditionallyHidden:o.hasConditionalVisibility&&!l.attributes.isHidden,conditionalDescription:a,hiddenDescription:c};ue.set(t,u),De(t,u)})}const Me=v()(Re,120);function qe(){Me()}(0,i.addFilter)("blocks.registerBlockType","visi-bloc-jlg/add-visibility-attributes",function(e,t){return S(t)?(e.attributes={...e.attributes,isHidden:{type:"boolean",default:!1},deviceVisibility:{type:"string",default:"all"},isSchedulingEnabled:{type:"boolean",default:!1},publishStartDate:{type:"string"},publishEndDate:{type:"string"},publishTimezone:{type:"string",default:U},visibilityRoles:{type:"array",default:[]},advancedVisibility:{type:"object",default:W},fallbackEnabled:{type:"boolean",default:!0},fallbackBehavior:{type:"string",default:"inherit"},fallbackCustomText:{type:"string",default:""},fallbackBlockId:{type:"number"},scenarioPreset:{type:"string",default:""}},e):e}),(0,i.addFilter)("editor.BlockEdit","visi-bloc-jlg/with-visibility-controls",we),(0,i.addFilter)("blocks.getSaveContent.extraProps","visi-bloc-jlg/add-save-classes",function(e,t,l){if(!S(t.name)||!l)return e;const{deviceVisibility:i}=l,r=[e.className,i&&"all"!==i?`vb-${i}`:""].filter(Boolean).join(" ");return{...e,className:r}}),(0,i.addFilter)("editor.BlockListBlock","visi-bloc-jlg/add-editor-status-badges",(0,r.createHigherOrderComponent)(l=>i=>{const r="string"==typeof i.className?i.className:"",o=r.includes("bloc-editeur-cache"),a=r.includes("bloc-editeur-repli"),s=r.includes("bloc-editeur-conditionnel"),c=i.clientId&&ue.get(i.clientId)||{},u="string"==typeof c.hiddenDescription?c.hiddenDescription:"",d="string"==typeof c.conditionalDescription?c.conditionalDescription:"",m="string"==typeof c.fallbackDescription?c.fallbackDescription:"";if(!o&&!a&&!s)return(0,e.createElement)(l,{...i});const b=(0,e.createElement)(l,{...i}),p=t.Children.toArray(b.props.children),v=[];return o&&v.push((0,e.createElement)(k,{key:"visibloc-hidden-badge",label:(0,n.__)("Bloc masqué","visi-bloc-jlg"),variant:"hidden",screenReaderText:(0,n.__)("Ce bloc est masqué pour les visiteurs du site.","visi-bloc-jlg"),description:u})),s&&v.push((0,e.createElement)(k,{key:"visibloc-conditional-badge",label:(0,n.__)("Conditions actives","visi-bloc-jlg"),variant:"conditional",screenReaderText:(0,n.__)("Ce bloc applique des conditions de visibilité dynamiques.","visi-bloc-jlg"),description:d})),a&&v.push((0,e.createElement)(k,{key:"visibloc-fallback-badge",label:(0,n.__)("Repli actif","visi-bloc-jlg"),variant:"fallback",screenReaderText:(0,n.__)("Le contenu de repli est affiché à la place du bloc original.","visi-bloc-jlg"),description:m})),(0,t.cloneElement)(b,b.props,[...v,...p])},"withVisibilityStatusBadges")),(0,i.addFilter)("editor.BlockListBlock.props","visi-bloc-jlg/add-editor-canvas-classes",function(e,t){if(!S(t.name)||!t.attributes)return e;const{isHidden:l}=t.attributes,i=ee(t.attributes),r=se(t.attributes).hasConditionalVisibility&&!l,o=[e.className,l?"bloc-editeur-cache":"",i?"bloc-editeur-repli":"",r?"bloc-editeur-conditionnel":""].filter(Boolean).join(" ");return{...e,className:o}});let Ve=Ne();(0,d.subscribe)(function(){const e=Ne();qe(),e&&!Ve&&("function"==typeof Me.flush?Me.flush():Re(),function(){if(!de.size)return;const e=Array.from(de.entries());de.clear(),ye&&(window.cancelAnimationFrame(ye),ye=null),e.forEach(([e,t])=>{De(e,t)})}()),e?Be():Ve&&(he&&je&&he.unobserve(je),he&&he.disconnect(),he=null,je=null,Se(!1)),Ve=e})})()})();