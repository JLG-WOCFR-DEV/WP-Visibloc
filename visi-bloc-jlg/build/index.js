(()=>{var e={124:(e,t,l)=>{var i=l(325);e.exports=function(){return i.Date.now()}},128:(e,t,l)=>{var i=l(800),o=/^\s+/;e.exports=function(e){return e?e.slice(0,i(e)+1).replace(o,""):e}},221:(e,t,l)=>{var i=l(805),o=l(124),r=l(374),a=Math.max,n=Math.min;e.exports=function(e,t,l){var s,c,u,d,b,m,p=0,v=!1,g=!1,_=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var l=s,i=c;return s=c=void 0,p=t,d=e.apply(i,l)}function h(e){var l=e-m;return void 0===m||l>=t||l<0||g&&e-p>=u}function y(){var e=o();if(h(e))return j(e);b=setTimeout(y,function(e){var l=t-(e-m);return g?n(l,u-(e-p)):l}(e))}function j(e){return b=void 0,_&&s?f(e):(s=c=void 0,d)}function k(){var e=o(),l=h(e);if(s=arguments,c=this,m=e,l){if(void 0===b)return function(e){return p=e,b=setTimeout(y,t),v?f(e):d}(m);if(g)return clearTimeout(b),b=setTimeout(y,t),f(m)}return void 0===b&&(b=setTimeout(y,t)),d}return t=r(t)||0,i(l)&&(v=!!l.leading,u=(g="maxWait"in l)?a(r(l.maxWait)||0,t):u,_="trailing"in l?!!l.trailing:_),k.cancel=function(){void 0!==b&&clearTimeout(b),p=0,s=m=c=b=void 0},k.flush=function(){return void 0===b?d:j(o())},k}},325:(e,t,l)=>{var i=l(840),o="object"==typeof self&&self&&self.Object===Object&&self,r=i||o||Function("return this")();e.exports=r},346:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},350:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},374:(e,t,l)=>{var i=l(128),o=l(805),r=l(394),a=/^[-+]0x[0-9a-f]+$/i,n=/^0b[01]+$/i,s=/^0o[0-7]+$/i,c=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(r(e))return NaN;if(o(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=o(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=i(e);var l=n.test(e);return l||s.test(e)?c(e.slice(2),l?2:8):a.test(e)?NaN:+e}},394:(e,t,l)=>{var i=l(552),o=l(346);e.exports=function(e){return"symbol"==typeof e||o(e)&&"[object Symbol]"==i(e)}},552:(e,t,l)=>{var i=l(873),o=l(659),r=l(350),a=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?o(e):r(e)}},659:(e,t,l)=>{var i=l(873),o=Object.prototype,r=o.hasOwnProperty,a=o.toString,n=i?i.toStringTag:void 0;e.exports=function(e){var t=r.call(e,n),l=e[n];try{e[n]=void 0;var i=!0}catch(e){}var o=a.call(e);return i&&(t?e[n]=l:delete e[n]),o}},800:e=>{var t=/\s/;e.exports=function(e){for(var l=e.length;l--&&t.test(e.charAt(l)););return l}},805:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},840:(e,t,l)=>{var i="object"==typeof l.g&&l.g&&l.g.Object===Object&&l.g;e.exports=i},873:(e,t,l)=>{var i=l(325).Symbol;e.exports=i}},t={};function l(i){var o=t[i];if(void 0!==o)return o.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,l),r.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var i in t)l.o(t,i)&&!l.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.React,t=window.wp.element,i=window.wp.hooks,o=window.wp.compose,r=window.wp.blockEditor,a=window.wp.components,n=window.wp.i18n,s=window.wp.date,c=window.wp.data,u=window.wp.autop;var d=l.n(u),b=l(221),m=l.n(b);const p=["core/group"],v=()=>(0,e.createElement)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",role:"presentation",focusable:"false","aria-hidden":"true"},(0,e.createElement)("rect",{x:"7",y:"3",width:"10",height:"18",rx:"2",ry:"2",fill:"currentColor",opacity:"0.2"}),(0,e.createElement)("rect",{x:"9",y:"5",width:"6",height:"14",rx:"1.2",ry:"1.2",fill:"none",stroke:"currentColor",strokeWidth:"1.5"}),(0,e.createElement)("circle",{cx:"12",cy:"17.5",r:"0.9",fill:"currentColor"})),g=()=>(0,e.createElement)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",role:"presentation",focusable:"false","aria-hidden":"true"},(0,e.createElement)("rect",{x:"3",y:"7",width:"18",height:"10",rx:"2",ry:"2",fill:"currentColor",opacity:"0.2"}),(0,e.createElement)("rect",{x:"5",y:"9",width:"14",height:"6",rx:"1.2",ry:"1.2",fill:"none",stroke:"currentColor",strokeWidth:"1.5"}),(0,e.createElement)("circle",{cx:"17.5",cy:"12",r:"0.9",fill:"currentColor"})),_={hidden:()=>(0,e.createElement)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",role:"presentation",focusable:"false","aria-hidden":"true"},(0,e.createElement)("path",{d:"M2 12c2.8-5.3 6.5-8 10-8s7.2 2.7 10 8c-2.8 5.3-6.5 8-10 8s-7.2-2.7-10-8z",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinejoin:"round"}),(0,e.createElement)("circle",{cx:"12",cy:"12",r:"3",fill:"currentColor",opacity:"0.2"}),(0,e.createElement)("path",{d:"M12 9a3 3 0 0 1 3 3m6.5 6.5-17-17",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"})),schedule:()=>(0,e.createElement)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",role:"presentation",focusable:"false","aria-hidden":"true"},(0,e.createElement)("circle",{cx:"12",cy:"12",r:"7.5",fill:"none",stroke:"currentColor",strokeWidth:"1.6"}),(0,e.createElement)("path",{d:"M12 8.5v4l2.5 2",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})),"schedule-error":()=>(0,e.createElement)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",role:"presentation",focusable:"false","aria-hidden":"true"},(0,e.createElement)("circle",{cx:"11",cy:"11",r:"7",fill:"none",stroke:"currentColor",strokeWidth:"1.6"}),(0,e.createElement)("path",{d:"M11 7.5v3.7l2.1 1.6",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),(0,e.createElement)("path",{d:"M17.5 13.5v3.5",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"}),(0,e.createElement)("circle",{cx:"17.5",cy:"18.5",r:"0.8",fill:"currentColor"})),fallback:()=>(0,e.createElement)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",role:"presentation",focusable:"false","aria-hidden":"true"},(0,e.createElement)("path",{d:"M5.5 9.5 12 6l6.5 3.5L12 13z",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinejoin:"round"}),(0,e.createElement)("path",{d:"M5.5 14.5 12 18l6.5-3.5",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinejoin:"round"})),advanced:()=>(0,e.createElement)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",role:"presentation",focusable:"false","aria-hidden":"true"},(0,e.createElement)("path",{d:"M7 5v14M17 5v14",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"}),(0,e.createElement)("circle",{cx:"7",cy:"10",r:"2.5",fill:"currentColor",opacity:"0.2",stroke:"currentColor",strokeWidth:"1.2"}),(0,e.createElement)("circle",{cx:"17",cy:"14",r:"2.5",fill:"currentColor",opacity:"0.2",stroke:"currentColor",strokeWidth:"1.2"})),default:()=>(0,e.createElement)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",role:"presentation",focusable:"false","aria-hidden":"true"},(0,e.createElement)("circle",{cx:"12",cy:"12",r:"8",fill:"none",stroke:"currentColor",strokeWidth:"1.6"}),(0,e.createElement)("circle",{cx:"12",cy:"8.5",r:"1",fill:"currentColor"}),(0,e.createElement)("path",{d:"M11 11.5h2v6",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"}))},f=({label:t,variant:l="",screenReaderText:i="",description:o=""})=>{const r=["visibloc-status-badge"],n="string"==typeof o&&o.trim().length>0,s="string"==typeof l?l.trim():"";s&&r.push(`visibloc-status-badge--${s}`);const c=_[s]||_.default,u=(0,e.createElement)("span",{className:r.join(" ")},c?(0,e.createElement)("span",{className:"visibloc-status-badge__icon","aria-hidden":"true"},(0,e.createElement)(c,null)):null,(0,e.createElement)("span",{className:"visibloc-status-badge__label"},t),n?(0,e.createElement)("span",{className:"visibloc-status-badge__description"},o):null,i?(0,e.createElement)("span",{className:"screen-reader-text"},i):null);return n?(0,e.createElement)(a.Tooltip,{text:o},u):u},h=e=>Array.isArray(e)?Array.from(new Set(e.map(e=>"string"==typeof e?e.trim():"").filter(Boolean))):[],y=h("object"==typeof VisiBlocData&&null!==VisiBlocData&&Array.isArray(VisiBlocData.supportedBlocks)?VisiBlocData.supportedBlocks:p),j=y.length>0?y:p,k=h((0,i.applyFilters)("visiblocSupportedBlocks",j)),E=k.length>0?k:j,C=e=>E.includes(e),x="function"==typeof s.__experimentalGetSettings?(0,s.__experimentalGetSettings)():{},{formats:w={}}=x||{},N="string"==typeof w.date&&w.date.trim()?w.date:"F j, Y",B="string"==typeof w.time&&w.time.trim()?w.time:"H:i",T="string"==typeof w.datetime&&w.datetime.trim()?w.datetime:`${N} ${B}`.trim(),A=(e=>{if(!e||"object"!=typeof e)return!1;if("boolean"==typeof e.twelveHourTime)return e.twelveHourTime;const{formats:t}=e;if(t&&"object"==typeof t){const{time:e}=t;if("string"==typeof e&&e.trim())return/a(?!\\)/i.test(e)}return!1})(x),S=(()=>{if(!x||"object"!=typeof x)return"UTC";const{timezone:e,timezoneAbbr:t,gmt_offset:l}=x;if(e&&"object"==typeof e){if("string"==typeof e.string&&e.string.trim())return e.string.trim();if("string"==typeof e.abbr&&e.abbr.trim())return e.abbr.trim()}if("string"==typeof e&&e.trim())return e.trim();if("string"==typeof t&&t.trim())return t.trim();return(e=>{if("number"!=typeof e||Number.isNaN(e))return"";if(0===e)return"UTC";const t=e>0?"+":"-",l=Math.abs(e),i=Math.round(60*l),o=Math.floor(i/60),r=i%60;return`UTC${t}${String(o).padStart(2,"0")}:${String(r).padStart(2,"0")}`})(l)||"UTC"})(),D=e=>e?"function"==typeof s.dateI18n?(0,s.dateI18n)(T,e):(0,s.format)(T,e):null,q=()=>(0,s.format)("Y-m-d\\TH:i:s",new Date),M=e=>{if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t},F={id:"all",label:(0,n.__)("Visible sur tous les appareils","visi-bloc-jlg")},R=[{id:"show-only",label:(0,n.__)("Afficher uniquement","visi-bloc-jlg"),options:[{id:"desktop-only",label:(0,n.__)("Desktop","visi-bloc-jlg"),icon:"desktop"},{id:"tablet-only",label:(0,n.__)("Tablette","visi-bloc-jlg"),icon:"tablet"},{id:"mobile-only",label:(0,n.__)("Mobile","visi-bloc-jlg"),icon:"smartphone"}]},{id:"hide-on",label:(0,n.__)("Masquer sur","visi-bloc-jlg"),options:[{id:"hide-on-desktop",label:(0,n.__)("Desktop","visi-bloc-jlg"),icon:"desktop"},{id:"hide-on-tablet",label:(0,n.__)("Tablette","visi-bloc-jlg"),icon:"tablet"},{id:"hide-on-mobile",label:(0,n.__)("Mobile","visi-bloc-jlg"),icon:"smartphone"}]},{id:"orientation-show",label:(0,n.__)("Orientation ciblée","visi-bloc-jlg"),options:[{id:"portrait-only",label:(0,n.__)("Portrait","visi-bloc-jlg"),icon:v},{id:"landscape-only",label:(0,n.__)("Paysage","visi-bloc-jlg"),icon:g}]},{id:"orientation-hide",label:(0,n.__)("Masquer en orientation","visi-bloc-jlg"),options:[{id:"hide-on-portrait",label:(0,n.__)("Portrait","visi-bloc-jlg"),icon:v},{id:"hide-on-landscape",label:(0,n.__)("Paysage","visi-bloc-jlg"),icon:g}]}],O=R.reduce((e,t)=>t&&Array.isArray(t.options)?e.concat(t.options):e,[]),H=["post_type","taxonomy","template","recurring_schedule","logged_in_status","user_role_group","user_segment","woocommerce_cart","query_param","cookie","visit_count"],L=[{value:"post_type",label:(0,n.__)("Type de contenu","visi-bloc-jlg")},{value:"taxonomy",label:(0,n.__)("Taxonomie","visi-bloc-jlg")},{value:"template",label:(0,n.__)("Modèle de page","visi-bloc-jlg")},{value:"recurring_schedule",label:(0,n.__)("Horaire récurrent","visi-bloc-jlg")},{value:"logged_in_status",label:(0,n.__)("État de connexion","visi-bloc-jlg")},{value:"user_role_group",label:(0,n.__)("Groupe de rôles","visi-bloc-jlg")},{value:"user_segment",label:(0,n.__)("Segment marketing","visi-bloc-jlg")},{value:"woocommerce_cart",label:(0,n.__)("Panier WooCommerce","visi-bloc-jlg")},{value:"query_param",label:(0,n.__)("Paramètre d’URL","visi-bloc-jlg")},{value:"cookie",label:(0,n.__)("Cookie","visi-bloc-jlg")},{value:"visit_count",label:(0,n.__)("Compteur de visites","visi-bloc-jlg")}],P=Object.freeze({logic:"AND",rules:[]}),W=Object.freeze({frequency:"daily",days:[],startTime:"08:00",endTime:"17:00"}),V="site",I=e=>{if("object"!=typeof VisiBlocData||null===VisiBlocData)return[];const t=VisiBlocData[e];return Array.isArray(t)?t:[]},z=e=>{if("object"!=typeof VisiBlocData||null===VisiBlocData)return null;const t=VisiBlocData[e];return t&&"object"==typeof t?t:null},$=e=>{if("string"!=typeof e)return"";const t=e.trim();if(!t)return"";if("undefined"==typeof document)return t;const l=document.createElement("template");return l.innerHTML=t,l.content.querySelectorAll("script, iframe, frame, frameset, object, embed, link, meta, style, noscript, form, input, button, textarea, select").forEach(e=>{e.remove()}),l.content.querySelectorAll("*").forEach(e=>{Array.from(e.attributes).forEach(t=>{const l=t.name.toLowerCase();if(l.startsWith("on"))e.removeAttribute(t.name);else if(["src","href","xlink:href"].includes(l)){const l=t.value.trim().toLowerCase();(l.startsWith("javascript:")||l.startsWith("data:"))&&e.removeAttribute(t.name)}})}),l.innerHTML.trim()},U=e=>{if(!e||"object"!=typeof e)return!1;const t=void 0===e.fallbackEnabled||Boolean(e.fallbackEnabled),l="string"==typeof e.fallbackBehavior?e.fallbackBehavior:"inherit";if(!t)return!1;if("text"===l)return("string"==typeof e.fallbackCustomText?e.fallbackCustomText:"").trim().length>0;if("block"===l)return Boolean(e.fallbackBlockId);const i=z("fallbackSettings")||{};return Boolean(i&&i.hasContent)},G=new Map,Q=new Map,J=new Map,Y=new Set,K=new Map,X=new Set;let Z="",ee=null,te=null,le=null,ie=!1;const oe=(()=>{const e=I("daysOfWeek"),t=new Map;return e.forEach(e=>{e&&"object"==typeof e&&"string"==typeof e.value&&t.set(e.value,e.label||e.value)}),t})(),re=()=>`rule-${Math.random().toString(36).slice(2)}-${Date.now()}`,ae=e=>{if(!Array.isArray(e)||!e.length)return"";const t=e.find(e=>e&&void 0!==e.value);if(!t)return"";const l=void 0===t.value||null===t.value?"":t.value;return String(l)},ne=e=>{switch(e){case"taxonomy":return(()=>{const e=I("taxonomies").find(e=>e&&"string"==typeof e.slug);return{id:re(),type:"taxonomy",operator:"in",taxonomy:e?e.slug:"",terms:[]}})();case"template":return(()=>{const e=I("templates");return{id:re(),type:"template",operator:"is",value:ae(e)}})();case"recurring_schedule":return{id:re(),type:"recurring_schedule",operator:"matches",...W};case"logged_in_status":return(()=>{const e=I("loginStatuses");return{id:re(),type:"logged_in_status",operator:"is",value:ae(e)}})();case"user_role_group":return(()=>{const e=I("roleGroups");return{id:re(),type:"user_role_group",operator:"matches",group:ae(e)}})();case"user_segment":return(()=>{const e=I("userSegments");return{id:re(),type:"user_segment",operator:"matches",segment:ae(e)}})();case"woocommerce_cart":return(()=>{const e=I("woocommerceTaxonomies").find(e=>e&&"string"==typeof e.slug);return{id:re(),type:"woocommerce_cart",operator:"contains",taxonomy:e?e.slug:"",terms:[]}})();case"query_param":return(()=>{const e=I("commonQueryParams");return{id:re(),type:"query_param",operator:"equals",param:ae(e),value:""}})();case"cookie":return(()=>{const e=I("commonCookies");return{id:re(),type:"cookie",operator:"equals",name:ae(e),value:""}})();case"visit_count":return{id:re(),type:"visit_count",operator:"at_least",threshold:3};default:return(()=>{const e=I("postTypes");return{id:re(),type:"post_type",operator:"is",value:ae(e)}})()}},se=e=>{if(!e||"object"!=typeof e)return null;const{type:t}=e;if(!H.includes(t))return null;const l={id:"string"==typeof e.id&&e.id?e.id:re(),type:t};if("post_type"===t)return l.operator="is_not"===e.operator?"is_not":"is",l.value="string"==typeof e.value?e.value:"",l;if("taxonomy"===t)return l.operator="not_in"===e.operator?"not_in":"in",l.taxonomy="string"==typeof e.taxonomy?e.taxonomy:"",l.terms=Array.isArray(e.terms)?e.terms.map(e=>"string"==typeof e||"number"==typeof e?String(e):"").filter(Boolean):[],l;if("template"===t)return l.operator="is_not"===e.operator?"is_not":"is",l.value="string"==typeof e.value?e.value:"",l;if("logged_in_status"===t)return l.operator="is_not"===e.operator?"is_not":"is",l.value="string"==typeof e.value?e.value:"",l;if("user_role_group"===t)return l.operator="does_not_match"===e.operator?"does_not_match":"matches",l.group="string"==typeof e.group?e.group:"",l;if("user_segment"===t)return l.operator="does_not_match"===e.operator?"does_not_match":"matches",l.segment="string"==typeof e.segment?e.segment:"",l;if("woocommerce_cart"===t)return l.operator="not_contains"===e.operator?"not_contains":"contains",l.taxonomy="string"==typeof e.taxonomy?e.taxonomy:"",l.terms=Array.isArray(e.terms)?e.terms.map(e=>"string"==typeof e||"number"==typeof e?String(e):"").filter(Boolean):[],l;if("query_param"===t){const t=["equals","not_equals","contains","not_contains","exists","not_exists"];return l.operator=t.includes(e.operator)?e.operator:"equals",l.param="string"==typeof e.param?e.param:"",l.value="string"==typeof e.value?e.value:"",l}if("cookie"===t){const t=["equals","not_equals","contains","not_contains","exists","not_exists"];return l.operator=t.includes(e.operator)?e.operator:"equals",l.name="string"==typeof e.name?e.name:"",l.value="string"==typeof e.value?e.value:"",l}if("visit_count"===t){const t=["at_least","at_most","equals","not_equals"],i=Number.parseInt(e.threshold,10),o=Number.isFinite(i)&&i>=0?i:0;return l.operator=t.includes(e.operator)?e.operator:"at_least",l.threshold=o,l}return l.operator="matches",l.frequency="weekly"===e.frequency?"weekly":"daily",l.days=Array.isArray(e.days)?e.days.map(e=>"string"==typeof e?e:"").filter(e=>oe.has(e)):[],l.startTime="string"==typeof e.startTime?e.startTime:W.startTime,l.endTime="string"==typeof e.endTime?e.endTime:W.endTime,l},ce=e=>e&&"object"==typeof e?{logic:"OR"===e.logic?"OR":"AND",rules:Array.isArray(e.rules)?e.rules.map(se).filter(Boolean):[]}:{logic:P.logic,rules:[...P.rules]},ue=(0,o.createHigherOrderComponent)(l=>i=>{if(!C(i.name))return(0,e.createElement)(l,{...i});const{attributes:s,setAttributes:u,isSelected:b,clientId:m}=i,{isHidden:p,deviceVisibility:v,isSchedulingEnabled:g,publishStartDate:_,publishEndDate:f,publishTimezone:h=V,visibilityRoles:y,advancedVisibility:j,fallbackEnabled:k=!0,fallbackBehavior:E="inherit",fallbackCustomText:x="",fallbackBlockId:w}=s,N=ce(j),B=z("fallbackSettings")||{},[T,P]=(0,t.useState)(!1),[W,K]=(0,t.useState)("device"),Z=U(s),ee=Boolean(B&&B.hasContent),te=B&&"string"==typeof B.summary?B.summary:"",le=B&&"string"==typeof B.previewHtml?B.previewHtml:"",ie=I("fallbackBlocks").filter(e=>e&&"object"==typeof e).map(e=>{const t="number"==typeof e.value?e.value:parseInt(e.value,10),l=Number.isNaN(t)?0:t;return{value:String(l),label:"string"==typeof e.label&&e.label.trim()?e.label:`#${l}`}}),re=[{value:"inherit",label:(0,n.__)("Utiliser le repli global","visi-bloc-jlg")},{value:"text",label:(0,n.__)("Texte personnalisé","visi-bloc-jlg")},{value:"block",label:(0,n.__)("Bloc réutilisable","visi-bloc-jlg")}],ae=(0,t.useMemo)(()=>$(le),[le]),de=(0,t.useMemo)(()=>"text"===E?(e=>{if("string"!=typeof e)return"";const t=e.trim();if(!t)return"";let l=t;return"function"==typeof d()&&(l=d()(t)),$(l)})(x):"",[E,x]);(0,t.useEffect)(()=>{!function(e){e&&(X.add(e),fe())}(m)},[m,p,E,x,w,k]);const{blockPreviewHtml:be,isBlockPreviewResolving:me}=(0,c.useSelect)(e=>{if("block"!==E||!w)return{blockPreviewHtml:"",isBlockPreviewResolving:!1};const t=e("core"),l=e("core/data"),i=t?t.getEntityRecord("postType","wp_block",w):void 0,o=!!l&&l.isResolving("core","getEntityRecord",["postType","wp_block",w]);return{blockPreviewHtml:i&&i.content&&"string"==typeof i.content.rendered?i.content.rendered:"",isBlockPreviewResolving:o||void 0===i}},[E,w]),pe=(0,t.useMemo)(()=>"block"===E?$(be):"",[E,be]),ge=(0,t.useMemo)(()=>k?"text"===E?"string"==typeof x&&x.trim()?de?{status:"ready",message:"",html:de}:{status:"warning",message:(0,n.__)("Prévisualisation indisponible pour ce texte.","visi-bloc-jlg"),html:""}:{status:"warning",message:(0,n.__)("Aucun texte de repli défini.","visi-bloc-jlg"),html:""}:"block"===E?w?me?{status:"info",message:(0,n.__)("Chargement de l’aperçu du bloc de repli…","visi-bloc-jlg"),html:""}:pe?{status:"ready",message:"",html:pe}:{status:"warning",message:(0,n.__)("Impossible d’afficher l’aperçu du bloc sélectionné.","visi-bloc-jlg"),html:""}:{status:"warning",message:(0,n.__)("Aucun bloc réutilisable sélectionné.","visi-bloc-jlg"),html:""}:ee?ae?{status:"ready",message:"",html:ae}:{status:"warning",message:(0,n.__)("Aucun aperçu disponible pour le repli global.","visi-bloc-jlg"),html:""}:{status:"warning",message:(0,n.__)("Aucun repli global n’est configuré.","visi-bloc-jlg"),html:""}:{status:"info",message:(0,n.__)("Le repli est désactivé pour ce bloc.","visi-bloc-jlg"),html:""},[k,E,x,de,w,me,pe,ee,ae]),_e=ge.html,he=ge.status,ye=ge.message,je=(0,t.useRef)(null),ke=(0,o.useInstanceId)(ue,"visibloc-fallback-preview"),Ee=`${ke}__label`;(0,t.useEffect)(()=>{T&&k&&je.current&&je.current.focus({preventScroll:!0})},[T,k,_e,he]),(0,t.useEffect)(()=>()=>{m&&(G.delete(m),Q.delete(m),J.delete(m),Y.delete(m))},[m]);const Ce=e=>{const t=ce({...N}),l=e(t)||t;u({advancedVisibility:ce(l)})},xe=(e,t)=>{const l=e?[...y,t]:y.filter(e=>e!==t);u({visibilityRoles:l})},we=(0,t.useMemo)(()=>I("timezones"),[]),Ne=(0,t.useMemo)(()=>we.map(e=>{if(!e||"object"!=typeof e)return null;const t="string"==typeof e.value?e.value.trim():"";return t?{value:t,label:"string"==typeof e.label&&e.label.trim()?e.label:t}:null}).filter(Boolean),[we]),Be=(0,t.useMemo)(()=>(0,n.sprintf)((0,n.__)("Fuseau du site (%s)","visi-bloc-jlg"),S),[]),Te=(0,t.useMemo)(()=>[{value:V,label:Be},...Ne],[Be,Ne]),Ae=(0,t.useMemo)(()=>Te.some(e=>e.value===h)?h:V,[h,Te]),Se=(0,t.useMemo)(()=>{const e=Te.find(e=>e.value===Ae);return e?e.label:Be},[Ae,Te,Be]),De=Ae!==V,qe=(0,t.useMemo)(()=>(0,n.sprintf)((0,n.__)("Fuseau horaire : %s","visi-bloc-jlg"),Se),[Se]);let Me=(0,n.__)("Aucune programmation.","visi-bloc-jlg");const Fe=M(_),Re=M(f),Oe=g&&!!Fe&&!!Re&&Re.getTime()<Fe.getTime();if(g){const e=D(_),t=D(f);
/* translators: 1: Start date, 2: end date. */
Me=e&&t?(0,n.sprintf)((0,n.__)("Du %s au %s.","visi-bloc-jlg"),e,t):e?(0,n.sprintf)((0,n.__)("À partir du %s.","visi-bloc-jlg"),e):t?(0,n.sprintf)((0,n.__)("Jusqu'au %s.","visi-bloc-jlg"),t):(0,n.__)("Activée, mais sans date définie.","visi-bloc-jlg"),Oe&&(Me=(0,n.__)("Dates de programmation invalides.","visi-bloc-jlg"))}const He=(0,n.__)("Inactif","visi-bloc-jlg"),Le=(t,l="")=>{if(!t)return null;const i=["visi-bloc-help-text"];return l&&i.push(l),(0,e.createElement)("p",{className:i.join(" ")},t)},Pe=(()=>{if(!v||v===F.id)return"";const e=R.find(e=>!!Array.isArray(e.options)&&e.options.some(e=>e.id===v)),t=O.find(e=>e.id===v);return t?e?`${e.label} – ${t.label}`:t.label:""})(),We=(()=>{if(!g)return"";if(Oe)return(0,n.__)("Erreur de dates","visi-bloc-jlg");let e;return e=_&&f?(0,n.__)("Plage définie","visi-bloc-jlg"):_||f?(0,n.__)("Date définie","visi-bloc-jlg"):(0,n.__)("Programmation active","visi-bloc-jlg"),De?`${e} – ${Se}`:e})(),Ve=(()=>{const e=Array.from(new Set((y||[]).filter(Boolean))).length;return e?(0,n.sprintf)((0,n._n)("%d rôle","%d rôles",e,"visi-bloc-jlg"),e):""})(),Ie=(()=>{const e=Array.isArray(N.rules)?N.rules.length:0;if(!e)return"";const t="OR"===N.logic?(0,n.__)("OU","visi-bloc-jlg"):(0,n.__)("ET","visi-bloc-jlg");return(0,n.sprintf)((0,n._n)("%1$d règle %2$s","%1$d règles %2$s",e,"visi-bloc-jlg"),e,t)})(),ze=(()=>{if(!k)return"";const e={inherit:(0,n.__)("Global","visi-bloc-jlg"),text:(0,n.__)("Texte","visi-bloc-jlg"),block:(0,n.__)("Bloc","visi-bloc-jlg")};return"block"!==E||w?e[E]||e.inherit:(0,n.__)("Bloc","visi-bloc-jlg")})(),$e=[];p&&$e.push((0,n.__)("Bloc masqué manuellement.","visi-bloc-jlg")),Pe&&$e.push((0,n.sprintf)((0,n.__)("Appareils : %s","visi-bloc-jlg"),Pe)),g&&($e.push((0,n.sprintf)((0,n.__)("Programmation : %s","visi-bloc-jlg"),Me)),$e.push((0,n.sprintf)((0,n.__)("Fuseau horaire : %s","visi-bloc-jlg"),Se))),Ve&&$e.push((0,n.sprintf)((0,n.__)("Rôles ciblés : %s","visi-bloc-jlg"),Ve)),Ie&&$e.push((0,n.sprintf)((0,n.__)("Règles avancées : %s","visi-bloc-jlg"),Ie));const Ue=[];if(Z)if(ze&&Ue.push((0,n.sprintf)((0,n.__)("Type : %s","visi-bloc-jlg"),ze)),"inherit"===E)te?Ue.push((0,n.sprintf)((0,n.__)("Repli global : %s","visi-bloc-jlg"),te)):ee?Ue.push((0,n.__)("Utilise le contenu de repli global.","visi-bloc-jlg")):Ue.push((0,n.__)("Aucun repli global défini.","visi-bloc-jlg"));else if("text"===E){const e="string"==typeof x?x.trim():"";e&&Ue.push(e)}else if("block"===E&&w){const e=ie.find(e=>e.value===String(w));e&&e.label&&Ue.push((0,n.sprintf)((0,n.__)("Bloc : %s","visi-bloc-jlg"),e.label))}if(m){const e=$e.join("\n").trim(),t=Ue.join("\n").trim(),l=G.get(m)||{},i={...l,isHidden:Boolean(p),hasFallback:Z,hiddenDescription:e,fallbackDescription:t};G.set(m,i),l.isHidden===i.isHidden&&l.hasFallback===i.hasFallback&&l.hiddenDescription===i.hiddenDescription&&l.fallbackDescription===i.fallbackDescription||ve(m,i)}const Ge=[{id:"device",label:(0,n.__)("Appareils","visi-bloc-jlg"),summary:Pe,content:(0,e.createElement)(a.BaseControl,{label:(0,n.__)("Visibilité par appareil","visi-bloc-jlg")},(0,e.createElement)("div",{className:"visi-bloc-device-toggle-groups"},R.map(t=>{const l=t.options.some(e=>e.id===v);return(0,e.createElement)("div",{key:t.id,className:"visi-bloc-device-toggle-group"},(0,e.createElement)(a.BaseControl.VisualLabel,null,t.label),(0,e.createElement)(a.ToggleGroupControl,{className:"visi-bloc-device-toggle",isBlock:!0,isDeselectable:!0,value:l?v:void 0,onChange:e=>u({deviceVisibility:e||F.id})},t.options.map(t=>(0,e.createElement)(a.ToggleGroupControlOptionIcon,{key:t.id,value:t.id,icon:t.icon,label:t.label}))))}),(0,e.createElement)(a.Button,{className:"visi-bloc-device-toggle-reset",variant:"link",isLink:!0,onClick:()=>u({deviceVisibility:F.id}),disabled:v===F.id},F.label)))},{id:"schedule",label:(0,n.__)("Calendrier","visi-bloc-jlg"),summary:We,content:(0,e.createElement)(t.Fragment,null,(0,e.createElement)(a.ToggleControl,{label:(0,n.__)("Activer la programmation","visi-bloc-jlg"),checked:g,onChange:()=>u({isSchedulingEnabled:!g})}),Le(Me,"is-subtle"),g&&(0,e.createElement)("div",{className:"visibloc-schedule-controls"},Oe&&(0,e.createElement)(a.Notice,{status:"error",isDismissible:!1},(0,n.__)("La date de fin doit être postérieure à la date de début.","visi-bloc-jlg")),(0,e.createElement)(a.ComboboxControl,{label:(0,n.__)("Fuseau horaire de programmation","visi-bloc-jlg"),value:Ae,options:Te,onChange:e=>{const t=Te.find(t=>t.value===e);u({publishTimezone:t?t.value:V})},placeholder:(0,n.__)("Rechercher un fuseau horaire…","visi-bloc-jlg"),__nextHasNoMarginBottom:!0,help:(0,n.__)("Choisissez un fuseau horaire spécifique pour cette plage. Par défaut, le fuseau du site est utilisé.","visi-bloc-jlg")}),Le(qe,"is-subtle"),(0,e.createElement)("div",{className:"visibloc-schedule-date-field"},(0,e.createElement)(a.CheckboxControl,{label:(0,n.__)("Définir une date de début","visi-bloc-jlg"),checked:!!_,onChange:e=>{u({publishStartDate:e?q():void 0})}}),!!_&&(0,e.createElement)("div",{className:"visi-bloc-datepicker-wrapper"},(0,e.createElement)(a.DateTimePicker,{currentDate:_,onChange:e=>u({publishStartDate:e}),is12Hour:A}))),(0,e.createElement)("div",{className:"visibloc-schedule-date-field"},(0,e.createElement)(a.CheckboxControl,{label:(0,n.__)("Définir une date de fin","visi-bloc-jlg"),checked:!!f,onChange:e=>{u({publishEndDate:e?q():void 0})}}),!!f&&(0,e.createElement)("div",{className:"visi-bloc-datepicker-wrapper"},(0,e.createElement)(a.DateTimePicker,{currentDate:f,onChange:e=>u({publishEndDate:e}),is12Hour:A})))))},{id:"roles",label:(0,n.__)("Rôles","visi-bloc-jlg"),summary:Ve,content:(0,e.createElement)(a.BaseControl,{label:(0,n.__)("Audience ciblée","visi-bloc-jlg"),help:(0,n.__)("Sélectionnez les rôles autorisés à voir ce bloc. Laisser vide pour l’afficher à tout le monde.","visi-bloc-jlg")},(0,e.createElement)("div",{className:"visibloc-roles-list"},(0,e.createElement)(a.CheckboxControl,{label:(0,n.__)("Visiteurs déconnectés","visi-bloc-jlg"),checked:y.includes("logged-out"),onChange:e=>xe(e,"logged-out")}),(0,e.createElement)(a.CheckboxControl,{label:(0,n.__)("Utilisateurs connectés (tous)","visi-bloc-jlg"),checked:y.includes("logged-in"),onChange:e=>xe(e,"logged-in")}),(0,e.createElement)("div",{className:"visibloc-roles-list__divider","aria-hidden":"true"}),Object.entries(VisiBlocData.roles||{}).sort(([,e],[,t])=>String(e).localeCompare(String(t))).map(([t,l])=>(0,e.createElement)(a.CheckboxControl,{key:t,label:l,checked:y.includes(t),onChange:e=>xe(e,t)}))))},{id:"advanced",label:(0,n.__)("Règles avancées","visi-bloc-jlg"),summary:Ie,content:(0,e.createElement)("div",{className:"visibloc-advanced-rules"},(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Logique entre les règles","visi-bloc-jlg"),value:N.logic,options:[{value:"AND",label:(0,n.__)("Toutes les règles doivent être vraies (ET)","visi-bloc-jlg")},{value:"OR",label:(0,n.__)("Au moins une règle doit être vraie (OU)","visi-bloc-jlg")}],onChange:e=>Ce(t=>({...t,logic:"OR"===e?"OR":"AND"}))}),N.rules.map((t,l)=>((t,l)=>{const i=e=>{Ce(i=>{const o=[...i.rules];return o[l]=se({...t,...e}),{...i,rules:o}})},o=(0,e.createElement)(a.Flex,{align:"center",wrap:!0},(0,e.createElement)(a.FlexBlock,null,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Type de règle","visi-bloc-jlg"),value:t.type,options:L,onChange:e=>{H.includes(e)&&Ce(t=>{const i=[...t.rules],o=ne(e);return i[l]=o,{...t,rules:i}})}})),(0,e.createElement)(a.FlexItem,null,(0,e.createElement)(a.Button,{isDestructive:!0,variant:"tertiary",onClick:()=>{Ce(e=>{const t=e.rules.filter((e,t)=>t!==l);return{...e,rules:t}})}},(0,n.__)("Supprimer","visi-bloc-jlg"))));if("post_type"===t.type){const l=I("postTypes").map(e=>({value:e.value,label:e.label}));return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},o,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:t.operator,options:[{value:"is",label:(0,n.__)("Est","visi-bloc-jlg")},{value:"is_not",label:(0,n.__)("N’est pas","visi-bloc-jlg")}],onChange:e=>i({operator:e})}),(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Type de contenu","visi-bloc-jlg"),value:t.value,options:l,onChange:e=>i({value:e})}))}if("taxonomy"===t.type){const l=I("taxonomies"),r=l.find(e=>e.slug===t.taxonomy),s=l.map(e=>({value:e.slug,label:e.label})),c=(r&&Array.isArray(r.terms)?r.terms:[]).map(e=>({value:e.value,label:e.label})),u=(e,l)=>{const o=String(l),r=e?[...t.terms,o]:t.terms.filter(e=>e!==o);i({terms:r})};return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},o,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Taxonomie","visi-bloc-jlg"),value:t.taxonomy,options:s,onChange:e=>i({taxonomy:e,terms:[]})}),(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:t.operator,options:[{value:"in",label:(0,n.__)("Inclut au moins un terme","visi-bloc-jlg")},{value:"not_in",label:(0,n.__)("Exclut tous les termes","visi-bloc-jlg")}],onChange:e=>i({operator:e})}),c.length>0?(0,e.createElement)("div",{className:"visibloc-advanced-rule__terms"},c.map(l=>(0,e.createElement)(a.CheckboxControl,{key:l.value,label:l.label,checked:t.terms.includes(l.value),onChange:e=>u(e,l.value)}))):(0,e.createElement)("p",{className:"components-help-text"},(0,n.__)("Aucun terme disponible pour cette taxonomie.","visi-bloc-jlg")))}if("template"===t.type){const l=I("templates").map(e=>({value:e.value,label:e.label}));return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},o,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:t.operator,options:[{value:"is",label:(0,n.__)("Est","visi-bloc-jlg")},{value:"is_not",label:(0,n.__)("N’est pas","visi-bloc-jlg")}],onChange:e=>i({operator:e})}),(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Modèle","visi-bloc-jlg"),value:t.value,options:l,onChange:e=>i({value:e})}))}if("logged_in_status"===t.type){const l=I("loginStatuses").map(e=>({value:e.value,label:e.label}));return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},o,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:t.operator,options:[{value:"is",label:(0,n.__)("Est","visi-bloc-jlg")},{value:"is_not",label:(0,n.__)("N’est pas","visi-bloc-jlg")}],onChange:e=>i({operator:e})}),(0,e.createElement)(a.SelectControl,{label:(0,n.__)("État de connexion","visi-bloc-jlg"),value:t.value,options:l,onChange:e=>i({value:e})}))}if("user_role_group"===t.type){const l=I("roleGroups"),r=z("roles")||{},s=l.find(e=>e&&e.value===t.group),c=s&&Array.isArray(s.roles)?s.roles:[];return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},o,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:t.operator,options:[{value:"matches",label:(0,n.__)("Correspond à","visi-bloc-jlg")},{value:"does_not_match",label:(0,n.__)("Ne correspond pas à","visi-bloc-jlg")}],onChange:e=>i({operator:e})}),(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Groupe de rôles","visi-bloc-jlg"),value:t.group,options:l.map(e=>({value:e.value,label:e.label})),onChange:e=>i({group:e})}),c.length>0&&(0,e.createElement)("p",{className:"components-help-text"},c.map(e=>r[e]||e).filter(Boolean).join(", ")))}if("user_segment"===t.type){const l=I("userSegments").map(e=>({value:"string"==typeof e.value?e.value:"",label:"string"==typeof e.label&&e.label.trim()?e.label:"string"==typeof e.value?e.value:""})).filter(e=>e.value),r=[{value:"matches",label:(0,n.__)("Appartient au segment","visi-bloc-jlg")},{value:"does_not_match",label:(0,n.__)("N’appartient pas au segment","visi-bloc-jlg")}],s="string"==typeof t.segment?t.segment:"";return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},o,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:t.operator,options:r,onChange:e=>i({operator:e})}),(0,e.createElement)(a.ComboboxControl,{label:(0,n.__)("Identifiant de segment","visi-bloc-jlg"),value:s,options:l,onChange:e=>i({segment:e||""}),allowReset:!0,help:(0,n.__)("Choisissez un segment fourni par vos intégrations marketing ou saisissez un identifiant personnalisé.","visi-bloc-jlg")}),!l.length&&(0,e.createElement)("p",{className:"components-help-text"},(0,n.__)("Aucun segment n’a encore été exposé via le filtre « visibloc_jlg_user_segments ».","visi-bloc-jlg")))}if("woocommerce_cart"===t.type){const l=I("woocommerceTaxonomies"),r=Array.isArray(l)&&l.length>0,s=l.find(e=>e&&e.slug===t.taxonomy),c=r?l.map(e=>({value:e.slug,label:e.label})):[{value:"",label:(0,n.__)("Aucune taxonomie disponible","visi-bloc-jlg")}],u=s&&Array.isArray(s.terms)?s.terms.map(e=>({value:e.value,label:e.label})):[],d=(e,l)=>{const o=String(l),r=e?[...t.terms,o]:t.terms.filter(e=>e!==o);i({terms:r})};return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},o,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:t.operator,options:[{value:"contains",label:(0,n.__)("Contient des produits avec ces termes","visi-bloc-jlg")},{value:"not_contains",label:(0,n.__)("Ne contient aucun produit avec ces termes","visi-bloc-jlg")}],onChange:e=>i({operator:e})}),(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Taxonomie WooCommerce","visi-bloc-jlg"),value:t.taxonomy,options:c,onChange:e=>i({taxonomy:e,terms:[]}),disabled:!r}),r?u.length>0?(0,e.createElement)("div",{className:"visibloc-advanced-rule__terms"},u.map(l=>(0,e.createElement)(a.CheckboxControl,{key:l.value,label:l.label,checked:t.terms.includes(l.value),onChange:e=>d(e,l.value)}))):(0,e.createElement)("p",{className:"components-help-text"},(0,n.__)("Aucun terme disponible pour cette taxonomie WooCommerce.","visi-bloc-jlg")):(0,e.createElement)("p",{className:"components-help-text"},(0,n.__)("Aucune source WooCommerce n’est disponible. Activez WooCommerce pour utiliser cette règle.","visi-bloc-jlg")))}if("query_param"===t.type){const l=I("commonQueryParams").map(e=>({value:e.value,label:e.label||e.value})),r=[{value:"",label:(0,n.__)("Personnalisé…","visi-bloc-jlg")},...l],s=[{value:"equals",label:(0,n.__)("Est égal à","visi-bloc-jlg")},{value:"not_equals",label:(0,n.__)("Est différent de","visi-bloc-jlg")},{value:"contains",label:(0,n.__)("Contient","visi-bloc-jlg")},{value:"not_contains",label:(0,n.__)("Ne contient pas","visi-bloc-jlg")},{value:"exists",label:(0,n.__)("Existe","visi-bloc-jlg")},{value:"not_exists",label:(0,n.__)("N’existe pas","visi-bloc-jlg")}],c=l.some(e=>e.value===t.param)?t.param:"";return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},o,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:t.operator,options:s,onChange:e=>i({operator:e})}),(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Paramètre courant","visi-bloc-jlg"),value:c,options:r,onChange:e=>{e&&i({param:e})}}),(0,e.createElement)(a.TextControl,{label:(0,n.__)("Nom du paramètre","visi-bloc-jlg"),value:t.param,onChange:e=>i({param:e}),help:(0,n.__)("Saisissez le nom du paramètre de requête attendu (ex. utm_source).","visi-bloc-jlg")}),!["exists","not_exists"].includes(t.operator)&&(0,e.createElement)(a.TextControl,{label:(0,n.__)("Valeur attendue","visi-bloc-jlg"),value:t.value,onChange:e=>i({value:e})}))}if("cookie"===t.type){const l=I("commonCookies").map(e=>({value:e.value,label:e.label||e.value})),r=[{value:"",label:(0,n.__)("Personnalisé…","visi-bloc-jlg")},...l],s=[{value:"equals",label:(0,n.__)("Est égal à","visi-bloc-jlg")},{value:"not_equals",label:(0,n.__)("Est différent de","visi-bloc-jlg")},{value:"contains",label:(0,n.__)("Contient","visi-bloc-jlg")},{value:"not_contains",label:(0,n.__)("Ne contient pas","visi-bloc-jlg")},{value:"exists",label:(0,n.__)("Existe","visi-bloc-jlg")},{value:"not_exists",label:(0,n.__)("N’existe pas","visi-bloc-jlg")}],c=l.some(e=>e.value===t.name)?t.name:"";return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},o,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:t.operator,options:s,onChange:e=>i({operator:e})}),(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Cookie courant","visi-bloc-jlg"),value:c,options:r,onChange:e=>{e&&i({name:e})}}),(0,e.createElement)(a.TextControl,{label:(0,n.__)("Nom du cookie","visi-bloc-jlg"),value:t.name,onChange:e=>i({name:e}),help:(0,n.__)("Saisissez le nom exact du cookie attendu (respect de la casse).","visi-bloc-jlg")}),!["exists","not_exists"].includes(t.operator)&&(0,e.createElement)(a.TextControl,{label:(0,n.__)("Valeur attendue","visi-bloc-jlg"),value:t.value,onChange:e=>i({value:e})}))}if("visit_count"===t.type){const l=[{value:"at_least",label:(0,n.__)("Au moins","visi-bloc-jlg")},{value:"at_most",label:(0,n.__)("Au plus","visi-bloc-jlg")},{value:"equals",label:(0,n.__)("Est exactement","visi-bloc-jlg")},{value:"not_equals",label:(0,n.__)("N’est pas exactement","visi-bloc-jlg")}],r=Number.isFinite(t.threshold)&&t.threshold>=0?String(t.threshold):"0";return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},o,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Condition","visi-bloc-jlg"),value:t.operator,options:l,onChange:e=>i({operator:e})}),(0,e.createElement)(a.TextControl,{label:(0,n.__)("Nombre de visites","visi-bloc-jlg"),type:"number",min:0,value:r,onChange:e=>{const t=Number.parseInt(e,10);i({threshold:Number.isNaN(t)||t<0?0:t})},help:(0,n.__)("Le compteur de visites est stocké dans le cookie « visibloc_visit_count ».","visi-bloc-jlg")}))}const r=e=>t=>{const l=t&&t.target?t.target.value:"",o="string"==typeof l?l:"";i({[e]:o})};return(0,e.createElement)("div",{key:t.id,className:"visibloc-advanced-rule"},o,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Fréquence","visi-bloc-jlg"),value:t.frequency,options:[{value:"daily",label:(0,n.__)("Quotidien","visi-bloc-jlg")},{value:"weekly",label:(0,n.__)("Hebdomadaire","visi-bloc-jlg")}],onChange:e=>i({frequency:e,days:"weekly"===e?t.days:[]})}),(0,e.createElement)(a.Flex,{gap:"small"},(0,e.createElement)(a.FlexBlock,null,(0,e.createElement)(a.BaseControl,{label:(0,n.__)("Heure de début","visi-bloc-jlg")},(0,e.createElement)("input",{type:"time",value:t.startTime||"",onChange:r("startTime"),className:"components-text-control__input"}))),(0,e.createElement)(a.FlexBlock,null,(0,e.createElement)(a.BaseControl,{label:(0,n.__)("Heure de fin","visi-bloc-jlg")},(0,e.createElement)("input",{type:"time",value:t.endTime||"",onChange:r("endTime"),className:"components-text-control__input"})))),"weekly"===t.frequency&&oe.size>0&&(0,e.createElement)("div",{className:"visibloc-advanced-rule__days"},(0,e.createElement)("p",{className:"components-base-control__label"},(0,n.__)("Jours actifs","visi-bloc-jlg")),Array.from(oe.entries()).map(([l,o])=>(0,e.createElement)(a.CheckboxControl,{key:l,label:o,checked:t.days.includes(l),onChange:e=>((e,l)=>{const o=e?[...new Set([...t.days,l])]:t.days.filter(e=>e!==l);i({days:o})})(e,l)}))))})(t,l)),(0,e.createElement)(a.DropdownMenu,{text:(0,n.__)("Ajouter une règle de…","visi-bloc-jlg"),label:(0,n.__)("Ajouter une règle de…","visi-bloc-jlg"),toggleProps:{variant:"secondary"}},({onClose:t})=>(0,e.createElement)(a.MenuGroup,{label:(0,n.__)("Types de règles disponibles","visi-bloc-jlg")},L.map(l=>(0,e.createElement)(a.MenuItem,{key:l.value,onClick:()=>{Ce(e=>({...e,rules:[...e.rules,ne(l.value)]})),t()}},l.label)))),Le((0,n.__)("Ces règles permettent d’affiner la visibilité selon le contexte du contenu, le modèle ou un horaire récurrent.","visi-bloc-jlg"),"is-subtle"))},{id:"fallback",label:(0,n.__)("Repli","visi-bloc-jlg"),summary:ze,content:(0,e.createElement)(t.Fragment,null,(0,e.createElement)(a.ToggleControl,{label:(0,n.__)("Activer le repli pour ce bloc","visi-bloc-jlg"),checked:k,onChange:()=>u({fallbackEnabled:!k})}),!k&&(0,e.createElement)(a.Notice,{status:"info",isDismissible:!1},(0,n.__)("Aucun contenu de repli ne sera affiché si ce bloc est masqué.","visi-bloc-jlg")),k&&(0,e.createElement)(t.Fragment,null,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Source du repli","visi-bloc-jlg"),value:E,options:re,onChange:e=>u({fallbackBehavior:re.some(t=>t.value===e)?e:"inherit"})}),"inherit"===E&&(ee?(0,e.createElement)(a.Notice,{status:"info",isDismissible:!1},te?(0,n.sprintf)((0,n.__)("Repli global : %s","visi-bloc-jlg"),te):(0,n.__)("Un repli global est configuré.","visi-bloc-jlg")):(0,e.createElement)(a.Notice,{status:"warning",isDismissible:!1},(0,n.__)("Aucun repli global n’est actuellement défini.","visi-bloc-jlg"))),"text"===E&&(0,e.createElement)(a.TextareaControl,{label:(0,n.__)("Texte affiché en repli","visi-bloc-jlg"),help:(0,n.__)("Ce texte remplace le bloc lorsque les visiteurs n’y ont pas accès.","visi-bloc-jlg"),value:x,onChange:e=>u({fallbackCustomText:e})}),"block"===E&&(0,e.createElement)(t.Fragment,null,(0,e.createElement)(a.SelectControl,{label:(0,n.__)("Bloc réutilisable à afficher","visi-bloc-jlg"),value:w?String(w):"",options:[{value:"",label:(0,n.__)("— Sélectionnez un bloc —","visi-bloc-jlg")},...ie],onChange:e=>{const t=parseInt(e,10);u({fallbackBlockId:Number.isNaN(t)?0:t})},disabled:!ie.length}),!ie.length&&(0,e.createElement)(a.Notice,{status:"warning",isDismissible:!1},(0,n.__)("Aucun bloc réutilisable publié n’est disponible.","visi-bloc-jlg"))),(0,e.createElement)(a.ToggleControl,{label:(0,n.__)("Prévisualiser le repli","visi-bloc-jlg"),checked:T,onChange:()=>P(e=>!e),disabled:!k,"aria-controls":ke,"aria-expanded":T&&k}),T&&k&&(0,e.createElement)("div",{ref:je,id:ke,className:"visibloc-fallback-preview",role:"region","aria-live":"polite","aria-labelledby":Ee,tabIndex:"-1"},(0,e.createElement)("span",{id:Ee,className:"screen-reader-text"},(0,n.__)("Aperçu du contenu de repli","visi-bloc-jlg")),_e?(0,e.createElement)("div",{className:"visibloc-fallback-preview__content"},(0,e.createElement)(t.RawHTML,null,_e)):(0,e.createElement)(a.Notice,{status:"warning"===he?"warning":"info",isDismissible:!1},ye||(0,n.__)("Aucun aperçu disponible pour ce repli.","visi-bloc-jlg")))))}],Qe=Ge[0]||null,Je=Ge.map((e,t)=>({name:e.id,title:(0,n.sprintf)((0,n.__)("Étape %1$d · %2$s","visi-bloc-jlg"),t+1,e.label),className:"visibloc-stepper__tab"}));return(0,e.createElement)(t.Fragment,null,(0,e.createElement)(l,{...i}),b&&(0,e.createElement)(t.Fragment,null,(0,e.createElement)(r.BlockControls,null,(0,e.createElement)(a.ToolbarGroup,null,(0,e.createElement)(a.ToolbarButton,{icon:"visibility",label:(0,n.__)("Rendre visible","visi-bloc-jlg"),onClick:()=>u({isHidden:!1}),isActive:!1===p}),(0,e.createElement)(a.ToolbarButton,{icon:"hidden",label:(0,n.__)("Rendre caché","visi-bloc-jlg"),onClick:()=>u({isHidden:!0}),isActive:!0===p}))),(0,e.createElement)(r.InspectorControls,null,(0,e.createElement)(a.PanelBody,{title:(0,n.__)("Parcours de visibilité","visi-bloc-jlg"),initialOpen:!0,className:"visibloc-panel--guided"},Je.length>0&&(0,e.createElement)(a.TabPanel,{className:"visibloc-stepper",activeClass:"is-active",initialTabName:W,onSelect:e=>K(e),tabs:Je},l=>{const i=Ge.find(e=>e.id===l.name)||Qe,o=(r=i?i.summary:"")&&String(r).trim()?r:He;var r;const a=i?i.content:null;return(0,e.createElement)(t.Fragment,null,Le(o,"is-summary"),(0,e.createElement)("div",{className:"visibloc-step-content"},a))})))))},"withVisibilityControls");function de(){const e=(0,c.select)("core/edit-post");return!!e&&("function"==typeof e.isListViewOpened?e.isListViewOpened():"function"==typeof e.isFeatureActive&&e.isFeatureActive("listView"))}function be(e){ie!==e&&("undefined"!=typeof document&&document.body?(ie=e,document.body.classList.toggle("visibloc-compact-badges",e)):ie=e)}function me(){if("undefined"==typeof document||"undefined"==typeof ResizeObserver)return;const e=document.querySelector(".block-editor-list-view__container")||document.querySelector(".block-editor-list-view");e&&(te||(te=new ResizeObserver(t=>{t.forEach(t=>{const l=t&&t.target?t.target:e;be((t&&t.contentRect?t.contentRect.width:l.offsetWidth)<260)})})),le&&le!==e&&te.unobserve(le),le=e,te.observe(e),be((e.getBoundingClientRect?e.getBoundingClientRect().width:e.offsetWidth)<260))}function pe(){if("undefined"==typeof document)return void(ee=null);const e=new Map;Q.forEach((t,l)=>{let i=J.get(l);if(i&&i.isConnected||(i=document.querySelector(`.block-editor-list-view__block[data-block="${l}"]`),i&&J.set(l,i)),!i)return J.delete(l),void e.set(l,t);t.isHidden?i.classList.add("bloc-editeur-cache"):i.classList.remove("bloc-editeur-cache"),t.hasFallback?i.classList.add("bloc-editeur-repli"):i.classList.remove("bloc-editeur-repli")}),Q.clear(),e.size&&e.forEach((e,t)=>{Q.set(t,e)}),Q.size&&de()?ee=window.requestAnimationFrame(()=>{pe()}):(me(),ee=null)}function ve(e,t){const l=Q.get(e);l&&l.isHidden===t.isHidden&&l.hasFallback===t.hasFallback&&l.hiddenDescription===t.hiddenDescription&&l.fallbackDescription===t.fallbackDescription||(Q.set(e,t),ee||(ee=window.requestAnimationFrame(()=>{pe()})))}function ge(){const e=(0,c.select)("core/block-editor");if(!e)return;const t=function(e){if(!e)return[];if("function"==typeof e.getClientIdsWithDescendants){const t=e.getClientIdsWithDescendants();if(Array.isArray(t))return t}const t=e.getBlockOrder();if(!Array.isArray(t)||!t.length)return[];const l=[...t],i=[];for(;l.length;){const t=l.pop();if(!t)continue;i.push(t);const o=e.getBlockOrder(t);Array.isArray(o)&&o.length&&o.forEach(e=>l.push(e))}return i}(e),l=t.join("|");if(!t.length)return void((Y.size||G.size)&&(Y.clear(),G.clear(),Q.clear(),J.clear(),K.clear(),X.clear(),Z=""));const i=new Set(t);if(l!==Z&&(t.forEach(t=>{if(Y.has(t))return;let l="function"==typeof e.getBlockName?e.getBlockName(t):void 0;if(!l){const i=e.getBlock(t);l=i?i.name:void 0}l&&C(l)&&(Y.add(t),X.add(t),K.delete(t))}),Array.from(Y).filter(e=>!i.has(e)).forEach(e=>{Y.delete(e),G.delete(e),Q.delete(e),J.delete(e),K.delete(e),X.delete(e)}),Z=l),!X.size)return;const o=Array.from(X);X.clear(),o.forEach(t=>{const l=e.getBlock(t);if(!l||!C(l.name))return K.delete(t),G.delete(t),Q.delete(t),J.delete(t),void Y.delete(t);const i=(o=l.attributes)&&"object"==typeof o?[o.isHidden?"1":"0",void 0===o.fallbackEnabled||Boolean(o.fallbackEnabled)?"1":"0","string"==typeof o.fallbackBehavior?o.fallbackBehavior:"inherit",o.fallbackBlockId?String(o.fallbackBlockId):"","string"==typeof o.fallbackCustomText?o.fallbackCustomText.trim():""].join("|"):"";var o;if(K.get(t)===i)return;K.set(t,i);const r={...G.get(t)||{},isHidden:Boolean(l.attributes.isHidden),hasFallback:U(l.attributes)};G.set(t,r),ve(t,r)})}const _e=m()(ge,120);function fe(){_e()}(0,i.addFilter)("blocks.registerBlockType","visi-bloc-jlg/add-visibility-attributes",function(e,t){return C(t)?(e.attributes={...e.attributes,isHidden:{type:"boolean",default:!1},deviceVisibility:{type:"string",default:"all"},isSchedulingEnabled:{type:"boolean",default:!1},publishStartDate:{type:"string"},publishEndDate:{type:"string"},publishTimezone:{type:"string",default:V},visibilityRoles:{type:"array",default:[]},advancedVisibility:{type:"object",default:P},fallbackEnabled:{type:"boolean",default:!0},fallbackBehavior:{type:"string",default:"inherit"},fallbackCustomText:{type:"string",default:""},fallbackBlockId:{type:"number"}},e):e}),(0,i.addFilter)("editor.BlockEdit","visi-bloc-jlg/with-visibility-controls",ue),(0,i.addFilter)("blocks.getSaveContent.extraProps","visi-bloc-jlg/add-save-classes",function(e,t,l){if(!C(t.name)||!l)return e;const{deviceVisibility:i}=l,o=[e.className,i&&"all"!==i?`vb-${i}`:""].filter(Boolean).join(" ");return{...e,className:o}}),(0,i.addFilter)("editor.BlockListBlock","visi-bloc-jlg/add-editor-status-badges",(0,o.createHigherOrderComponent)(l=>i=>{const o="string"==typeof i.className?i.className:"",r=o.includes("bloc-editeur-cache"),a=o.includes("bloc-editeur-repli"),s=i.clientId&&G.get(i.clientId)||{},c="string"==typeof s.hiddenDescription?s.hiddenDescription:"",u="string"==typeof s.fallbackDescription?s.fallbackDescription:"";if(!r&&!a)return(0,e.createElement)(l,{...i});const d=(0,e.createElement)(l,{...i}),b=t.Children.toArray(d.props.children),m=[];return r&&m.push((0,e.createElement)(f,{key:"visibloc-hidden-badge",label:(0,n.__)("Bloc masqué","visi-bloc-jlg"),variant:"hidden",screenReaderText:(0,n.__)("Ce bloc est masqué pour les visiteurs du site.","visi-bloc-jlg"),description:c})),a&&m.push((0,e.createElement)(f,{key:"visibloc-fallback-badge",label:(0,n.__)("Repli actif","visi-bloc-jlg"),variant:"fallback",screenReaderText:(0,n.__)("Le contenu de repli est affiché à la place du bloc original.","visi-bloc-jlg"),description:u})),(0,t.cloneElement)(d,d.props,[...m,...b])},"withVisibilityStatusBadges")),(0,i.addFilter)("editor.BlockListBlock.props","visi-bloc-jlg/add-editor-canvas-classes",function(e,t){if(!C(t.name)||!t.attributes)return e;const{isHidden:l}=t.attributes,i=U(t.attributes),o=[e.className,l?"bloc-editeur-cache":"",i?"bloc-editeur-repli":""].filter(Boolean).join(" ");return{...e,className:o}});let he=de();(0,c.subscribe)(function(){const e=de();fe(),e&&!he&&("function"==typeof _e.flush?_e.flush():ge(),function(){if(!Q.size)return;const e=Array.from(Q.entries());Q.clear(),ee&&(window.cancelAnimationFrame(ee),ee=null),e.forEach(([e,t])=>{ve(e,t)})}()),e?me():he&&(te&&le&&te.unobserve(le),te&&te.disconnect(),te=null,le=null,be(!1)),he=e})})()})();